
\section{样式作者指南}
\label{aut}

%This part of the manual documents the author interface of the \biblatex package. The author guide covers everything you need to know in order to write new citation and bibliography styles or localization modules. You should read the user guide first before continuing with this part of the manual.

手册的这一部分介绍\biblatex 包的作者接口。该指南包括了编写参考文献表和引用样式或本地化模型所需知晓的所有内容。在阅读本部分前最好先阅读用户指南。

\subsection{概述 Overview}
\label{aut:int}

%Before we get to the commands and facilities provided by \biblatex, we will have a look at some of its fundamental concepts. The \biblatex package uses auxiliary files in a special way. Most notably, the \file{bbl} file is used differently and when using \bibtex as the backend, there is only one \file{bst} file which implements a structured data interface rather than exporting printable data. With \latex's standard bibliographic facilities, a document includes any number of citation commands in the document body plus \cmd{bibliographystyle} and \cmd{bibliography}, usually towards the end of the document. The location of the former is arbitrary, the latter marks the spot where the list of references is to be printed:

在讨论\biblatex 提供的命令和工具之前，我们将首先介绍一些基本概念。\biblatex 包以一种特殊的方式使用辅助文件。最需要注意的是使用了\file{bbl}文件，而且当使用\bibtex 后端时，只有一个\file{bst}文件实现用来结构化的数据接口，而不是输出可打印的数据。使用\latex 的标准参考文献工具，一个文档通常包括任意数量的文献引用命令，再加上常放在文档最后的\cmd{bibliographystyle}和\cmd{bibliography}命令。文献引用命令在文档中的位置是任意的，而\cmd{bibliographystyle}和\cmd{bibliography}命令则标记了打印参考文献表的位置，比如:


\begin{ltxexample}
\documentclass{...}
\begin{document}
\cite{...}
...
\bibliographystyle{...}
\bibliography{...}
\end{document}
\end{ltxexample}
%
%Processing this files requires that a certain procedure be followed. This procedure is as follows:

处理这些文件需要如下的一定的流程，如下:

\begin{enumerate}

\item %Run \bin{latex}: On the first run, \cmd{bibstyle} and \cmd{bibdata} commands are written to the \file{aux} file, along with \cmd{citation} commands for all citations. At this point, the references are undefined because \latex is waiting for \bibtex to supply the required data. There is also no bibliography yet.
运行 \bin{latex}: 第一次运行\bin{latex}， \cmd{bibstyle}和 \cmd{bibdata}命令，以及所有引用的命令\cmd{citation}写入到\file{aux}文件中。在这个时候，各引文标注\footnote{这里的references译为引文标注，指在引用命令导致在正文中出现的标注，这个标注由标签label构成。}是未定义的，因为 \latex 等待\bibtex 提供需要的数据，当然参考文献表也不存在。

\item %Run \bin{bibtex}: \bibtex writes a \env{thebibliography} environment to the \file{bbl} file, supplying all entries from the \file{bib} file which were requested by the \cmd{citation} commands in the \file{aux} file.
运行 \bin{bibtex}:\bibtex 在\file{bbl}文件中写入一个\env{thebibliography}环境，提供\file{aux}文件中\cmd{citation}命令所需求所有条目，这些条目数据来自\file{bib}文件。

\item %Run \bin{latex}: Starting with the second run, the \cmd{bibitem} commands in the \env{thebibliography} environment write one \cmd{bibcite} command for each bibliography entry to the \file{aux} file. These \cmd{bibcite} commands define the citation labels used by \cmd{cite}. However, the references are still undefined because the labels are not available until the end of this run.
运行\bin{latex}，第二次运行\bin{latex}，\env{thebibliography}环境中的\cmd{bibitem}命令在\file{aux}文件中为每个参考文献条目写入\cmd{bibcite}命令。这些\cmd{bibcite}命令定义的标签将用于\cmd{cite}命令。然而，各引文标注仍然未定义，因为这些标签在最后一次运行\bin{latex}前仍未得到。

\item %Run \bin{latex}: Starting with the third run, the citation labels are defined as the \file{aux} file is read in at the end of the preamble. All citations can now be printed.
运行\bin{latex}:第三次运行，这时引用的标签已经定义因为在导言区最后读入了\file{aux}文件。这样所有的标注可以正确打印出来。

\end{enumerate}

%Note that all bibliographic data is written to the \file{bbl} file in the final format. The \file{bbl} file is read in and processed like any printable section of the document. For example, consider the following entry in a \file{bib} file:

注意到所有的参考文献数据都以最终格式(指最后打印出的格式)写入\file{bbl}文件。该文件的读取和处理如同任何文档中的可打印章节。比如，考虑在一个\file{bib}文件中有如下条目:

\begin{lstlisting}[style=bibtex]{}
@Book{companion,
  author    = {Michel Goossens and Frank Mittelbach and Alexander Samarin},
  title     = {The LaTeX Companion},
  publisher = {Addison-Wesley},
  address   = {Reading, Mass.},
  year      = {1994},
}
\end{lstlisting}
%
%With the \path{plain.bst} style, \bibtex exports this entry to the \file{bbl} file as follows:

根据\path{plain.bst}样式，\bibtex 在\file{bbl}文件中输出该条目如下:

\begin{lstlisting}[style=latex]{}
\bibitem{companion}
Michel Goossens, Frank Mittelbach, and Alexander Samarin.
\newblock {\em The LaTeX Companion}.
\newblock Addison-Wesley, Reading, Mass., 1994.
\end{lstlisting}
%
%By default, \latex generates numeric citation labels, hence \cmd{bibitem} writes lines such as the following to the \file{aux} file:

默认情况下，\latex 生成顺序制引用标签，因此\cmd{bibitem}命令在\file{aux}文件中写入的行，如下:

\begin{lstlisting}[style=latex]{}
\bibcite{companion}{1}
\end{lstlisting}
%
%Implementing a different citation style implies that more data has to be transferred via the \file{aux} file. With the \sty{natbib} package, for example, the \file{aux} file contains lines like this one:

要实现一个不同的引用标签样式，意味着需要通过\file{aux}文件传递更多的数据。比如，当使用\sty{natbib}包时，\file{aux}文件包含的引用信息行，如下:

\begin{lstlisting}[style=latex]{}
\bibcite{companion}{{1}{1994}{{Goossens et~al.}}{{Goossens, Mittelbach,
and Samarin}}}
\end{lstlisting}
%
%The \biblatex package supports citations in any arbitrary format, hence citation commands need access to all bibliographic data. What this would mean within the scope of the procedure outlined above becomes obvious when looking at the output of the \sty{jurabib} package which also makes all bibliographic data available in citations:

\biblatex 包支持任何格式的引用标签，因此引用命令需要访问所有的参考文献数据。只要看一看同样需要在引用中提供所有参考文献数据的\sty{jurabib}包的输出，我们就可以明白到这对上述处理过程来说意味着什么。

\begin{lstlisting}[style=latex]{}
\bibcite{companion}{{Goossens\jbbfsasep Mittelbach\jbbstasep Samarin}%
  {}{{0}{}{book}{1994}{}{}{}{}{Reading, Mass.\bpubaddr{}Addison-Wesley%
  \bibbdsep{} 1994}}{{The LaTeX Companion}{}{}{2}{}{}{}{}{}}{\bibnf
  {Goossens}{Michel}{M.}{}{}\Bibbfsasep\bibnf{Mittelbach}{Frank}{F.}%
  {}{}\Bibbstasep\bibnf{Samarin}{Alexander}{A.}{}{}}{\bibtfont{The
  LaTeX Companion}.\ \apyformat{Reading, Mass.\bpubaddr{}
  Addison-Wesley\bibbdsep{} 1994}}}
\end{lstlisting}
%
%In this case, the contents of the entire \env{thebibliography} environment are effectively transferred via the \file{aux} file. The data is read from the \file{bbl} file, written to the \file{aux} file, read back from the \file{aux} file and then kept in memory. The bibliography itself is still generated as the \file{bbl} file is read in. The \biblatex package would also be forced to cycle all data through the \file{aux} file. This implies processing overhead and is also redundant because the data has to be kept in memory anyway.

这种情况下，整个\env{thebibliography}环境的内容通过\file{aux}文件有效传递。数据从\file{bbl}文件中读取出来，写入到\file{aux}中，再从\file{aux}读出保存到内存中。而参考文献表本身的生成仍然需要读入\file{bbl}文件。如果采用这种方式，\biblatex 包将被迫通过\file{aux}文件回收所有的数据。但上述这个处理过程过度且多余，因为不管怎么样，数据都需要保存在内存中。

%The traditional procedure is based on the assumption that the full bibliographic data of an entry is only required in the bibliography and that all citations use short labels. This makes it very effective in terms of memory requirements, but it also implies that it does not scale well. That is why \biblatex takes a different approach. First of all, the document structure is slightly different. Instead of using \cmd{bibliography} in the document body, database files are specified in the preamble with \cmd{addbibresource}, \cmd{bibliographystyle} is omitted entirely (all features are controlled by package options), and the bibliography is printed using \cmd{printbibliography}:

这种传统的处理过程是基于一个假设，即条目的完整数据只是参考文献表需要而所有的引用标注都使用短标签。这对于有内存限制的情况是非常有效的，但也意味着很难扩展。这就是\biblatex 采取另一种不同方法的原因。首先，文档结构略有变化。取消在文档内使用\cmd{bibliography}命令，数据库文件由导言区的\cmd{addbibresource}命令指定，完全忽略\cmd{bibliographystyle}命令(而所有的功能都有包选项控制)，参考文献表使用\cmd{printbibliography}命令打印:

\begin{ltxexample}
\documentclass{...}
\usepackage[...]{biblatex}
\addbibresource{...}
\begin{document}
\cite{...}
...
\printbibliography
\end{document}
\end{ltxexample}
%

%In order to streamline the whole procedure, \biblatex essentially employs the \file{bbl} file like an \file{aux} file, rendering \cmd{bibcite} obsolete. We then get the following procedure:

为了简化整个流程，\biblatex 基本上以应用\file{aux}文件的方式应用\file{bbl}文件，并舍弃了\cmd{bibcite}命令。于是，我们得到如下流程:


\begin{enumerate}

\item %Run \bin{latex}: The first step is similar to the traditional procedure described above: \cmd{bibstyle} and \cmd{bibdata} commands are written to the \file{aux} file (\bibtex backend) or \file{bcf} file (\biber backend), along with \cmd{citation} commands for all citations. We then wait for the backend to supply the required data. With \bibtex as a backend, since \biblatex uses a special \file{bst} file which implements its data interface on the \bibtex end, the \cmd{bibstyle} command is always |\bibstyle{biblatex}|.
运行\bin{latex}:第一步类似于上述的传统方式:\cmd{bibstyle} 和 \cmd{bibdata}以及所有引用的\cmd{citation}命令写入到\file{aux}文件中(以\bibtex 为后端)或者写到\file{bcf}文件中(以\biber 为后端)。然后等待后端提供需要的数据。当以\bibtex 为后端时，\biblatex 使用一个特殊 \file{bst}的文件，该文件用于实现\bibtex 后端的数据接口，因此\cmd{bibstyle}命令则必须是|\bibstyle{biblatex}|。

\item %Run \bin{biber} or \bin{bibtex}: The backend supplies those entries from the \file{bib} file which were requested by the \cmd{citation} commands in the auxiliary file. However, it does not write a printable bibliography to the \file{bbl} file, but rather a structured representation of the bibliographic data. Just like an \file{aux} file, this \file{bbl} file does not print anything when read in. It merely puts data in memory.
运行\bin{biber} 或 \bin{bibtex}:后端提供了辅助文件中所有\cmd{citation}命令所需的条目，这些条目的数据来自\file{bib}文件。然而，它并不在\file{bbl}文件中写出一个可打印的参考文献表，而是一个参考文献的结构化表达数据。类似于\file{aux}文件，读入该\file{bbl}文件时不打印任何东西，仅是将数据存入内存中。

\item %Run \bin{latex}: Starting with the second run, the \file{bbl} file is processed right at the beginning of the document body, just like an \file{aux} file. From this point on, all bibliographic data is available in memory so that all citations can be printed right away.\footnote{If the \opt{defernumbers} package option is enabled \biblatex uses an algorithm similar to the traditional procedure to generate numeric labels. In this case, the numbers are assigned as the bibliography is printed and then cycled through the backend auxiliary file. It will take an additional \latex run for them to be picked up in citations.} The citation commands have access to the complete bibliographic data, not only to a predefined label. The bibliography is generated from memory using the same data and may be filtered or split as required.
运行\bin{latex}: 第二次运行，\file{bbl}文件在文档正文开始的时候处理，类似于\file{aux}文件。从这开始，所有参考文献数据都已在内存中，所以所有的引用都可以正确打印。\footnote{如果\opt{defernumbers} 包选项打开， \biblatex 以类似于传统过程的一种算法来生成顺序制标签。这种情况下，这些数字在参考文献表打印的时候指定且需从后端辅助文件中回收。因此需要额外运行一次\latex 以在标注中获得它们。 } 引用命令不仅可以访问预定义的标签，还可以访问完整的参考文献数据。参考文献表由内存中的相同数据生成，可以根据需要进行筛选和划分。

\end{enumerate}

%Let's consider the sample entry given above once more:

我们再次考虑上面给出的条目样例:

\begin{lstlisting}[style=bibtex]{}
@Book{companion,
  author    = {Michel Goossens and Frank Mittelbach and Alexander Samarin},
  title     = {The LaTeX Companion},
  publisher = {Addison-Wesley},
  address   = {Reading, Mass.},
  year      = {1994},
}
\end{lstlisting}
%
%With \biblatex and the \biber backend, this entry is essentially exported in the following format:

使用\biblatex 及\biber 后端，这一条目实际上以如下格式输出:

\begin{lstlisting}[style=latex]{}
\entry{companion}{book}{}
  \labelname{author}{3}{}{%
    {{uniquename=0,hash=...}{Goossens}{G.}{Michel}{M.}{}{}{}{}}%
    {{uniquename=0,hash=...}{Mittelbach}{M.}{Frank}{F.}{}{}{}{}}%
    {{uniquename=0,hash=...}{Samarin}{S.}{Alexander}{A.}{}{}{}{}}%
  }
  \name{author}{3}{}{%
    {{uniquename=0,hash=...}{Goossens}{G.}{Michel}{M.}{}{}{}{}}%
    {{uniquename=0,hash=...}{Mittelbach}{M.}{Frank}{F.}{}{}{}{}}%
    {{uniquename=0,hash=...}{Samarin}{S.}{Alexander}{A.}{}{}{}{}}%
  }
  \list{publisher}{1}{%
    {Addison-Wesley}%
  }
  \list{location}{1}{%
    {Reading, Mass.}%
  }
  \field{title}{The LaTeX Companion}
  \field{year}{1994}
\endentry
\end{lstlisting}
%

%As seen in this example, the data is presented in a structured format that resembles the structure of a \file{bib} file to some extent. At this point, no decision concerning the final format of the bibliography entry has been made. The formatting of the bibliography and all citations is controlled by \latex macros, which are defined in bibliography and citation style files.

由这一例子可见，某种程度上说结构化的数据构成了\file{bbl}文件内容\footnote{这里应该是bbl文件而不是原文的bib文件}。从这点上说，没有任何关于参考文献条目最终格式的决定。而参考文献表和引用标注的格式化由 \latex 宏控制，这些宏定义在参考文献和引用样式文件中。

\subsection{参考文献样式 Bibliography Styles}
\label{aut:bbx}
一个参考文献样式是用于控制打印参考文献表中条目的宏的集合，定义在扩展名为\file{bbx}的文件中。\biblatex 包在其结尾加载所选择的参考文献样式文件。需要注意:一些由多个标准样式文件共享的常用宏定义在\path{biblatex.def}文件中。该文件同样在包结尾加载，但先于参考文献样式文件。

%A bibliography style is a set of macros which print the entries in the bibliography. Such styles are defined in files with the suffix \file{bbx}. The \biblatex package loads the selected bibliography style file at the end of the package. Note that a small repertory of frequently used macros shared by several of the standard bibliography styles is included in \path{biblatex.def}. This file is loaded at the end of the package as well, prior to the selected bibliography style.

\subsubsection{参考文献样式文件 Bibliography Style Files}
\label{aut:bbx:bbx}

%Before we go over the individual components of a bibliography style, consider this example of the overall structure of a typical \file{bbx} file:

在我们讨论参考文献样式的各部分之前，考虑一个典型的\file{bbx}文件总体结构，如下:

\begin{ltxexample}
\ProvidesFile{example.bbx}[2006/03/15 v1.0 biblatex bibliography style]

\defbibenvironment{bibliography}
  {...}
  {...}
  {...}
\defbibenvironment{shorthand}
  {...}
  {...}
  {...}
\InitializeBibliographyStyle{...}
\DeclareBibliographyDriver{article}{...}
\DeclareBibliographyDriver{book}{...}
\DeclareBibliographyDriver{inbook}{...}
...
\DeclareBibliographyDriver{shorthand}{...}
\endinput
\end{ltxexample}
%
%The main structure of a bibliography style file consists of the following commands:

参考文献样式文件的主要结构包含如下命令:

\begin{ltxsyntax}

\cmditem{RequireBibliographyStyle}{style}

%This command is optional and intended for specialized bibliography styles built on top of a more generic style. It loads the bibliography style \path{style.bbx}.

该命令是可选的，用于指定一些建立在更一般的参考文献样式上的特殊样式。该命令加载样式文件\path{style.bbx}。

\cmditem{InitializeBibliographyStyle}{code}

%Specifies arbitrary \prm{code} to be inserted at the beginning of the bibliography, but inside the group formed by the bibliography. This command is optional. It may be useful for definitions which are shared by several bibliography drivers but not used outside the bibliography. Keep in mind that there may be several bibliographies in a document. If the bibliography drivers make any global assignments, they should be reset at the beginning of the next bibliography.

该命令在参考文献表开始之前插入任意给定的\prm{code}，但在参考文献表所形成的组内。该命令是可选的。它对于不同的参考文献驱动共享一些定义是有用的，但不能用于参考文献组外。记住，文档中可以有多个参考文献表，如果参考文献驱动进行了任何全局设置，应在下一个参考文献开始前重设\footnote{这里不是很理解}。

\cmditem{DeclareBibliographyDriver}{entrytype}{code}

%Defines a bibliography driver. A <driver> is a macro which handles a specific entry type (when printing bibliography lists) or a specific named bibliography list (when printing bibliography lists). The \prm{entrytype} corresponds to the entry type used in \file{bib} files, specified in lowercase letters (see \secref{bib:typ}). The \prm{entrytype} argument may also be an asterisk. In this case, the driver serves as a fallback which is used if no specific driver for the entry type has been defined. The \prm{code} is arbitrary code which typesets all bibliography entries of the respective \prm{entrytype}. This command is mandatory. Every bibliography style should provide a driver for each entry type.

定义一个参考文献驱动。一个驱动 <driver> 是一个宏用于控制某一具体的参考文献条目(当打印参考文献表的时候)或者某一具体命名了的参考文献表(当打印多个参考文献表的时候)。\prm{entrytype}与\file{bib}文件中使用的条目类型对应，以小写字母给出(见\secref{bib:typ})。\prm{entrytype}变量可以是一个星号。这种情况下，该驱动退化为没有具体驱动的条目类型。\prm{code}是任意代码用于打印各自\prm{entrytype}的参考文献条目。该命令是必须的。每个参考文献样式都应提供所用到的每类条目的驱动。

\cmditem{DeclareBibliographyAlias}{alias}{entrytype}

%If a bibliography driver covers more than one entry type, this command may be used to define an alias where \prm{entrytype} is the name of a defined driver. This command is optional. The \prm{alias} argument may also be an asterisk. In this case, the \prm{entrytype} driver serves as a fallback which is used if no specific driver for an entry has been defined.

如果一个参考文献驱动用于处理多个参考文献条目类型，该命令可以用来定义某类已经定义驱动的\prm{entrytype}别名。\prm{alias}选项可以是一个星号，这种情况下，该驱动用于那些没有指定驱动的参考文献条目。

\cmditem{DeclareBibliographyOption}{key}[value]{code}

%This command defines additional preamble options in \keyval format. The \prm{key} is the option key. The \prm{code} is arbitrary \tex code to be executed whenever the option is used. The value passed to the option is passed on to the \prm{code} as |#1|. The optional \prm{value} is a default value to be used if the bare key is given without any value. This is useful for boolean switches. For example, with a definition like the following:

该命令以\keyval 格式定义额外的导言区选项。\prm{key}是选项键名。\prm{code}是任意\tex 代码用于该选项使用时执行。传递给选项的value值作为\prm{code}的输入参数|#1|。可选的\prm{value}是没有给定任何输入参数时使用的默认参数。这对于布尔开关是有用的，比如，某一选项定义如下:

\begin{lstlisting}[style=latex]
\DeclareBibliographyOption{somekey}[true]{...}
\end{lstlisting}
%
%giving <\texttt{somekey}> without a value is equivalent to <\kvopt{somekey}{true}>.

当无键值给出时，该<\texttt{somekey}>等价于<\kvopt{somekey}{true}>。

\cmditem{DeclareEntryOption}{key}[value]{code}

%Similar to \cmd{DeclareBibliographyOption} but defines options which are settable on a per"=entry basis in the \bibfield{options} field from \secref{bib:fld:spc}. The \prm{code} is executed whenever \biblatex prepares the data of the entry for use by a citation command or a bibliography driver.

类似于\cmd{DeclareBibliographyOption}，但用于定义一些条目的可设选项，这些选项在\secref{bib:fld:spc}节中的\bibfield{options}域中。\prm{code}在\biblatex 为一个引用命令或参考文献驱动准备条目数据时执行。

\end{ltxsyntax}

\subsubsection{参考文献环境 Bibliography Environments}
\label{aut:bbx:env}

%Apart from defining bibliography drivers, the bibliography style is also responsible for the environments which control the layout of the bibliography and bibliography lists. These environments are defined with \cmd{defbibenvironment}. By default, \cmd{printbibliography} uses the environment \opt{bibliography}. Here is a definition suitable for a bibliography style which does not print any labels in the bibliography:

除了定义参考文献驱动，参考文献样式也要定义参考文献环境用于控制参考文献表的输出。这些环境由命令\cmd{defbibenvironment}名义。默认情况下，\cmd{printbibliography}使用\opt{bibliography}环境。下面是一个适用于不打印标签的参考文献样式的环境定义:

\begin{lstlisting}[style=latex]{}
\defbibenvironment{bibliography}
  {\list
     {}
     {\setlength{\leftmargin}{\bibhang}%
      \setlength{\itemindent}{-\leftmargin}%
      \setlength{\itemsep}{\bibitemsep}%
      \setlength{\parsep}{\bibparsep}}}
  {\endlist}
  {\item}
\end{lstlisting}
%
%This definition employs a \env{list} environment with hanging indentation, using the \cmd{bibhang} length register provided by \biblatex. It allows for a certain degree of configurability by using \cmd{bibitemsep} and \cmd{bibparsep}, two length registers provided by \biblatex for this very purpose (see \secref{aut:fmt:len}). The \texttt{authoryear} and \texttt{authortitle} bibliography styles use a definition similar to this example.

该定义使用\biblatex 提供的\cmd{bibhang}尺寸，应用了一个带悬挂缩进的\env{list}环境。它允许使用\cmd{bibitemsep} 和 \cmd{bibparsep}来实现一定程度的布局调整，\biblatex 提供的这两个尺寸就是为了该目的(见 \secref{aut:fmt:len})。作者年制(\texttt{authoryear})和作者题名制(\texttt{authortitle})的参考文献样式使用类似于该例的定义。

\begin{lstlisting}[style=latex]{}
\defbibenvironment{bibliography}
  {\list
     {\printfield[labelnumberwidth]{labelnumber}}
     {\setlength{\labelwidth}{\labelnumberwidth}%
      \setlength{\leftmargin}{\labelwidth}%
      \setlength{\labelsep}{\biblabelsep}%
      \addtolength{\leftmargin}{\labelsep}%
      \setlength{\itemsep}{\bibitemsep}%
      \setlength{\parsep}{\bibparsep}}%
      \renewcommand*{\makelabel}[1]{\hss##1}}
  {\endlist}
  {\item}
\end{lstlisting}
%
%Some bibliography styles print labels in the bibliography. For example, a bibliography style designed for a numeric citation scheme will print the number of every entry such that the bibliography looks like a numbered list. In the first example, the first argument to \cmd{list} was empty. In this example, we need it to insert the number, which is provided by \biblatex in the \bibfield{labelnumber} field. We also employ several length registers and other facilities provided by \biblatex, see \secref{aut:fmt:ich, aut:fmt:ilc} for details. The \texttt{numeric} bibliography style uses the definition given above. The \texttt{alphabetic} style is similar, except that \textsf{\texttt{labelnumber}} is replaced by \texttt{labelalpha} and \texttt{labelnumberwidth} by \texttt{labelalphawidth}.

一些参考文献样式在参考文献列表中打印标签。比如，设计一个顺序引用格式的参考文献样式需要在参考文献表的每个条目前面打印顺序数字，这样参考文献看起来就像一个顺序列表。在第一个例子中，\cmd{list}命令的第一个参数是空的。在这个例子中，我们需要在其中插入数字，这些数字由\biblatex 的\bibfield{labelnumber}域中的数字提供。我们也应用\biblatex 提供的几个尺寸和工具，详见 \secref{aut:fmt:ich, aut:fmt:ilc}。顺序制(\texttt{numeric})参考文献样式使用如上的定义。除\textsf{\texttt{labelnumber}}由\texttt{labelalpha}代替和\texttt{labelnumberwidth}由\texttt{labelalphawidth}代替外，顺序字母制(\texttt{alphabetic})的样式也是类似的。


%Bibliography lists are handled in a similar way. \cmd{printbiblist} uses the environment named after the bibliography list by default (when using \bibtex, \cmd{printshorthands} always uses the \texttt{shorthand} environment). A typical example is given below. See \secref{aut:fmt:ich, aut:fmt:ilc} for details on the length registers and facilities used in this example.

各参考文献表以相似方式处理。\cmd{printbiblist}命令默认使用以bibliography list命名的环境(当使用\bibtex 时，\cmd{printshorthands}总是使用\texttt{shorthand}环境)。一个典型的例子如下，其中的尺寸和工具定义详见第\secref{aut:fmt:ich, aut:fmt:ilc}节。

\begin{lstlisting}[style=latex]{}
\defbibenvironment{shorthand}
  {\list
     {\printfield[shorthandwidth]{shorthand}}
     {\setlength{\labelwidth}{\shorthandwidth}%
      \setlength{\leftmargin}{\labelwidth}%
      \setlength{\labelsep}{\biblabelsep}%
      \addtolength{\leftmargin}{\labelsep}%
      \setlength{\itemsep}{\bibitemsep}%
      \setlength{\parsep}{\bibparsep}%
      \renewcommand*{\makelabel}[1]{##1\hss}}}
  {\endlist}
  {\item}
\end{lstlisting}

\subsubsection{参考文献驱动 Bibliography Drivers}
\label{aut:bbx:drv}

%Before we go over the commands which form the data interface of the \biblatex package, it may be instructive to have a look at the structure of a bibliography driver. Note that the example given below is greatly simplified, but still functional. For the sake of readability, we omit several fields which may be part of a \bibtype{book} entry and also simplify the handling of those which are considered. The main point is to give you an idea of how a driver is structured. For information about the mapping of the \bibtex file format fields to \biblatex's data types, see \secref{bib:fld}.

在我们讨论\biblatex 包的数据接口命令前，了解一下参考文献驱动的结构是有益的。注意，虽然下面给出的例子是大为简化的，但仍具有说明意义。为可读性考虑，我们忽略了一些可能是\bibtype{book}条目的域，并且简化处理没有忽略的域。主要是为了说明驱动的结构。关于\bibtex 文件的格式域与\biblatex 包的数据类型的映射信息，见\secref{bib:fld}。

\begin{lstlisting}[style=latex]{}
\DeclareBibliographyDriver{book}{%
  \printnames{author}%
  \newunit\newblock
  \printfield{title}%
  \newunit\newblock
  \printlist{publisher}%
  \newunit
  \printlist{location}%
  \newunit
  \printfield{year}%
  \finentry}
\end{lstlisting}
%
%The standard bibliography styles employ two bibliography macros \texttt{begentry} and \texttt{finentry}:

标准的参考文献样式应用两个参考文献宏\texttt{begentry}和\texttt{finentry}。

\begin{lstlisting}[style=latex]{}
\DeclareBibliographyDriver{<<entrytype>>}{%
  \usebibmacro{begentry}
  ...
  \usebibmacro{finentry}}
\end{lstlisting}
%
%with the default definitions

作为默认的定义。

\begin{lstlisting}[style=latex]{}
\newbibmacro*{begentry}{}
\newbibmacro*{finentry}{\finentry}
\end{lstlisting}
%
%Use of these macros is recommended for easy hooks into the beginning and end of the driver.

推荐使用这两个宏，因为方便在驱动开始或结束时使用钩子。

%Returning to the driver for the \texttt{book} entrytype above, there is still one piece missing: the formatting directives used by \cmd{printnames}, \cmd{printlist}, and \cmd{printfield}. To give you an idea of what a formatting directive looks like, here are some fictional ones used by our sample driver. Field formats are straightforward, the value of the field is passed to the formatting directive as an argument which may be formatted as desired. The following directive will simply wrap its argument in an \cmd{emph} command:

回到上述给出\texttt{book}条目类型的驱动，我们发现有一些缺省:即\cmd{printnames}, \cmd{printlist}, 和 \cmd{printfield}命令所使用的格式命令。为了说明一个格式话指令是什么，这里给出上述驱动举例中所使用虚构指令。域的格式是直接的，域的值直接作为参数传递给格式命令，并根据需要格式化。下面的指令简单地将输入参数用一个\cmd{emph}命令包裹:


\begin{lstlisting}[style=latex]{}
\DeclareFieldFormat{title}{\emph{#1}}
\end{lstlisting}
%
List formats are slightly more complex. After splitting up the list into individual items, \biblatex will execute the formatting directive once for every item in the list. The item is passed to the directive as an argument. The separator to be inserted between the individual items in the list is also handled by the corresponding directive, hence we have to check whether we are in the middle of the list or at the end when inserting it.

列表格式则要复杂一些。在将列表划分为独立的项后，\biblatex 将对列表中的每一项执行格式化命令。各项作为参数传递给格式化命令。列表中各项间的分隔符由相应的命令控制，因此我们必须在插入分隔符前要检查是否在列表中或者是列表末尾。

\begin{lstlisting}[style=latex]{}
\DeclareListFormat{location}{%当打印的项的序号小于最大序号说明在列表内
#1%所以用逗号隔开
\ifthenelse{\value{listcount}<\value{liststop}}
{\addcomma\space}
{}}
\end{lstlisting}
%

姓名(name)的格式化命令类似于这种抄录列表，但列表中的单个项是姓名，因此需要自动的解析为姓名的不同组成部分。列表格式化命令对列表中每个姓名都执行一次，信吗的各个部分以分开的参数传递给该命令。比如，|#1|是姓(last name)和|#3|是名(first name)。下面给出一个简化的格式化命令例子:

Formatting directives for names are similar to those for literal lists, but the individual items in the list are names which are automatically dissected into their components. The list formatting directive is executed once for each name in the list and the components of the name are passed to the formatting directive as separate arguments. For example, |#1| is the last name and |#3| is the first name. Here is a simplified example:

\begin{lstlisting}[style=latex]{}
\DeclareNameFormat{author}{%
  \ifthenelse{\value{listcount}=1}
    {#1%
     \ifblank{#3}{}{\addcomma\space #3}}
    {\ifblank{#3}{}{#3\space}%
     #1}%
  \ifthenelse{\value{listcount}<\value{liststop}}
    {\addcomma\space}
    {}}
\end{lstlisting}
%
上述各格式化命令调换了第一个作者的姓名前后顺序«Last, First»)，而其余姓名则是常规顺序(«First Last»)。注意:必须要保证提供的姓名部分是姓(last name)，因此我们必须要检查实际数据中姓名的哪些部分是存在的。如果姓名的一些部分不存在，则相关的变量就为空。如同抄录列表的命令，在各独立项之间插入的分隔符也由格式化命令控制，因为我们也要检查是否处于列表中还是在其末尾，这也是第二个\cmd{ifthenelse}命令做的事情。

The above directive reverses the name of the first author («Last, First») and prints the remaining names in their regular sequence («First Last»). Note that the only component which is guaranteed to be available is the last name, hence we have to check which parts of the name are actually present. If a certain component of a name is not available, the corresponding argument will be blank. As with directives for literal lists, the separator to be inserted between the individual items in the list is also handled by the formatting directive, hence we have to check whether we are in the middle of the list or at the end when inserting it. This is what the second \cmd{ifthenelse} test does.

\subsubsection{特殊域 Special Fields}

\label{aut:bbx:fld}
下面的列表和域用于\biblatex 传递数据给参考文献驱动和引用命令。它们由包自动定义，并不是用于\file{bib}文件。从参考文献和引用样式的角度，它们与\file{bib}中的域并没有什么不同。


The following lists and fields are used by \biblatex to pass data to bibliography drivers and citation commands. They are not used in \file{bib} files but defined automatically by the package. From the perspective of a bibliography or citation style, they are not different from the fields in a \file{bib} file.

\paragraph{一般域 Generic Fields}
\label{aut:bbx:fld:gen}

\begin{fieldlist}
	
	\fielditem{entrykey}{string}
	\file{bib}文件中某一项的entry key。这是一个字符串，用于\biblatex 及其后端确定\file{bib}文件中的一个条目。
	
	The entry key of an item in the \file{bib} file. This is the string used by \biblatex and the backend to identify an entry in the \file{bib} file.
	
	\fielditem{childentrykey}{string}
	当引用一个条目集的子条目时，\biblatex 给引用数据提供了父\bibtype{set}条目的数据。这意味着\bibfield{entrykey}表示的是父条目的关键词。而子条目的关键词在\bibfield{childentrykey}域中提供。该域仅在引用一个条目集的某一子条目时使用。
	
	When citing a subentry of an entry set, \biblatex provides the data of the parent \bibtype{set} entry to citation commands. This implies that the \bibfield{entrykey} field holds the entry key of the parent. The entry key of the child entry being cited is provided in the \bibfield{childentrykey} field. This field is only available when citing a subentry of an entry set.
	
	\fielditem{datelabelsource}{literal\BiberOnlyMark}
	该域决定由\cmd{DeclareLabeldate}命令所选择的date域名的<date>的前缀词。比如，如果标签的date域是\bibfield{eventdate}，那么\bibfield{datelabelsource}将会是<event>。如果\cmd{DeclareLabeldate}命令选择\bibfield{date}域，那么\bibfield{datelabelsource}将会定义一个空字符串。这使得\bibfield{datelabelsource}的内容可以用于构建对\cmd{DeclareLabeldate}选择的域的引用。因为\cmd{DeclareLabeldate}也能选择用于备用的抄录字符串，如果\bibfield{datelabelsource}未定义，那么要不\opt{labeldate}包选项设置为false，或是\cmd{DeclareLabeldate}命令选择一个抄录字符串用于代替date域。要记住\cmd{DeclareLabeldate}也用来选择非日期域作为备用，因此\bibfield{datelabelsource}可以包含一个域名。所以，总结起来，规则是:
	
	Holds the prefix coming before <date> of the date field name chosen by \cmd{DeclareLabeldate}. For example, if the label date field is \bibfield{eventdate}, then \bibfield{datelabelsource} will be <event>. In case \cmd{DeclareLabeldate} selects the \bibfield{date} field, then \bibfield{datelabelsource} will be defined but will be an empty string as the prefix coming before <date> in the date label name is empty. This is so that the contents of \bibfield{datelabelsource} can be used in constructing references to the field which \cmd{DeclareLabeldate} chooses. Since \cmd{DeclareLabeldate} can also select literal strings for fallbacks, if \bibfield{datelabelsource} is undefined, then either the \opt{labeldate} package option is set to false or \cmd{DeclareLabeldate} chose a literal string instead of a date field. Bear in mind that \cmd{DeclareLabeldate} can also be used to select non-date fields as a fallback and so \bibfield{datelabelsource} might contain a field name. So, in summary, the rules are
	
	\begin{lstlisting}[style=latex]{}
	\iffieldundef{datelabelsource}
	{
	% labeldate package option is not set or \DeclareLabeldate resolved to a literal string
	}
	{
	\iffieldundef{\thefield{datelabelsource}}
	{
	% datelabelsource contains a date field name prefix like "", "event", "url" or "orig"
	}
	{
	% datelabelsource contains a non-date field
	}
	}
	\end{lstlisting}
	
	\fielditem{entrytype}{string}
	
	条目类型(\bibtype{book}, \bibtype{inbook},等)，以小写字母给出。
	
	The entry type (\bibtype{book}, \bibtype{inbook}, etc.), given in lowercase letters.
	
	\fielditem{childentrytype}{string}
	
	当引用一个条目集的子条目时，\biblatex 给引用命令提供父集条目的数据。这意味着\bibfield{entrytype}保存父条目的类型。子条目的类型则由\bibfield{childentrytype}域提供。该域仅在引用一个条目集的子条目时使用。
	
	When citing a subentry of an entry set, \biblatex provides the data of the parent \bibtype{set} entry to citation commands. This implies that the \bibfield{entrytype} field holds the entry type of the parent. The entry type of the child entry being cited is provided in the \bibfield{childentrytype} field. This field is only available when citing a subentry of an entry set.
	
	\fielditem{entrysetcount}{integer}
	该域保存的整数用于指明一个集中某个集成员的位置(起始值是\texttt{1})。该域仅对一个条目集的子条目有用。
	
	This field holds an integer indicating the position of a set member in the entry set (starting at \texttt{1}). This field is only available in the subentries of an entry set.
	
	\fielditem{hash}{string\BiberOnlyMark}
	该域非常特殊，仅在姓名格式化命令中使用。它保存一个hash字符串，用于唯一的确定姓名列表中的单个姓名。该信息对于姓名列表中的所有姓名都有提供。另外参见\bibfield{namehash}和\bibfield{fullhash}。
	
	This field is special in that it is only available locally in name formatting directives. It holds a hash string which uniquely identifies individual names in a name list. This information is available for all names in all name lists. See also \bibfield{namehash} and \bibfield{fullhash}.
	
	\fielditem{namehash}{string}
	一个hash字符串用于唯一确定\bibfield{labelname}列表。这对再现检查很有用。比如，一个将再次出现的作者和编者用一个类似<idem>的字符串代替的引用样式，可以用\cmd{savefield}命令保存\bibfield{namehash}域，并将其用于后面\cmd{iffieldequals}(见\secref{aut:aux:dat, aut:aux:tst})命令的比较中。\bibfield{namehash}域通过\bibfield{labelname}列表的截短得到，即它的结果与\opt{maxnames}和\opt{minnames}选项相关。另外参见\bibfield{hash}和\bibfield{fullhash}。
	
	A hash string which uniquely identifies the \bibfield{labelname} list. This is useful for recurrence checks. For example, a citation style which replaces recurrent authors or editors with a string like <idem> could save the \bibfield{namehash} field with \cmd{savefield} and use it in a comparison with \cmd{iffieldequals} later (see \secref{aut:aux:dat, aut:aux:tst}). The \bibfield{namehash} is derived from the truncated \bibfield{labelname} list, \ie it is responsive to \opt{maxnames} and \opt{minnames}. See also \bibfield{hash} and \bibfield{fullhash}.
	
	\fielditem{fullhash}{string}
	一个hash字符串用于唯一确定\bibfield{labelname}列表。该域域\bibfield{namehash}有两点不同:1.产生hash时忽略\bibfield{shortauthor}和\bibfield{shorteditor}列表。2.该hash指的是完整的列表，忽略\opt{maxnames}和\opt{minnames}选项。另外见\bibfield{hash}和\bibfield{namehash}。
	
	A hash string which uniquely identifies the \bibfield{labelname} list. This fields differs from \bibfield{namehash} in two details: 1) The \bibfield{shortauthor} and \bibfield{shorteditor} lists are ignored when generating the hash. 2) The hash always refers to the full list, ignoring \opt{maxnames} and \opt{minnames}. See also \bibfield{hash} and \bibfield{namehash}.
	
	\listitem{pageref}{literal}
	如果\opt{backref}包选项打开，该域保存各被引用条目所在页的页码。如果文档中有\env{refsection}环境，反向引用是针对当前参考文献节的。
	
	If the \opt{backref} package option is enabled, this list holds the page numbers of the pages on which the respective bibliography entry is cited. If there are \env{refsection} environments in the document, the back references are local to the reference sections.
	
	\fielditem{sortinit}{literal}
	该域保存用于排序的信息首字符。使用\bibtex 时，该域也用来代替\bibfield{sortinithash}域。
	
	This field holds the initial character of the information used during sorting.
	With \bibtex, this field is also used internally instead of \bibfield{sortinithash}.
	
	\fielditem{sortinithash}{string\BiberOnlyMark}
	
	使用\biber 时，该域保存排序字符串的第一个扩展字素集群(基本上是第一个字符)的Unicode排序规则算法主要权重的hash值。当按照字母表顺序划分参考文献列表时很有用，该域有内部\cmd{bibinitsep}所使用。(见\secref{use:fmt:len})
	
	With \biber, this field holds a hash of the (locale-specific) Unicode Collation Algorithm primary weight of the first extended grapheme cluster (essentially the first character) of the string used during sorting. This is useful when subdividing the bibliography alphabetically and is used internally by \cmd{bibinitsep} (see \secref{use:fmt:len}).
	
	\fielditem{clonesourcekey}{string\BiberOnlyMark}
	该域保存复制条目源条目的关键词。复制条目常用于处理相关条目和\bibfield{related}域。
	This field holds the entry key of the entry from which an entry was cloned. Clones are created for
	entries which are mentioned in \bibfield{related} fields as part of related entry processing, for example.
	
\end{fieldlist}

\paragraph{引用标签中使用的域 Fields for Use in Citation Labels}
\label{aut:bbx:fld:lab}

\begin{fieldlist}
	
	\fielditem{labelalpha}{literal}
	当使用\bibtex 为后端时，生成一个类似于传统\bibtex 的\path{alpha.bst}样式的标签。这一默认标签由抽取\bibfield{labelname}列表的首字母加上出版年的最后两个数字构成。\bibfield{label}域可用来重写它的非数值部分(non"=numeric portion)。如果定义了\bibfield{label}域，\biblatex 将使用它的值加上出版年的后两个数字生成\bibfield{labelalpha}。\bibfield{shorthand}域也可用来重写整个标签。如果定义了该域，\bibfield{labelalpha}就是\bibfield{shorthand}域，而不是一个自动生成的标签。\BiberOnlyMark 使用\biber 时，用户可以定义用来构建字母顺序标签的模板(见\secref{aut:ctm:lab})，而默认的模板域上面bibtex后端使用的格式相同。一个完整的字母顺序(<alphabetic>)标签由以下域构成:
	\bibfield{labelalpha} 加 \bibfield{extraalpha}。注意\bibfield{labelalpha}和 \bibfield{extraalpha}域需要打开包选项 \opt{labelalpha}(\secref{use:opt:pre:int})。另外参见 \bibfield{extraalpha}和 \secref{use:fmt:fmt}的\cmd{labelalphaothers}。
	
	When using \bibtex as the backend, a label similar to the labels generated by the \path{alpha.bst} style of traditional \bibtex. This default label consists of initials drawn from the \bibfield{labelname} list plus the last two digits of the publication year. The \bibfield{label} field may be used to override its non"=numeric portion. If the \bibfield{label} field is defined, \biblatex will use its value and append the last two digits of the publication year when generating \bibfield{labelalpha}. The \bibfield{shorthand} field may be used to override the entire label. If defined, \bibfield{labelalpha} is the \bibfield{shorthand} rather than an automatically generated label. \BiberOnlyMark With \biber, users can specify a template used to construct the alphabetic label (see \secref{aut:ctm:lab}) and the default template mirrors the format mentioned for bibtex above. A complete <alphabetic> label consists of the fields \bibfield{labelalpha} plus \bibfield{extraalpha}. Note that the \bibfield{labelalpha} and \bibfield{extraalpha} fields need to be requested with the package option \opt{labelalpha} (\secref{use:opt:pre:int}). See also \bibfield{extraalpha} as well as \cmd{labelalphaothers} in \secref{use:fmt:fmt}.
	
	\fielditem{extraalpha}{integer}
	当参考文献中包含同一作者同一年出版的多个引文时，<alphabetic>引用格式常需要一个额外的字母加入标签来区分。这种情况下\bibfield{extraalpha}域保存一个整数可用命令 \cmd{mknumalph} 转换成字母或以其他方式格式化。该域类似于在作者年(author"=year)格式中\bibfield{extrayear}的作用。完整的 <alphabetic>的标签由\bibfield{labelalpha} 加 \bibfield{extraalpha}构成。注意\bibfield{labelalpha}和 \bibfield{extraalpha}域需要打开包选项 \opt{labelalpha}(详见\secref{use:opt:pre:int})。另外参见 \bibfield{labelalpha}和 \secref{use:fmt:fmt}的\cmd{labelalphaothers}。表\ref{use:opt:tab1}总结了不同的\opt{extra*}非歧义计数器和他们追踪的信息。
	
	The <alphabetic> citation scheme usually requires a letter to be appended to the label if the bibliography contains two or more works by the same author which were all published in the same year. In this case, the \bibfield{extraalpha} field holds an integer which may be converted to a letter with \cmd{mknumalph} or formatted in some other way. This field is similar to the role of \bibfield{extrayear} in the author"=year scheme. A complete <alphabetic> label consists of the fields \bibfield{labelalpha} plus \bibfield{extraalpha}. Note that the \bibfield{labelalpha} and \bibfield{extraalpha} fields need to be requested with the package option \opt{labelalpha}, see \secref{use:opt:pre:int} for details. See also \bibfield{labelalpha} as well as \cmd{labelalphaothers} in \secref{use:fmt:fmt}. Table \ref{use:opt:tab1} summarises the various \opt{extra*} disambiguation counters and what they track.
	
	\listitem{labelname}{name}
	引用中打印的姓名。该列表可以是\bibfield{shortauthor}, \bibfield{author},  \bibfield{shorteditor}, \bibfield{editor}, 或\bibfield{translator}域的
	复制值，正常情况以该顺序检测。如果没有作者(authors)和编者(authors)，该列表时未定义的。注意该列表也与\opt{use$<$name$>$}相关，见\secref{use:opt:bib}。引用样式打印引用中的姓名时使用这一列表。提供该列表仅为方便起见，没有附加的意义。\BiberOnlyMark 使用\biber 时，该域可以定制，详见\secref{aut:ctm:fld}。

The name to be printed in citations. This list is a copy of either the \bibfield{shortauthor}, the \bibfield{author}, the \bibfield{shorteditor}, the \bibfield{editor}, or the \bibfield{translator} list, which are normally checked for in this order. If no authors and editors are available, this list is undefined. Note that this list is also responsive to the \opt{use$<$name$>$}, options, see \secref{use:opt:bib}. Citation styles should use this list when printing the name in a citation. This list is provided for convenience only and does not carry any additional meaning.
\BiberOnlyMark With \biber, this field may be customized. See \secref{aut:ctm:fld} for details.

\fielditem{labelnumber}{literal}

The number of the bibliography entry, as required by numeric citation schemes. If the \bibfield{shorthand} field is defined, \biblatex does not assign a number to the respective entry. In this case \bibfield{labelnumber} is the shorthand rather than a number. Numeric styles must use the value of this field instead of a counter. Note that this field needs to be requested with the package option \opt{labelnumber}, see \secref{use:opt:pre:int} for details. Also see the package option \opt{defernumbers} in \secref{use:opt:pre:gen}.

\fielditem{prefixnumber}{literal}

If the \opt{prefixnumbers} option of \cmd{printbibliography} has been set in order to prefix all entries in a subbibliography with a fixed string, this string is available in the \bibfield{prefixnumber} field of all affected entries. If no prefix has been set, the \bibfield{prefixnumber} field of the respective entry is undefined. See the \opt{prefixnumbers} option of \cmd{printbibliography} in \secref{use:bib:bib} for details. If the \bibfield{shorthand} field is defined, \biblatex does not assign the prefix to the \bibfield{prefixnumber} field of the respective entry. In this case, the \bibfield{prefixnumber} field is undefined.

\fielditem{labeltitle}{literal}

The printable title of a work. In some circumstances, a style might need to choose a title from a list of a possible title fields. For example, citation styles printing short titles may want to print the \bibfield{shorttitle} field if it exists but otherwise print the \bibfield{title} field. \BiberOnlyMark The list of fields to be considered when constructing \bibfield{labeltitle} may be customized. See \secref{aut:ctm:fld} for details. Note that the \bibfield{extratitle} field needs to be requested with the package option \opt{labeltitle}, see \secref{use:opt:pre:int} for details. See also \bibfield{extratitle}. Note also that the \bibfield{extratitleyear} field needs to be requested with the package option \opt{labeltitleyear}. See also \bibfield{extratitleyear}.

\fielditem{extratitle}{integer}

It is sometimes useful, for example in author"=title citation schemes, to be able to disambiguate works with the same title. For works by the same \bibfield{labelname} with the same \bibfield{labeltitle}, the \bibfield{extratitle} field holds an integer which may be converted to a letter with \cmd{mknumalph} or formatted in some other way (or it can be merely used as a flag to say that some other field such as a date should be used in conjunction with the \bibfield{labeltitle} field). This field is undefined if there is only one work with the same \bibfield{labeltitle} by the same \bibfield{labelname} in the bibliography. Note that the \bibfield{extratitle} field needs to be requested with the package option \opt{labeltitle}, see \secref{use:opt:pre:int} for details. See also \bibfield{labeltitle}. Table \ref{use:opt:tab1} summarises the various \opt{extra*} disambiguation counters and what they track.

\fielditem{extratitleyear}{integer}

It is sometimes useful, for example in author"=title citation schemes, to be able to disambiguate works with the same title in the same year but with no author. For works with the same \bibfield{labeltitle} and with the same \bibfield{labelyear}, the \bibfield{extratitleyear} field holds an integer which may be converted to a letter with \cmd{mknumalph} or formatted in some other way (or it can be merely used as a flag to say that some other field such as a publisher should be used in conjunction with the \bibfield{labelyear} field). This field is undefined if there is only one work with the same \bibfield{labeltitle} and \bibfield{labelyear} in the bibliography. Note that the \bibfield{extratitleyear} field needs to be requested with the package option \opt{labeltitleyear}, see \secref{use:opt:pre:int} for details. See also \bibfield{labeltitleyear}. Table \ref{use:opt:tab1} summarises the various \opt{extra*} disambiguation counters and what they track.

\fielditem{labelyear}{literal}

The publication year, as specified in the \bibfield{date} or the \bibfield{year} field, for use in author-year labels. A complete author-year label consists of the fields \bibfield{labelyear} plus \bibfield{extrayear}. Note that the \bibfield{labelyear} and \bibfield{extrayear} fields need to be requested with the package option \opt{labeldate}, see \secref{use:opt:pre:int} for details. See also \bibfield{extrayear}.
\BiberOnlyMark With \biber, the source date field for this may be customized. See \secref{aut:ctm:fld} for details.

\fielditem{labelmonth}{datepart}

The publication month, as specified in the \bibfield{date} or the \bibfield{month} field, for use in author-year labels. Note that the \bibfield{labelmonth} field needs to be requested with the package option \opt{labeldate}, see \secref{use:opt:pre:int} for details.
\BiberOnlyMark With \biber, the source date field for this may be customized. See \secref{aut:ctm:fld} for details.

\fielditem{labelday}{datepart}

The publication day, as specified in the \bibfield{date}, for use in author-year labels. Note that the \bibfield{labelday} field needs to be requested with the package option \opt{labeldate}, see \secref{use:opt:pre:int} for details.
\BiberOnlyMark With \biber, the source date field for this may be customized. See \secref{aut:ctm:fld} for details.

\fielditem{extrayear}{integer}

The author"=year citation scheme usually requires a letter to be appended to the year if the bibliography contains two or more works by the same author which were all published in the same year. In this case, the \bibfield{extrayear} field holds an integer which may be converted to a letter with \cmd{mknumalph} or formatted in some other way. This field is undefined if there is only one work by the author in the bibliography or if all works by the author have different publication years. A complete author-year label consists of the fields \bibfield{labelyear} plus \bibfield{extrayear}. Note that the \bibfield{labelyear} and \bibfield{extrayear} fields need to be requested with the package option \opt{labeldate}, see \secref{use:opt:pre:int} for details. See also \bibfield{labelyear}. Table \ref{use:opt:tab1} summarises the various \opt{extra*} disambiguation counters and what they track.

\end{fieldlist}

\paragraph{date的分解域 Date Component Fields}
\label{aut:bbx:fld:dat}

See \tabref{aut:bbx:fld:tab1} for an overview of how the date fields in \file{bib} files are related to the date fields provided by the style interface. When testing for a field like \bibfield{origdate} in a style, use code like:

\begin{ltxcode}
<<\iffieldundef>>{orig<<year>>}{...}{...}
\end{ltxcode}
%
This will tell you if the corresponding date is defined at all. This test:

\begin{ltxcode}
<<\iffieldundef>>{orig<<endyear>>}{...}{...}
\end{ltxcode}
%
will tell you if the corresponding date is defined and a (fully specified) range. This test:

\begin{ltxcode}
<<\iffieldequalstr>>{orig<<endyear>>}{}{...}{...}
\end{ltxcode}
%
will tell you if the corresponding date is defined and an open"=ended range. Open"=ended ranges are indicated by an empty \texttt{endyear} component (as opposed to an undefined \texttt{endyear} component). See \secref{bib:use:dat} and \tabref{bib:use:tab1} on page~\pageref{bib:use:tab1} for further examples.

\begin{table}
\tablesetup
\begin{tabularx}{\textwidth}{@{}>{\ttfamily}lX>{\ttfamily}lX@{}}
\toprule
\multicolumn{2}{@{}H}{\file{bib} File} &
\multicolumn{2}{H}{Data Interface} \\
\cmidrule(r){1-2}\cmidrule(l){3-4}
\multicolumn{1}{@{}H}{Field} &
\multicolumn{1}{H}{Value (Example)} &
\multicolumn{1}{H}{Field} &
\multicolumn{1}{H}{Value (Example)} \\
\cmidrule{1-1}\cmidrule(lr){2-2}\cmidrule(l){3-3}\cmidrule(l){4-4}
date		& 1988			& day		& undefined \\
		&			& month		& undefined \\
		&			& year		& 1988 \\
		&			& endday	& undefined \\
		&			& endmonth	& undefined \\
		&			& endyear	& undefined \\
date		& 1997/			& day		& undefined \\
		&			& month		& undefined \\
		&			& year		& 1997 \\
		&			& endday	& undefined \\
		&			& endmonth	& undefined \\
		&			& endyear	& empty \\
urldate		& 2009-01-31		& urlday	& 31 \\
		&			& urlmonth	& 01 \\
		&			& urlyear	& 2009 \\
		&			& urlendday	& undefined \\
		&			& urlendmonth	& undefined \\
		&			& urlendyear	& undefined \\
origdate	& 2002-01/2002-02	& origday	& undefined \\
		&			& origmonth	& 01 \\
		&			& origyear	& 2002 \\
		&			& origendday	& undefined \\
		&			& origendmonth	& 02 \\
		&			& origendyear	& 2002 \\
eventdate	& 1995-01-31/1995-02-05	& eventday	& 31 \\
		&			& eventmonth	& 01 \\
		&			& eventyear	& 1995 \\
		&			& eventendday	& 05 \\
		&			& eventendmonth	& 02 \\
		&			& eventendyear	& 1995 \\
\bottomrule
\end{tabularx}
\caption{Date Interface}
\label{aut:bbx:fld:tab1}
\end{table}

\begin{fieldlist}

\fielditem{day}{datepart}

This field holds the day component of the \bibfield{date} field. If the date is a range, it holds the day component of the start date.

\fielditem{month}{datepart}

This field is the \bibfield{month} as given in the database file or it holds the month component of the \bibfield{date} field. If the date is a range, it holds the month component of the start date.

\fielditem{year}{datepart}

This field is the \bibfield{year} as given in the database file or it holds the year component of the \bibfield{date} field. If the date is a range, it holds the year component of the start date.

\fielditem{endday}{datepart}

If the date specification in the \bibfield{date} field is a range, this field holds the day component of the end date.

\fielditem{endmonth}{datepart}

If the date specification in the \bibfield{date} field is a range, this field holds the month component of the end date.

\fielditem{endyear}{datepart}

If the date specification in the \bibfield{date} field is a range, this field holds the year component of the end date. A blank (but defined) \bibfield{endyear} component indicates an open ended \bibfield{date} range.

\fielditem{origday}{datepart}

This field holds the day component of the \bibfield{origdate} field. If the date is a range, it holds the day component of the start date.

\fielditem{origmonth}{datepart}

This field holds the month component of the \bibfield{origdate} field. If the date is a range, it holds the month component of the start date.

\fielditem{origyear}{datepart}

This field holds the year component of the \bibfield{origdate} field. If the date is a range, it holds the year component of the start date.

\fielditem{origendday}{datepart}

If the date specification in the \bibfield{origdate} field is a range, this field holds the day component of the end date.

\fielditem{origendmonth}{datepart}

If the date specification in the \bibfield{origdate} field is a range, this field holds the month component of the end date.

\fielditem{origendyear}{datepart}

If the date specification in the \bibfield{origdate} field is a range, this field holds the year component of the end date. A blank (but defined) \bibfield{origendyear} component indicates an open ended \bibfield{origdate} range.

\fielditem{eventday}{datepart}

This field holds the day component of the \bibfield{eventdate} field. If the date is a range, it holds the day component of the start date.

\fielditem{eventmonth}{datepart}

This field holds the month component of the \bibfield{eventdate} field. If the date is a range, it holds the month component of the start date.

\fielditem{eventyear}{datepart}

This field holds the year component of the \bibfield{eventdate} field. If the date is a range, it holds the year component of the start date.

\fielditem{eventendday}{datepart}

If the date specification in the \bibfield{eventdate} field is a range, this field holds the day component of the end date.

\fielditem{eventendmonth}{datepart}

If the date specification in the \bibfield{eventdate} field is a range, this field holds the month component of the end date.

\fielditem{eventendyear}{datepart}

If the date specification in the \bibfield{eventdate} field is a range, this field holds the year component of the end date. A blank (but defined) \bibfield{eventendyear} component indicates an open ended \bibfield{eventdate} range.

\fielditem{urlday}{datepart}

This field holds the day component of the \bibfield{urldate} field.

\fielditem{urlmonth}{datepart}

This field holds the month component of the \bibfield{urldate} field.

\fielditem{urlyear}{datepart}

This field holds the year component of the \bibfield{urldate} field.

\fielditem{urlendday}{datepart}

If the date specification in the \bibfield{urldate} field is a range, this field holds the day component of the end date.

\fielditem{urlendmonth}{datepart}

If the date specification in the \bibfield{urldate} field is a range, this field holds the month component of the end date.

\fielditem{urlendyear}{datepart}

If the date specification in the \bibfield{urldate} field is a range, this field holds the year component of the end date. A blank (but defined) \bibfield{urlendyear} component indicates an open ended \bibfield{urldate} range.

\end{fieldlist}

\subsection{标注样式 Citation Styles}
\label{aut:cbx}
标注样式是诸如\cmd{cite}等用于打印不同类型标注的命令集。这些样式定义在后缀为\file{cbx}的文件中。\biblatex 在包末尾加载它们。注意:一些标准标注样式所共享的常用的宏集在\path{biblatex.def}文件中。这一文件也再包末尾加载，先于选择的标注样式。它也包含来自\secref{use:cit:txt}节的命令的定义。
%A citation style is a set of commands such as \cmd{cite} which print different types of citations. Such styles are defined in files with the suffix \file{cbx}. The \biblatex package loads the selected citation style file at the end of the package. Note that a small repertory of frequently used macros shared by several of the standard citation styles is also included in \path{biblatex.def}. This file is loaded at the end of the package as well, prior to the selected citation style. It also contains the definitions of the commands from \secref{use:cit:txt}.

\subsubsection{标注样式文件 Citation Style Files}
\label{aut:cbx:cbx}
在讨论标注样式文件提供的各个命令前，考虑如下一个典型的\file{cbx}文件的整体结构:
%Before we go over the individual commands available in citation style files, consider this example of the overall structure of a typical \file{cbx} file:

\begin{ltxexample}
\ProvidesFile{example.cbx}[2006/03/15 v1.0 biblatex citation style]

\DeclareCiteCommand{\cite}{...}{...}{...}{...}
\DeclareCiteCommand{\parencite}[\mkbibparens]{...}{...}{...}{...}
\DeclareCiteCommand{\footcite}[\mkbibfootnote]{...}{...}{...}{...}
\DeclareCiteCommand{\textcite}{...}{...}{...}{...}
\endinput
\end{ltxexample}

\begin{ltxsyntax}

\cmditem{RequireCitationStyle}{style}

这个命令是可选的，用于在一些更一般的样式基础上构建特殊的标注样式。它加载标注样式\path{style.cbx}。
%This command is optional and intended for specialized citation styles built on top of a more generic style. It loads the citation style \path{style.cbx}.

\cmditem{InitializeCitationStyle}{code}

指定初始化或重设标注样式需要的任意\prm{code}。这个钩子将在包加载的时候执行一次，并且每次都使用\secref{use:cit:msc}节的\cmd{citereset}命令。\cmd{citereset}命令也重设本宏包的内部标注追踪器。它会影响\secref{aut:aux:tst}节中列出的\ cmd{ifciteseen}, \cmd{ifentryseen}, \cmd{ifciteibid}, 和\cmd{ifciteidem}等判断。当使用\env{refsection}环境时，标注追踪器重设当前的\env{refsection}局部环境。
%Specifies arbitrary \prm{code} required to initialize or reset the citation style. This hook will be executed once at package load-time and every time the \cmd{citereset} command from \secref{use:cit:msc} is used. The \cmd{citereset} command also resets the internal citation trackers of this package. The reset will affect the \cmd{ifciteseen}, \cmd{ifentryseen}, \cmd{ifciteibid}, and \cmd{ifciteidem} tests discussed in \secref{aut:aux:tst}. When used in a \env{refsection} environment, the reset of the citation tracker is local to the current \env{refsection} environment.

\cmditem{OnManualCitation}{code}
指定标注样式部分重设需要的任意\prm{code}。这一钩子将在\secref{use:cit:msc}中的\cmd{mancite}命令使用时调用。它有时特别有用，可以代替像 <ibidem>或<op. cit.>等缩写表示的重复标注，因为当自动生成和人工产生的标注混合使用的时候这些缩写可能会有歧义。\cmd{mancite}命令也会重设宏包的内部<ibidem>和<idem>追踪器，进而影响\secref{aut:aux:tst}讨论的\cmd{ifciteibid}和\cmd{ifciteidem}判断。
%Specifies arbitrary \prm{code} required for a partial reset of the citation style. This hook will be executed every time the \cmd{mancite} command from \secref{use:cit:msc} is used. It is particularly useful in citation styles which replace repeated citations by abbreviations like <ibidem> or <op. cit.> which may get ambiguous if automatically generated and manual citations are mixed. The \cmd{mancite} command also resets the internal <ibidem> and <idem> trackers of this package. The reset will affect the \cmd{ifciteibid} and \cmd{ifciteidem} tests discussed in \secref{aut:aux:tst}.

\cmditem{DeclareCiteCommand}{command}[wrapper]{precode}{loopcode}{sepcode}{postcode} \cmditem*{DeclareCiteCommand*}{command}[wrapper]{precode}{loopcode}{sepcode}{postcode}

This is the core command used to define all citation commands. It takes one optional and five mandatory arguments. The \prm{command} is the command to be defined, for example \cmd{cite}. If the optional \prm{wrapper} argument is given, the entire citation will be passed to the \prm{wrapper} as an argument, \ie the wrapper command must take one mandatory argument.\footnote{Typical examples of wrapper commands are \cmd{mkbibparens} and \cmd{mkbibfootnote}.} The \prm{precode} is arbitrary code to be executed at the beginning of the citation. It will typically handle the \prm{prenote} argument which is available in the \bibfield{prenote} field. It may also be used to initialize macros required by the \prm{loopcode}. The \prm{loopcode} is arbitrary code to be executed for each entry key passed to the \prm{command}. This is the core code which prints the citation labels or any other data. The \prm{sepcode} is arbitrary code to be executed after each iteration of the \prm{loopcode}. It will only be executed if a list of entry keys is passed to the \prm{command}. The \prm{sepcode} will usually insert some kind of separator, such as a comma or a semicolon. The \prm{postcode} is arbitrary code to be executed at the end of the citation. The \prm{postcode} will typically handle the \prm{postnote} argument which is available in the \bibfield{postnote} field.\footnote{The bibliographic data available to the \prm{loopcode} is the data of the entry currently being processed. In addition to that, the data of the first entry is available to the \prm{precode} and the data of the last one is available to the \prm{postcode}. <First> and <last> refer to the order in which the citations are printed. If the \opt{sortcites} package option is active, this is the order of the list after sorting. Note that no bibliographic data is available to the \prm{sepcode}.} The starred variant of \cmd{DeclareCiteCommand} defines a starred \prm{command}. For example, |\DeclareCiteCommand*{cite}| would define |\cite*|.\footnote{Note that the regular variant of \cmd{DeclareCiteCommand} defines a starred version of the \prm{command} implicitly, unless the starred version has been defined before. This is intended as a fallback. The implicit definition is an alias for the regular variant.}

\cmditem{DeclareMultiCiteCommand}{command}[wrapper]{cite}{delimiter}

This command defines <multicite> commands (\secref{use:cit:mlt}). The \prm{command} is the multicite command to be defined, for example \cmd{cites}. It is automatically made robust. Multicite commands are built on top of backend commands defined with \cmd{DeclareCiteCommand} and the \prm{cite} argument specifies the name of the backend command to be used. Note that the wrapper of the backend command (\ie the \prm{wrapper} argument passed to \cmd{DeclareCiteCommand}) is ignored. Use the optional \prm{wrapper} argument to specify an alternative wrapper. The \prm{delimiter} is the string to be printed as a separator between the individual citations in the list. This will typically be \cmd{multicitedelim}. The following examples are real definitions taken from \path{biblatex.def}:

\begin{lstlisting}[style=latex]{}
\DeclareMultiCiteCommand{\cites}%
	{\cite}{\multicitedelim}
\DeclareMultiCiteCommand{\parencites}[\mkbibparens]%
	{\parencite}{\multicitedelim}
\DeclareMultiCiteCommand{\footcites}[\mkbibfootnote]%
	{\footcite}{\multicitedelim}
\end{lstlisting}

\cmditem{DeclareAutoCiteCommand}{name}[position]{cite}{multicite}

This command provides definitions for the \cmd{autocite} and \cmd{autocites} commands from \secref{use:cit:aut}. The definitions are enabled with the \opt{autocite} package option from \secref{use:opt:pre:gen}. The \prm{name} is an identifier which serves as the value passed to the package option. The autocite commands are built on top of backend commands like \cmd{parencite} and \cmd{parencites}. The arguments \prm{cite} and \prm{multicite} specify the backend commands to use. The \prm{cite} argument refers to \cmd{autocite} and \prm{multicite} refers to \cmd{autocites}. The \prm{position} argument controls the handling of any punctuation marks after the citation. Possible values are \texttt{l}, \texttt{r}, \texttt{f}. \texttt{r} means that the punctuation is placed to the right of the citation, \ie it will not be moved around. \texttt{l} means that any punctuation after the citation is moved to the left of the citation. \texttt{f} is like \texttt{r} in a footnote and like \texttt{l} otherwise. This argument is optional and defaults to \texttt{r}. See also \cmd{DeclareAutoPunctuation} in \secref{aut:pct:cfg} and the \opt{autopunct} package option in \secref{use:opt:pre:gen}. The following examples are real definitions taken from \path{biblatex.def}:

\begin{lstlisting}[style=latex]{}
\DeclareAutoCiteCommand{plain}{\cite}{\cites}
\DeclareAutoCiteCommand{inline}{\parencite}{\parencites}
\DeclareAutoCiteCommand{footnote}[l]{\footcite}{\footcites}
\DeclareAutoCiteCommand{footnote}[f]{\smartcite}{\smartcites}
\end{lstlisting}
%
A definition provided in the document preamble can be subsequently adopted with the following: (see \secref{use:cfg:opt}).

\begin{ltxexample}
\ExecuteBibliographyOptions{autocite=<<name>>}
\end{ltxexample}

\end{ltxsyntax}

\subsubsection{特殊域 Special Fields}
\label{aut:cbx:fld}

The following fields are used by \biblatex to pass data to citation commands. They are not used in \file{bib} files but defined automatically by the package. From the perspective of a citation style, they are not different from the fields in a \file{bib} file. See also \secref{aut:bbx:fld}.

\begin{fieldlist}

\fielditem{prenote}{literal}

The \prm{prenote} argument passed to a citation command. This field is specific to citations and not available in the bibliography. If the \prm{prenote} argument is missing or empty, this field is undefined.

\fielditem{postnote}{literal}

The \prm{postnote} argument passed to a citation command. This field is specific to citations and not available in the bibliography. If the \prm{postnote} argument is missing or empty, this field is undefined.

\fielditem{multiprenote}{literal}

The \prm{multiprenote} argument passed to a multicite command. This field is specific to citations and not available in the bibliography. If the \prm{multiprenote} argument is missing or empty, this field is undefined.

\fielditem{multipostnote}{literal}

The \prm{multipostnote} argument passed to a multicite command. This field is specific to citations and not available in the bibliography. If the \prm{multipostnote} argument is missing or empty, this field is undefined.

\fielditem{postpunct}{punctuation command}

The trailing punctuation argument implicitly passed to a citation command. This field is specific to citations and not available in the bibliography. If the character following a given citation command is not specified in \cmd{DeclareAutoPunctuation} (\secref{aut:pct:cfg}), this field is undefined.

\end{fieldlist}

\subsection{数据接口 Data Interface}
\label{aut:bib}

The data interface are the facilities used to format and print all bibliographic data. These facilities are available in both bibliography and citation styles.

\subsubsection{数据命令 Data Commands}
\label{aut:bib:dat}

This section introduces the main data interface of the \biblatex package. These are the commands doing most of the work, \ie they actually print the data provided in lists and fields.

\begin{ltxsyntax}

\cmditem{printfield}[format]{field}

This command prints a \prm{field} using the formatting directive \prm{format}, as defined with \cmd{DeclareFieldFormat}. If a type"=specific \prm{format} has been declared, the type"=specific formatting directive takes precedence over the generic one. If the \prm{field} is undefined, nothing is printed. If the \prm{format} is omitted, \cmd{printfield} tries using the name of the field as a format name. For example, if the \bibfield{title} field is to be printed and the \prm{format} is not specified, it will try to use the field format \texttt{title}.\footnote{In other words, \texttt{\textbackslash printfield\{title\}} is equivalent to \texttt{\textbackslash printfield[title]\{title\}}.} In this case, any type"=specific formatting directive will also take precedence over the generic one. If all of these formats are undefined, it falls back to \texttt{default} as a last resort. Note that \cmd{printfield} provides the name of the field currently being processed in \cmd{currentfield} for use in field formatting directives.

\cmditem{printlist}[format][start\ensuremath\rangle--\ensuremath\langle stop]{literal list}

This command loops over all items in a \prm{literal list}, starting at item number \prm{start} and stopping at item number \prm{stop}, including \prm{start} and \prm{stop} (all lists are numbered starting at~1). Each item is printed using the formatting directive \prm{format}, as defined with \cmd{DeclareListFormat}. If a type"=specific \prm{format} has been declared, the type"=specific formatting directive takes precedence over the generic one. If the \prm{literal list} is undefined, nothing is printed. If the \prm{format} is omitted, \cmd{printlist} tries using the name of the list as a format name. In this case, any type"=specific formatting directive will also take precedence over the generic one. If all of these formats are undefined, it falls back to \texttt{default} as a last resort. The \prm{start} argument defaults to 1; \prm{stop} defaults to the total number of items in the list. If the total number is greater than \prm{maxitems}, \prm{stop} defaults to \prm{minitems} (see \secref{use:opt:pre:gen}). See \cmd{printnames} for further details. Note that \cmd{printlist} provides the name of the literal list currently being processed in \cmd{currentlist} for use in list formatting directives.

\cmditem{printnames}[format][start\ensuremath\rangle--\ensuremath\langle stop]{name list}

This command loops over all items in a \prm{name list}, starting at item number \prm{start} and stopping at item number \prm{stop}, including \prm{start} and \prm{stop} (all lists are numbered starting at~1). Each item is printed using the formatting directive \prm{format}, as defined with \cmd{DeclareNameFormat}. If a type"=specific \prm{format} has been declared, the type"=specific formatting directive takes precedence over the generic one. If the \prm{name list} is undefined, nothing is printed. If the \prm{format} is omitted, \cmd{printnames} tries using the name of the list as a format name. In this case, any type"=specific formatting directive will also take precedence over the generic one. If all of these formats are undefined, it falls back to \texttt{default} as a last resort. The \prm{start} argument defaults to 1; \prm{stop} defaults to the total number of items in the list. If the total number is greater than \prm{maxnames}, \prm{stop} defaults to \prm{minnames} (see \secref{use:opt:pre:gen}). If you want to select a range but use the default list format, the first optional argument must still be given, but is left empty:

\begin{lstlisting}[style=latex]{}
\printnames[][1-3]{...}
\end{lstlisting}

One of \prm{start} and \prm{stop} may be omitted, hence the following arguments are all valid:

\begin{lstlisting}[style=latex]{}
\printnames[...][-1]{...}
\printnames[...][2-]{...}
\printnames[...][1-3]{...}
\end{lstlisting}

If you want to override \prm{maxnames} and \prm{minnames} and force printing of the entire list, you may refer to the \cnt{listtotal} counter in the second optional argument:

\begin{lstlisting}[style=latex]{}
\printnames[...][-\value{listtotal}]{...}
\end{lstlisting}

Whenever \cmd{printnames} and \cmd{printlist} process a list, information concerning the current state is accessible by way of four counters: the \cnt{listtotal} counter holds the total number of items in the current list, \cnt{listcount} holds the number of the item currently being processed, \cnt{liststart} is the \prm{start} argument passed to \cmd{printnames} or \cmd{printlist}, \cnt{liststop} is the \prm{stop} argument. These counters are intended for use in list formatting directives. \cnt{listtotal} may also be used in the second optional argument to \cmd{printnames} and \cmd{printlist}. Note that these counters are local to list formatting directives and do not hold meaningful values when used anywhere else. For every list, there is also a counter by the same name which holds the total number of items in the corresponding list. For example, the \cnt{author} counter holds the total number of items in the \bibfield{author} list. These counters are similar to \cnt{listtotal} except that they may also be used independently of list formatting directives. There are also \cnt{maxnames} and \cnt{minnames} as well as \cnt{maxitems} and \cnt{minitems} counters which hold the values of the corresponding package options. See \secref{aut:fmt:ilc} for a complete list of such internal counters. Note that \cmd{printnames} provides the name of the name list currently being processed in \cmd{currentname} for use in name formatting directives.

\cmditem{printtext}[format]{text}
该命令用于打印\prm{text}，可以是可打印的文本或者任意产生可打印文本的代码。它清除插入\prm{text}之前的标点缓存并且通知\biblatex 打印文本已经插入。这保证了所有之前和之后的\cmd{newblock}和\cmd{newunit}命令能产生期望的作用。\cmd{printfield}、\cmd{printnames} 、\cmd{bibstring}及其相关命令都这般自动处理(见\secref{aut:str})。如果一个参考文献样式需要如实插入文本（包括来自\secref{aut:pct:pct, aut:pct:spc}的命令），需要使用该命令来确保block 和unit标点在\secref{aut:pct:new}节中所述正常功能。可选参数\prm{format}指定一个域格式指令用于格式化\prm{text}。当需要把若干个域打印为某一格式的集合块，这就会很有用，比如把集合块用括号或引号包起来。如果声明了type"=specific的格式指令，则覆盖设置的一般格式指令。如果\prm{format}缺省，那么\prm{text}如实输出(原样打印)。更多实用细节见第\secref{aut:cav:pct}节。

%This command prints \prm{text}, which may be printable text or arbitrary code generating printable text. It clears the punctuation buffer before inserting \prm{text} and informs \biblatex that printable text has been inserted. This ensures that all preceding and following \cmd{newblock} and \cmd{newunit} commands have the desired effect. \cmd{printfield} and \cmd{printnames} as well as \cmd{bibstring} and its companion commands (see \secref{aut:str}) do that automatically. Using this command is required if a bibliography styles inserts literal text (including the commands from \secref{aut:pct:pct, aut:pct:spc}) to ensure that block and unit punctuation works as advertised in \secref{aut:pct:new}. The optional \prm{format} argument specifies a field formatting directive to be used to format \prm{text}. This may also be useful when several fields are to be printed as one chunk, for example, by enclosing the entire chunk in parentheses or quotation marks. If a type"=specific \prm{format} has been declared, the type"=specific formatting directive takes precedence over the generic one. If the \prm{format} is omitted, the \prm{text} is printed as is. See also \secref{aut:cav:pct} for some practical hints.

\cmditem{printfile}[format]{file}

This command is similar to \cmd{printtext} except that the second argument is a file name rather than literal text. The \prm{file} argument must be the name of a valid \latex file found in \tex's search path. \cmd{printfile} will use \cmd{input} to load this \prm{file}. If there is no such file, \cmd{printfile} does nothing. The optional \prm{format} argument specifies a field formatting directive to be applied to the \prm{file}. If a type"=specific \prm{format} has been declared, the type"=specific formatting directive takes precedence over the generic one. If the \prm{format} is omitted, the \prm{file} is printed as is. Note that this feature needs to be enabled explicitly by setting the package option \opt{loadfiles} from \secref{use:opt:pre:gen}. By default, \cmd{printfile} will not input any files.

\csitem{printdate}

This command prints the date of the entry, as specified in the fields \bibfield{date} or \bibfield{month}\slash \bibfield{year}. The date format is controlled by the package option \opt{date} from \secref{use:opt:pre:gen}. Additional formatting (fonts etc.) may be applied by adjusting the field format \texttt{date} (\secref{aut:fmt:ich}). Note that this command interfaces with the punctuation tracker. There is no need to wrap it in a \cmd{printtext} command.

\csitem{printdateextra}

Similar to \cmd{printdate} but incorporates the \bibfield{extrayear} field in the date specification. This is useful for bibliography styles designed for author-year citations.

\csitem{printdatelabel}

Similar to \cmd{printdate} but prints the date field determined by \cmd{DeclareLabeldate}. The date format is controlled by the package option \opt{datelabel} from \secref{use:opt:pre:gen}. Additional formatting may be applied by adjusting the field format \texttt{datelabel} (\secref{aut:fmt:ich}).

\csitem{printdateextralabel}

Similar to \cmd{printdatelabel} but incorporates the \bibfield{extrayear} field in the date specification. This is useful for bibliography styles designed for author-year citations.

\csitem{printurldate}

Similar to \cmd{printdate} but prints the \bibfield{urldate} of the entry. The date format is controlled by the package option \opt{urldate} from \secref{use:opt:pre:gen}. Additional formatting may be applied by adjusting the field format \texttt{urldate} (\secref{aut:fmt:ich}).

\csitem{printorigdate}

Similar to \cmd{printdate} but prints the \bibfield{origdate} of the entry. The date format is controlled by the package option \opt{origdate} from \secref{use:opt:pre:gen}. Additional formatting may be applied by adjusting the field format \texttt{origdate} (\secref{aut:fmt:ich}).

\csitem{printeventdate}

Similar to \cmd{printdate} but prints the \bibfield{eventdate} of the entry. The date format is controlled by the package option \opt{eventdate} from \secref{use:opt:pre:gen}. Additional formatting may be applied by adjusting the field format \texttt{eventdate} (\secref{aut:fmt:ich}).

\cmditem{indexfield}[format]{field}

This command is similar to \cmd{printfield} except that the \prm{field} is not printed but added to the index using the formatting directive \prm{format}, as defined with \cmd{DeclareIndexFieldFormat}. If a type"=specific \prm{format} has been declared, it takes precedence over the generic one. If the \prm{field} is undefined, this command does nothing. If the \prm{format} is omitted, \cmd{indexfield} tries using the name of the field as a format name. In this case, any type"=specific formatting directive will also take precedence over the generic one. If all of these formats are undefined, it falls back to \texttt{default} as a last resort.

\cmditem{indexlist}[format][start\ensuremath\rangle--\ensuremath\langle stop]{literal list}

This command is similar to \cmd{printlist} except that the items in the list are not printed but added to the index using the formatting directive \prm{format}, as defined with \cmd{DeclareIndexListFormat}. If a type"=specific \prm{format} has been declared, the type"=specific formatting directive takes precedence over the generic one. If the \prm{literal list} is undefined, this command does nothing. If the \prm{format} is omitted, \cmd{indexlist} tries using the name of the list as a format name. In this case, any type"=specific formatting directive will also take precedence over the generic one. If all of these formats are undefined, it falls back to \texttt{default} as a last resort.

\cmditem{indexnames}[format][start\ensuremath\rangle--\ensuremath\langle stop]{name list}

This command is similar to \cmd{printnames} except that the items in the list are not printed but added to the index using the formatting directive \prm{format}, as defined with \cmd{DeclareIndexNameFormat}. If a type"=specific \prm{format} has been declared, the type"=specific formatting directive takes precedence over the generic one. If the \prm{name list} is undefined, this command does nothing. If the \prm{format} is omitted, \cmd{indexnames} tries using the name of the list as a format name. In this case, any type"=specific formatting directive will also take precedence over the generic one. If all of these formats are undefined, it falls back to \texttt{default} as a last resort.

\cmditem{entrydata}{key}{code}
\cmditem*{entrydata*}{key}{code}

Data commands like \cmd{printfield} normally use the data of the entry currently being processed. You may use \cmd{entrydata} to switch contexts locally. The \prm{key} is the entry key of the entry to use locally. The \prm{code} is arbitrary code to be executed in this context. This code will be executed in a group. See \secref{aut:cav:mif} for an example. Note that this command will automatically switch languages if the \opt{autolang} package option is enabled. The starred version \cmd{entrydata*} will clone all fields of the enclosing entry, using field, counter, and other resource names prefixed with the string <\texttt{saved}>. This is useful when comparing two data sets. For example, inside the \prm{code} argument, the \bibfield{author} field holds the author of entry \prm{key} and the author of the enclosing entry is available as \bibfield{savedauthor}. The \cnt{author} counter holds the number of names in the \bibfield{author} field of \prm{key}; the \bibfield{savedauthor} counter refers to the author count of the enclosing entry.

\cmditem{entryset}{precode}{postcode}

This command is intended for use in bibliography drivers handling \bibtype{set} entries. It will loop over all members of the set, as indicated by the \bibfield{entryset} field, and execute the appropriate driver for the respective set member. This is similar to executing the \cmd{usedriver} command from \secref{aut:aux:msc} for each set member. The \prm{precode} is arbitrary code to be executed prior to processing each item in the set. The \prm{postcode} is arbitrary code to be executed immediately after processing each item. Both arguments are mandatory in terms of the syntax but may be left empty. See \secref{aut:cav:set} for usage examples.

\cmditem{DeclareFieldInputHandler}{field}{code}

This command can be used to define a data input handler for \prm{field} when it is read from the \file{.bbl}. Within the \prm{code}, the macro \cmd{NewValue} contains the value of the field. For example, to ignore the \bibfield{volumes} field when it appears, you could do

\begin{lstlisting}[style=latex]{}
\DeclareFieldInputHandler{volumes}{\def\NewValue{}}
\end{lstlisting}
%
Generally, you would want to use \cmd{DeclareSourcemap} (see \secref{aut:ctm:map}) to remove and modify fields but this alternative method may be useful in some circumstances when the emphasis is on appearance rather than data since the \prm{code} can be arbitraty \tex.

\cmditem{DeclareListInputHandler}{list}{code}

As \cmd{DeclareFieldInputHandler} but for lists. Within the \prm{code}, the macro \cmd{NewValue}
contains the value of the list and \cmd{NewCount} contains the number of items in the list.

\cmditem{DeclareNameInputHandler}{name}{code}

As \cmd{DeclareFieldInputHandler} but for names. Within the \prm{code}, the macro \cmd{NewValue}
contains the value of the name, \cmd{NewCount} contains the number of individual names in the name and \cmd{NewOption} contains any per-name options passed in the \file{.bbl}.

\end{ltxsyntax}

\subsubsection{格式化指令 Formatting Directives}
\label{aut:bib:fmt}

This section introduces the commands used to define the formatting directives required by the data commands from \secref{aut:bib:dat}. Note that all standard formats are defined in \path{biblatex.def}.

\begin{ltxsyntax}

\cmditem{DeclareFieldFormat}[entrytype, \dots]{format}{code}
\cmditem*{DeclareFieldFormat}*{format}{code}

Defines the field format \prm{format}. This formatting directive is arbitrary \prm{code} to be executed by \cmd{printfield}. The value of the field will be passed to the \prm{code} as its first and only argument. The name of the field currently being processed is available to the \prm{code} as \cmd{currentfield}. If an \prm{entrytype} is specified, the format is specific to that type. The \prm{entrytype} argument may be a comma"=separated list of values. The starred variant of this command is similar to the regular version, except that all type-specific formats are cleared.

\cmditem{DeclareListFormat}[entrytype, \dots]{format}{code}
\cmditem*{DeclareListFormat}*{format}{code}

Defines the literal list format \prm{format}. This formatting directive is arbitrary \prm{code} to be executed for every item in a list processed by \cmd{printlist}. The current item will be passed to the \prm{code} as its first and only argument. The name of the literal list currently being processed is available to the \prm{code} as \cmd{currentlist}. If an \prm{entrytype} is specified, the format is specific to that type. The \prm{entrytype} argument may be a comma"=separated list of values. Note that the formatting directive also handles the punctuation to be inserted between the individual items in the list. You need to check whether you are in the middle of or at the end of the list, \ie whether \cnt{listcount} is smaller than or equal to \cnt{liststop}. The starred variant of this command is similar to the regular version, except that all type-specific formats are cleared.

\cmditem{DeclareNameFormat}[entrytype, \dots]{format}{code}
\cmditem*{DeclareNameFormat}*{format}{code}

Defines the name list format \prm{format}. This formatting directive is arbitrary \prm{code} to be executed for every name in a list processed by \cmd{printnames}. If an \prm{entrytype} is specified, the format is specific to that type. The \prm{entrytype} argument may be a comma"=separated list of values. The individual parts of a name will be passed to the \prm{code} as separate arguments. These arguments are as follows:

\begin{argumentlist}{00}
\item[\#1] The last names. If a name consists of a single part only (for example, <Aristotle>), this part will be treated as the last name.
\item[\#2] The last names, given as initials.
\item[\#3] The first names. This argument also includes all middle names.
\item[\#4] The first names, given as initials.
\item[\#5] The name prefixes, for example von, van, of, da, de, del, della, etc. Note that name prefixes are referred to as the <von part> of the name in the \bibtex file format documentation.
\item[\#6] The name prefixes, given as initials.
\item[\#7] The name affixes, for example <junior>, <senior>, <der Jüngere>, <der Ältere>, etc.
Note that name affixes are referred to as the <junior part> of the name in the \bibtex file format documentation.
\item[\#8] The name affixes, given as initials.
\end{argumentlist}
%
If a certain part of a name is not available, the corresponding argument will be empty, hence you may use \cmd{ifblank} tests to check for the individual parts of a name. The name of the name list currently being processed is available to the \prm{code} as \cmd{currentname}. Note that the formatting directive also handles the punctuation to be inserted between separate names and between the individual parts of a name. You need to check whether you are in the middle of or at the end of the list, \ie whether \cnt{listcount} is smaller than or equal to \cnt{liststop}. See also \secref{use:cav:nam}. The starred variant of this command is similar to the regular version, except that all type-specific formats are cleared.

\cmditem{DeclareIndexFieldFormat}[entrytype, \dots]{format}{code}
\cmditem*{DeclareIndexFieldFormat}*{format}{code}

Defines the field format \prm{format}. This formatting directive is arbitrary \prm{code} to be executed by \cmd{indexfield}. The value of the field will be passed to the \prm{code} as its first and only argument. The name of the field currently being processed is available to the \prm{code} as \cmd{currentfield}. If an \prm{entrytype} is specified, the format is specific to that type. The \prm{entrytype} argument may be a comma"=separated list of values. This command is similar to \cmd{DeclareFieldFormat} except that the data handled by the \prm{code} is not intended to be printed but written to the index. Note that \cmd{indexfield} will execute the \prm{code} as is, \ie the \prm{code} must include \cmd{index} or a similar command. The starred variant of this command is similar to the regular version, except that all type-specific formats are cleared.

\cmditem{DeclareIndexListFormat}[entrytype, \dots]{format}{code}
\cmditem*{DeclareIndexListFormat}*{format}{code}

Defines the literal list format \prm{format}. This formatting directive is arbitrary \prm{code} to be executed for every item in a list processed by \cmd{indexlist}. The current item will be passed to the \prm{code} as its only argument. The name of the literal list currently being processed is available to the \prm{code} as \cmd{currentlist}. If an \prm{entrytype} is specified, the format is specific to that type. The \prm{entrytype} argument may be a comma"=separated list of values. This command is similar to \cmd{DeclareListFormat} except that the data handled by the \prm{code} is not intended to be printed but written to the index. Note that \cmd{indexlist} will execute the \prm{code} as is, \ie the \prm{code} must include \cmd{index} or a similar command. The starred variant of this command is similar to the regular version, except that all type-specific formats are cleared.

\cmditem{DeclareIndexNameFormat}[entrytype, \dots]{format}{code}
\cmditem*{DeclareIndexNameFormat}*{format}{code}

Defines the name list format \prm{format}. This formatting directive is arbitrary \prm{code} to be executed for every name in a list processed by \cmd{indexnames}. The name of the name list currently being processed is available to the \prm{code} as \cmd{currentname}. If an \prm{entrytype} is specified, the format is specific to that type. The \prm{entrytype} argument may be a comma"=separated list of values. The parts of the name will be passed to the \prm{code} as separate arguments. This command is very similar to \cmd{DeclareNameFormat} except that the data handled by the \prm{code} is not intended to be printed but written to the index. Note that \cmd{indexnames} will execute the \prm{code} as is, \ie the \prm{code} must include \cmd{index} or a similar command. The starred variant of this command is similar to the regular version, except that all type-specific formats are cleared.

\cmditem{DeclareFieldAlias}[entry type]{alias}[format entry type]{format}

Declares \prm{alias} to be an alias for the field format \prm{format}. If an \prm{entrytype} is specified, the alias is specific to that type. The \prm{format entry type} is the entry type of the backend format. This is only required when declaring an alias for a type"=specific formatting directive.

\cmditem{DeclareListAlias}[entry type]{alias}[format entry type]{format}

Declares \prm{alias} to be an alias for the literal list format \prm{format}. If an \prm{entrytype} is specified, the alias is specific to that type. The \prm{format entry type} is the entry type of the backend format. This is only required when declaring an alias for a type"=specific formatting directive.

\cmditem{DeclareNameAlias}[entry type]{alias}[format entry type]{format}

Declares \prm{alias} to be an alias for the name list format \prm{format}. If an \prm{entrytype} is specified, the alias is specific to that type. The \prm{format entry type} is the entry type of the backend format. This is only required when declaring an alias for a type"=specific formatting directive.

\cmditem{DeclareIndexFieldAlias}[entry type]{alias}[format entry type]{format}

Declares \prm{alias} to be an alias for the field format \prm{format}. If an \prm{entrytype} is specified, the alias is specific to that type. The \prm{format entry type} is the entry type of the backend format. This is only required when declaring an alias for a type"=specific formatting directive.

\cmditem{DeclareIndexListAlias}[entry type]{alias}[format entry type]{format}

Declares \prm{alias} to be an alias for the literal list format \prm{format}. If an \prm{entrytype} is specified, the alias is specific to that type. The \prm{format entry type} is the entry type of the backend format. This is only required when declaring an alias for a type"=specific formatting directive.

\cmditem{DeclareIndexNameAlias}[entry type]{alias}[format entry type]{format}

Declares \prm{alias} to be an alias for the name list format \prm{format}. If an \prm{entrytype} is specified, the alias is specific to that type. The \prm{format entry type} is the entry type of the backend format. This is only required when declaring an alias for a type"=specific formatting directive.

\end{ltxsyntax}

\subsection{自定义 Customization}
\label{aut:ctm}

\subsubsection{关联条目 Related Entries}
\label{aut:ctm:rel}
%The related entries feature comprises the following components:

关联条目功能由如下部分构成:\footnote{这里related data用关联而不是相关，其它地方用到相关的应一并改过来 }
\begin{itemize}
\item 可将条目中的特殊域用于建立和描述关系
%Special fields in an entry to set up and describe relationships
\item 可把本地化字符串作为关联数据的前缀(可选)
%Optionally, localization strings to prefix the related data
\item 提供用于抽取和打印关联数据的宏
%Macros to extract and print the related data
\item 提供给本地化字符串和关联数据格式化的格式
%Formats to format the localization string and related data
\end{itemize}
%
特殊域是\bibfield{related}, \bibfield{relatedtype}, \bibfield{relatedstring}和 \bibfield{relatedoptions}:
%The special fields are \bibfield{related}, \bibfield{relatedtype}, \bibfield{relatedstring} and \bibfield{relatedoptions}:
\begin{keymarglist}
\item[related] 与当前文献某种程度关联的文献的关键词的分离列表\footnote{这里separated list用分离列表有没有更好的说法}。注意:关键词\footnote{这里的key关键词应该是引用关键词，即bibtex键}的顺序很重要。来自多个关联文献的数据是按该域中关键词的顺序打印。
%A separated list of keys of entries which are related to this entry in some way. Note the the order of the keys is important. The data from multiple related entries is printed in the order of the keys listed in this field.
\item[relatedtype] The type of relationship. This serves three purposes. If the value of this field resolves to a localization string identifier, then the resulting localized string is printed before the data from the related entries. Secondly, if there is a macro called \texttt{related:\prm{relatedtype}}, this is used to format the data from the related entries. If no such macro exists, then the macro \texttt{related:default} is used. Lastly, if there is a format named \texttt{related:\prm{relatedtype}}, then it is used to format both the localized string and related entry data. If there is no related type specific format, the \texttt{related} format is used.
\item[relatedstring] If an entry contains this field, then if value of the field resolves to a localization string identifier, the localization key value specified is printed before data from the related entries. If the field does not specify a localization key, its value is printed literally. If both \bibfield{relatedtype} and \bibfield{relatedstring} are present in an entry, \bibfield{relatedstring} is used for the pre-data string (but \bibfield{relatedtype} is still used to determine the macro and format to use when printing the data).
\item[relatedoptions] A list of per"=entry options to set on the related entry (actually on the clone of the related entry which is used as a data source---the actual related entry is not modified because it might be cited directly itself).
\end{keymarglist}

The related entry feature is enabled by default by the package option \opt{related} from \secref{use:opt:pre:gen}. The related information entry data from the related entries is included via a \cmd{usebibmacro\{related\}} call. Standard styles call this macro towards the end of each driver. Style authors should ensure the existence of (or take note of existing) localization strings which are useful as values for the \bibfield{relatedtype} field, such as \texttt{translationof} or perhaps \texttt{translatedas}. A plural variant can be identified with the localization key \prm{relatedtype}\texttt{s}. This key's corresponding string is printed whenever more than one entry is specified in \bibfield{related}. Bibliography macros and formatting directives for printing entries related by \prm{relatedtype} should be defined using the name \texttt{related:\prm{relatedtype}}. The file \path{biblatex.def} contains macros and formats for some common relation types which can be used as templates. In particular, the \cmd{entrydata*} command is essential in such macros in order to make the data of the related entries available. Examples of entries using this feature can be found in the \biblatex distribution examples file \path{biblatex-examples.bib}. There are some specific formatting macros for this feature which control delimiters and separators in related entry information, see \secref{aut:fmt:fmt}.

\subsubsection{数据动态修改 Dynamic Modification of Data}
\label{aut:ctm:map}

Bibliographic data sources which are automatically generated or which you have no control over can be a problem if you need to edit them in some way. For this reason, \biber has the ability to modify data as it is read so that you can apply modifications to the source data stream without actually changing it. The modification can be defined in \biber's config file (see \biber docs), or via \biblatex macros in which case you can apply the modification only for specific documents, styles or globally.

Source mappings can be defined at different «levels» which are applied
in a defined order. See the \biblatex\ manual regarding these macros:\\[2ex]

\noindent \texttt{user}-level maps defined with \cmd{DeclareSourcemap}$\rightarrow$\\
\hspace*{1em}\texttt{user}-level maps defined in the \biber config file (see \biber docs)$\rightarrow$\\
\hspace*{2em}\texttt{style}-level maps defined with \cmd{DeclareStyleSourcemap}$\rightarrow$\\
\hspace*{3em}\texttt{driver}-level maps defined with \cmd{DeclareDriverSourcemap}\\[2ex]

\begin{ltxsyntax}

\cmditem{DeclareSourcemap}{specification}\BiberOnlyMark

Defines source data modification (mapping) rules which can be used to perform any combination of the following tasks:

\begin{itemize}
\item Map data source entrytypes to different entrytypes
\item Map datasource fields to different fields
\item Add new fields to an entry
\item Remove fields from an entry
\item Modify the contents of a field using standard Perl regular expression
  match and replace
\item Restrict any of the above operations to entries coming from
  particular datasources which you defined in \cmd{addresource} macros
\item Restrict any of the above operations to entries only of a certain
  entrytype
\end{itemize}

The \prm{specification} is an undelimited list of \cmd{maps} directives which specify containers for mappings rules applying to a particular data source type (\secref{use:bib:res}). Spaces, tabs, and line endings may be used freely to visually arrange the \prm{specification}. Blank lines are not permissible. This command may only be used in the preamble and may only be used once---subsequent uses will overwrite earlier definitions.

\cmditem{maps}{elements}

Contains an ordered set of \cmd{map} elements each of which is a logically related set of mapping steps to apply to the data source.

\begin{optionlist*}

\choitem[bibtex]{datatype}{bibtex, biblatexml, ris, zoterordfxml, endnotexml}

Data source type to which the contained \cmd{map} directives apply (\secref{use:bib:res}).

\boolitem[false]{overwrite}

Specify whether a mapping rule is allowed to overwrite already existing data in an entry. If this option is not specified, the default is \texttt{false}. The short form \opt{overwrite} is equivalent to \kvopt{overwrite}{true}.

\end{optionlist*}

\cmditem{map}{restrictions,steps}

A container for an ordered set of map \cmd{step}s, optionally restricted to particular entrytypes or data sources. This is a grouping element to allow a set of mapping steps to apply only to specific entrytypes or data sources. Mapping steps must always be contained within a \cmd{map} element.

\begin{optionlist*}

\boolitem{overwrite}

As the same option on the parent \cmd{maps} element. This option allows an override on a per-map group basis. If this option is not specified, the default is the parent \cmd{maps} element option value. The short form \opt{overwrite} is equivalent to \kvopt{overwrite}{true}.

\end{optionlist*}

\cmditem{perdatasource}{datasource}

Restricts all \cmd{step}s in this \cmd{map} element to entries from the named \prm{datasource}. The \prm{datasource} name should be exactly as given in a \cmd{addresource} macro defining a data source for the document. Multiple \cmd{perdatasource} restrictions are allowed within a \cmd{map} element.

\cmditem{pertype}{entrytype}

Restricts all \cmd{step}s in this \cmd{map} element to entries of the named \prm{entrytype}. Multiple \cmd{pertype} restrictions are allowed within a \cmd{map} element.

\cmditem{pernottype}{entrytype}

Restricts all \cmd{step}s in this \cmd{map} element to entries not of the named \prm{entrytype}. Multiple \cmd{pernottype} restrictions are allowed within a \cmd{map} element.

\cmditem{step}

A mapping step. Each step is applied sequentially to every relevant entry where <relevant> means those entries which correspond to the data source type, entrytype and data source name restrictions mentioned above. Each step is applied to the entry as it appears after the application of all previous steps. The mapping performed by the step is determined by the following options:

\begin{optionlist*}

\valitem{typesource}{entrytype}
\valitem{typetarget}{entrytype}
\valitem{fieldsource}{entryfield}
\valitem{fieldtarget}{entryfield}
\valitem{match}{regexp}
\valitem{notmatch}{regexp}
\valitem{replace}{regexp}
\valitem{fieldset}{entryfield}
\valitem{fieldvalue}{string}
\valitem{entryclone}{string}
\boolitem[false]{entrynull}
\boolitem[false]{append}
\boolitem[false]{final}
\boolitem[false]{null}
\boolitem[false]{origfield}
\boolitem[false]{origfieldval}
\boolitem[false]{origentrytype}
%
For all boolean \cmd{step} options, the short form \opt{option} is equivalent to \kvopt{option}{true}. The following rules for a mapping step apply:

\renewcommand{\labelitemii}{$\circ$}

\begin{itemize}
\item If \texttt{entrynull} is set, processing of the \cmd{map}
  immediately terminates and the current entry is not created. It is
  as if it did not exist in the datasource. Obviously, you should
  select the entries which you want to apply this to using prior
  mapping steps.
\item If \texttt{entryclone} is set, a clone of the entry is created with
  an entry key prefixed by \texttt{prefix}. Obviously this may cause
  labelling problems in author/year styles etc. and should be used with
  care. It is mainly intended for numbering issues with numeric styles and
  multiple bibliographies where the same entries occur in more than one
  bibliography.
\item Change the \texttt{typesource} \prm{entrytype} to the
  \texttt{typetarget} \prm{entrytype}, if defined. If
  \texttt{final} is \texttt{true} then if the \prm{entrytype} of the entry is not \texttt{typesource}, processing of the parent \cmd{map} immediately terminates.
\item Change the \texttt{fieldsource} \prm{entryfield} to
  \texttt{fieldtarget}, if defined. If
  \texttt{final} is \texttt{true} then if there is no \texttt{fieldsource} \prm{entryfield} in the entry, processing of the parent \cmd{map} immediately terminates.
\item If \texttt{match} is defined but
  \texttt{replace} is not, only apply the step if the \texttt{fieldsource} \prm{entryfield} matches the
  \texttt{match} regular expression (logic is reversed if you use \texttt{notmatch} instead)\footnote{Regular expressions are full Perl 5.16 regular expressions. This means you may need to deal with special characters, see examples.}. You may use capture parenthesis as usual and refer to these (\$1\ldots\$9) in later \texttt{fieldvalue} specifications. This allows you to pull out parts of some fields and put these parts in other fields.
\item Perform a regular expression match and replace on the value of the \texttt{fieldsource} \prm{entryfield} if \texttt{match} and \texttt{replace} are defined.
\item If \texttt{fieldset} is defined, then its value is \prm{entryfield}
  which will be set to a value specified by further options. If
  \texttt{overwrite} is false for this step and the field to set already
  exists then the map step is ignored. If \texttt{final} is also true for
  this step, then processing of the parent map stops at this point. If
  \texttt{append} is true, then the value to set is appended to the current
  value of \prm{entryfield}. The value to set is specified by a mandatory
  one and only one of the following options:
  \begin{itemize}
    \item\ \texttt{fieldvalue} --- The \texttt{fieldset} \prm{entryfield} is set to the \texttt{fieldvalue} \prm{string}
    \item\ \texttt{null} --- The \texttt{fieldset} \prm{entryfield} is ignored, as if it did not exist in the datasource
    \item\ \texttt{origentrytype} --- The \texttt{fieldset} \prm{entryfield} is set to the most recently mentioned \texttt{typesource} \prm{entrytype} name
    \item\ \texttt{origfield} --- The \texttt{fieldset} \prm{entryfield} is set to the most recently mentioned \texttt{fieldsource} \prm{entryfield} name
    \item\ \texttt{origfieldval} --- The \texttt{fieldset} \prm{entryfield} is set to the most recently mentioned \texttt{fieldsource} value
  \end{itemize}
\end{itemize}

\end{optionlist*}

\end{ltxsyntax}

\noindent With \bibtex\ and RIS datasources, you may specify the
pseudo-field \bibfield{entrykey} for \texttt{fieldsource}
which is the citation key of the entry. Naturally, this <field> cannot
be changed (used as \texttt{fieldset}, \texttt{fieldtarget} or changed using \texttt{replace}).

\begin{ltxsyntax}

\cmditem{DeclareStyleSourcemap}{specification}\BiberOnlyMark

This command sets the source mappings used by a style. Such mappings are conceptually separate from user mappings defined with \cmd{DeclareSourcemap} and are applied directly after user maps. The syntax is identical to \cmd{DeclareSourcemap}. This command is provided for style authors so that any maps defined for the style do not interfere with user maps or the default driver maps defined with \cmd{DeclareDriverSourcemap}. This command is for use in style files and can only be used once---subsequent uses will overwrite earlier definitions.

\end{ltxsyntax}

\begin{ltxsyntax}

\cmditem{DeclareDriverSourcemap}[datatype=driver]{specification}\BiberOnlyMark

This command sets the driver default source mappings for the specified \prm{driver}. Such mappings are conceptually separate from user mappings defined with \cmd{DeclareSourcemap} and style mapping defined with \cmd{DeclareStyleSourcemap}. They consist of mappings which are part of the driver setup. Users should not normally need to change these. Driver default mapping are applied after user mappings (\cmd{DeclareSourcemap}) and style mappings (\cmd{DeclareStyleSourcemap}). These defaults are described in Appendix \secref{apx:maps}. The \prm{specification} is identical to that for \cmd{DeclareSourcemap} but without the \cmd{maps} elements: the \prm{specification} is just a list of \cmd{map} elements since each \cmd{DeclareDriverSourcemap} only applies to one datatype driver. See the default definitions in Appendix \secref{apx:maps} for examples.

\end{ltxsyntax}

Here are some data source mapping examples:

\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
      \perdatasource{<<example1.bib>>}
      \perdatasource{<<example2.bib>>}
      \step[fieldset=<<keywords>>, fieldvalue={<<keyw1, keyw2>>}]
      \step[fieldsource=<<entrykey>>]
      \step[fieldset=<<note>>, origfieldval]
    }
  }
}
\end{lstlisting}
%
This would add a \bibfield{keywords} field with value <keyw1, keyw2> and set the \bibfield{note} field to the entry key to all entries which are found in either the
\texttt{examples1.bib} or \texttt{examples2.bib} files.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
      \step[fieldsource=<<title>>]
      \step[fieldset=<<note>>, origfieldval]
    }
  }
}
\end{lstlisting}
%
Copy the \bibfield{title} field to the \bibfield{note} field unless the
\bibfield{note} field already exists.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
      \step[typesource=<<chat>>, typetarget=<<customa>>, final]
      \step[fieldset=<<type>>, origentrytype]
    }
  }
}
\end{lstlisting}
%
Any \bibfield{chat} entrytypes would become \bibfield{customa} entrytypes and
would automatically have a \bibfield{type} field set to
<chat> unless the \bibfield{type} field already exists in the entry (because
\texttt{overwrite} is false by default). This mapping applies only to entries of type
\bibtype{chat} since the first step has \texttt{final} set and so if the
\texttt{typesource} does not match the entry entrytype, processing of this
\cmd{map} immediately terminates.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
      \perdatasource{<<examples.bib>>}
      \pertype{<<article>>}
      \pertype{<<book>>}
       \step[fieldset=<<abstract>>, null]
       \step[fieldset=<<note>>, fieldvalue={<<Auto-created this field>>}]
    }
  }
}
\end{lstlisting}
%
Any entries of entrytype \bibtype{article} or \bibtype{book} from the
\texttt{examples.bib} datasource would have their \bibfield{abstract}
fields removed and a \bibfield{note} field added with value <Auto-created this field>.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \step[fieldset=<<abstract>>, null]
       \step[fieldsource=<<conductor>>, fieldtarget=<<namea>>]
       \step[fieldsource=<<gps>>, fieldtarget=<<usera>>]
    }
  }
}
\end{lstlisting}
%
This removes \bibfield{abstract} fields from any entry, changes
\bibfield{conductor} fields to \bibfield{namea} fields and changes \bibfield{gps}
fields to \bibfield{usera} fields.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \step[fieldsource=<<pubmedid>>, fieldtarget=<<eprint>>, final]
       \step[fieldset=<<eprinttype>>, origfield]
       \step[fieldset=<<userd>>, fieldvalue={<<Some string of things>>}]
    }
  }
}
\end{lstlisting}
%
Applies only to entries with \bibfield{pubmed} fields and maps
\bibfield{pubmedid} fields to \bibfield{eprint} fields, sets the \bibfield{eprinttype}
field to <pubmedid> and also sets the \bibfield{userd} field to the string
<Some string of things>.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \step[fieldsource=<<series>>,
             match=\regexp{<<\A\d*(.+)>>},
             replace=\regexp{<<\L$1>>}]
    }
  }
}
\end{lstlisting}
%$<- to stop emacs highlighting breaking
Here, the contents of the \bibfield{series} field have leading numbers stripped and the remainder of the contents lowercased. Since regular expressions usually contain all sort of special characters, it is best to enclose them in the provided \cmd{regexp} macro as shown---this will pass the expression through to \biber\ correctly.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \step[fieldsource=<<maintitle>>,
             match=\regexp{<<Collected\s+Works.+Freud>>},
             final]
       \step[fieldset=<<keywords>>, fieldvalue=<<freud>>]
    }
  }
}
\end{lstlisting}
%$<- to stop emacs highlighting breaking
Here, if for an entry, the \bibfield{maintitle} field matches a particular regular expression, we set a special keyword so we can, for example, make a references section just for certain items.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \step[fieldsource=<<lista>>, match=\regexp{<<regexp>>}, final]
       \step[fieldset=<<lista>>, null]
    }
  }
}
\end{lstlisting}
%
If an entry has a \bibfield{lista} field which matches regular expression <regexp>, then it is removed.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map[overwrite=false]{
       \step[fieldsource=<<author>>]
       \step[fieldset=<<editor>>, origfieldval, final]
       \step[fieldsource=<<editor>>, match=\regexp{<<\A(.+?)\s+and.*>>}, replace={<<$1>>}]
    }
  }
}
\end{lstlisting}
%$<- to stop emacs highlighting breaking
For any entry with an \bibfield{author} field, try to set
\bibfield{sortname} to the same as \bibfield{author}. If this fails because
\bibfield{sortname} already exists, stop, otherwise truncate
\bibfield{sortname} to just the first name in the name list.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \step[fieldsource=<<author>>,
             match={<<Smith, Bill>>},
             replace={<<Smith, William>>}]
       \step[fieldsource=<<author>>,
             match={<<Jones, Baz>>},
             replace={<<Jones, Barry>>}]
    }
  }
}
\end{lstlisting}
%
Here, we use multiple match/replace for the same field to regularise some inconstant name variants. Bear in mind that \cmd{step} processing within a \opt{map} element is sequential and so the changes from a previous \cmd{step}s are already committed. Note that we don't need the \cmd{regexp} macro to protect the regular expressions in this example as they contain no characters which need special escaping. Please note that due to the difficulty of protecting regular expressions in \LaTeX, there should be no literal spaces in the argument to \cmd{regexp}. Please use escape code equivalents if spaces are needed. For example, this example, if using \cmd{regexp}, should be:
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \step[fieldsource=<<author>>,
             match=\regexp{<<Smith,\s+Bill>>},
             replace=\regexp{<<Smith,\x20William>>}]
       \step[fieldsource=<<author>>,
             match=\regexp{<<Jones,\s+Baz>>},
             replace=\regexp{<<Jones,\x20Barry>>}]
    }
  }
}
\end{lstlisting}
%
Here, we have used the hexadecimal escape sequence <|\x20|> in place of literal spaces in the replacement strings.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map[overwrite]{
       \step[fieldsource=<<author>>, match={<<Doe,>>}, final]
       \step[fieldset=<<shortauthor>>, origfieldval]
       \step[fieldset=<<sortname>>, origfieldval]
       \step[fieldsource=<<shortauthor>>,
             match=\regexp{<<Doe,\s*(?:\.|ohn)(?:[-]*)(?:P\.|Paul)*>>},
             replace={<<Doe, John Paul>>}]
       \step[fieldsource=<<sortname>>,
             match=\regexp{<<Doe,\s*(?:\.|ohn)(?:[-]*)(?:P\.|Paul)*>>},
             replace={<<Doe, John Paul>>}]
    }
  }
}
\end{lstlisting}
%
Only applies to entries with an \bibfield{author} field matching <Doe,>. First the \bibfield{author} field is copied to both the \bibfield{shortauthor} and \bibfield{sortname} fields, overwriting them if they already exist. Then, these two new fields are modified to canonicalise a particular name, which presumably has some variants in the data source.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map[overwrite]{
      \step[fieldsource=<<verba>>, final]
      \step[fieldset=<<verbb>>, fieldvalue=<</>>, append]
      \step[fieldset=<<verbb>>, origfieldval, append]
      \step[fieldsource=<<verbb>>, final]
      \step[fieldset=<<verbc>>, fieldvalue=<</>>, append]
      \step[fieldset=<<verbc>>, origfieldval, append]
    }
  }
}
\end{lstlisting}
%
This example demonstrates the sequential nature of the step processing and the \opt{append} option. If an entry has a \bibfield{verba} field then first, a forward slash is appended to the \bibfield{verbb} field. Then, the contents of \bibfield{verba} are appended to the \bibfield{verbb} field. A slash is then appended to the \bibfield{verbc} field and the contents of \bibfield{verbb} are appended to the \bibfield{verbc} field.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map[overwrite]{
      \step[fieldset=<<autourl>>, fieldvalue={<<http://scholar.google.com/scholar?q=">>}]
      \step[fieldsource=<<title>>]
      \step[fieldset=<<autourl>>, origfieldval, append]
      \step[fieldset=<<autourl>>, fieldvalue={<<"+author:>>}, append]
      \step[fieldsource=<<author>>, match=\regexp{<<\A([^,]+)\s*,>>}]
      \step[fieldset=<<autourl>>, fieldvalue={<<$1>>}, append]
      \step[fieldset=<<autourl>>, fieldvalue={<<&as_ylo=>>}, append]
      \step[fieldsource=<<year>>]
      \step[fieldset=<<autourl>>, origfieldval, append]
      \step[fieldset=<<autourl>>, fieldvalue={<<&as_yhi=>>}, append]
      \step[fieldset=<<autourl>>, origfieldval, append]
    }
  }
}
\end{lstlisting}%$ <- keep AucTeX highlighting happy
%
This example assumes you have created a field called \bibfield{autourl} using the datamodel macros from \secref{aut:ctm:dm} in order to hold, for example, a Google Scholar query URL auto-created from elements of the entry. The example progressively extracts information from the entry, constructing the URL as it goes. It demonstrates that it is possible to refer to parenthetical matches from the most recent \texttt{match} in any following \texttt{fieldvalue} which allows extracting the lastname from the \bibfield{author}, assuming a <last, first> format. The resulting field could then be used as a hyperlink from, for example, the title of the work in the bibliography.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
      \step[fieldsource=<<title>>, match={A Title}, final]
      \step[entrynull]
    }
  }
}
\end{lstlisting}
%
Any entry with a \bibfield{title} field matching <A Title> will be completely ignored.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
      \pernottype{book}
      \pernottype{article}
      \step[entrynull]
    }
  }
}
\end{lstlisting}
%
Any entry which is not a \bibtype{book} or \bibtype{article} will be ignored.
%
\begin{lstlisting}[style=latex]{}
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
      \perdatasource{<<biblatex-examples.bib>>}
      \step[entryclone={rel-}]
    }
  }
}
\end{lstlisting}
%
Here, a clone of an entry from the specified data source will be created. The entry key of the clone will be the same as the original but prefixed by the value of the \texttt{entryclone} parameter. The cloned entry would still need to be cited in the document using its new entry key. This type of mapping step should be used with care as it may produce labelling problems in authoryear styles which use, for example, \opt{extrayear}. One use case is for numeric styles which contain multiple bibliographies containing the same entry. In this case, you may need different bibliography number labeld for the same entry and this is very tricky when there is only one entry which needs different labels. Creating clones with different entry keys solves this problem.
%
\subsubsection{数据模型规范 Data Model Specification}\BiberOnlyMark
\label{aut:ctm:dm}

The data model which \biblatex uses consists of four main elements:

\begin{itemize}
\item Specification of valid Entrytypes
\item Specification of valid Fields along with their type, datatype and any special flags
\item Specification of which Fields are valid in which Entrytypes
\item Specification of constraints which can be used to validate data against the data model
\end{itemize}

The default data model is defined in the core \biblatex file \file{blx-dm.def} using the macros described in this section. The default data model is described in detail in \secref{bib}. The data model is used internally by \biblatex and also by the backends. The data model for the \bibtex backend is hard-coded and cannot be changed. Changing the data model is only supported for the \biber backend. In practice, changing the data model means that you can define the entrytypes and fields for your datasources and validate your data against the data model. Naturally, this is not much use unless your style supports any new entrytypes or fields and it raises issues of portability between styles (although this can be mitigated by using the dynamic data modification functionality described in \secref{aut:ctm:map}).

Validation against the data model means that after mapping your data sources into the data model, \biber (using its \path{--validate_datamodel} option) can check:

\begin{itemize}
\item Whether all entrytypes are valid entrytypes
\item Whether all fields are valid fields for their entrytype
\item Whether the fields obey various constraints on their format which you specify
\end{itemize}
%
Redefining the data model can be done in several places. Style authors can create a \file{.dbx} file which contains the data model macros required and this will be loaded automatically when using the \biblatex package \opt{style} option by looking for a file named after the style with a \file{.dbx} extension (just like the \file{.cbx} and \file{.bbx} files for a style). If the \opt{style} option is not used but rather the \opt{citestyle} and \opt{bibstyle} options, then the package will try to load \file{.dbx} files called \file{<citestyle>.dbx} and \file{<bibstyle>.dbx}.
Alternatively, the name of the data model file can be different from any of the style option names by specifying the name (without \file{.dbx} extension) to the package \opt{datamodel} option. After loading the style data model file, \biblatex then loads, if present, a users \file{biblatex-dm.cfg} which should be put somewhere \biblatex can find it, just like the main configuration file \sty{biblatex.cfg}. To summarise, the data model is determined by adding to the data model from each of these locations, in order:\\

\noindent\file{blx-dm.def}$\rightarrow$\\
\hspace*{1em}\file{<datamodel option>.dbx} $\rightarrow$\\
\hspace*{2em}\file{<style option>.dbx} $\rightarrow$\\
\hspace*{3em}\file{<citestyle option>.dbx} and \file{<bibstyle option>.dbx} $\rightarrow$\\
\hspace*{4em}\file{biblatex-dm.cfg}\\

\noindent It is not possible to add to a loaded data model by using the macros below in your preamble as the preamble is read after \biblatex has defined critical internal macros based on the data model. If any data model macro is used in a document, it will be ignored and a warning will be generated. The data model is defined using the following macros:

\begin{ltxsyntax}

\cmditem{DeclareDatamodelEntrytypes}[options]{entrytypes}\BiberOnlyMark

Declares the comma"=separated list of \prm{entrytypes} to be valid entrytypes in the data model. As usual in \tex csv lists, make sure each element is immediately followed by a comma or the closing brace---no extraneous whitespace.

\begin{optionlist*}

\boolitem[false]{skipout}

This entrytype is not output to the \file{.bbl}. Typically used for special entrytypes which are processed and consumed by the backend such as \bibtype{xdata}.

\end{optionlist*}

\cmditem{DeclareDatamodelFields}[options]{fields}\BiberOnlyMark

Declares the comma"=separated list of \prm{fields} to be valid fields in the data model with associated comma"=separated \prm{options}. The \prm{type} and \prm{datatype} options are mandatory. All valid \prm{options} are:

\begin{optionlist*}

\valitem{type}{field type}

Set the type of the field as described in \secref{bib:fld:typ}. Is typically <field> or <list>.

\valitem{format}{field format}

Any special format of the field. Normally unspecified but can take the value <xsv> which tells \biber that this field has a separated values format. The exact separator can be controlled with the \biber option \opt{xsvsep} and defaults to the expected comma surrounded by optional whitespace.

\valitem{datatype}{field datatype}

Set the datatype of the field as described in \secref{bib:fld:typ}. For example, <name> or <literal>.

\boolitem[false]{nullok}

The field is allowed to be defined but empty.

\boolitem[false]{skipout}

The field is not output to the \file{.bbl} and is therefore not present during \biblatex style processing. As usual in \tex csv lists, make sure each element is immediately followed by a comma or the closing brace---no extraneous whitespace.

\boolitem[false]{label}

The field can be used as a label in a bibliography or bibliography list. Specifying this causes \biblatex to create several helper macros for the field so that there are some internal lengths and headings etc. defined.

\end{optionlist*}

\cmditem{DeclareDatamodelEntryfields}[entrytypes]{fields}\BiberOnlyMark

Declares that the comma"=separated list of \prm{fields} is valid for the comma"=separated list of \prm{entrytypes}. If \prm{entrytypes} is not given, the fields are valid for all entrytypes. As usual in \tex csv lists, make sure each element is immediately followed by a comma or the closing brace---no extraneous whitespace.

\cmditem{DeclareDatamodelConstraints}[entrytypes]{specification}\BiberOnlyMark

If a comma"=separated list of \prm{entrytypes} is given, the constraints apply only to those entrytypes. The \prm{specification} is an undelimited list of \cmd{constraint} directives which specify a constraint. Spaces, tabs, and line endings may be used freely to visually arrange the \prm{specification}. Blank lines are not permissible.

\cmditem{constraint}[type=constrainttype]{elements}

Specifies a constraint of type \prm{constrainttype}. Valid constraint types are:

\begin{optionlist*}

\choitem{type}{data, mandatory, conditional}

Constraints of type <data> put restrictions on the value of a field. Constraints of type <mandatory> specify which fields or combinations of fields an entrytype should have. Constraints of type <conditional> allow more sophisticated conditional and quantified field constraints.

\choitem{datatype}{integer, isbn, issn, ismn, date, pattern}

For constraints of type \prm{data}, constrain field values to be the given datatype.

\valitem{rangemin}{num}

For constraints of \prm{type} <data> and \prm{datatype} <integer>, constrain field values to be at least \prm{num}.

\valitem{rangemax}{num}

For constraints of \prm{type} <data> and \prm{datatype} <integer>, constrain field values to be at most \prm{num}.

\valitem{pattern}{patt}

For constraints of \prm{type} <data> and \prm{datatype} <pattern>, constrain field values to match regular expression pattern \prm{patt}. It is best to wrap any regular expression in the macro \cmd{regexp}, see \secref{aut:ctm:map}.

\end{optionlist*}

A \cmd{constraint} macro may contain any of the following:

\cmditem{constraintfieldsor}{fields}

For constraints of \prm{type} <mandatory>, specifies that an entry must contain a boolean OR of the \cmd{constraintfield}s.

\cmditem{constraintfieldsxor}{fields}

For constraints of \prm{type} <mandatory>, specifies that an entry must contain a boolean XOR of the \cmd{constraintfield}s.

\cmditem{antecedent}[quantifier=quantspec]{fields}

For constraints of \prm{type} <conditional>, specifies a quantified set of \cmd{constraintfield}s which must be satisfied before the \cmd{consequent} of the constraint is checked. \prm{quantspec} should have one of the following values:

\begin{optionlist*}

\choitem{quantifier}{all, one, none}

Specifies how many of the \cmd{constrainfield}'s inside the \cmd{antecedent} have to be present to satisfy the antecedent of the conditional constraint.

\end{optionlist*}

\cmditem{consequent}[quantifier=quantspec]{fields}

For constraints of \prm{type} <conditional>, specifies a quantified set of \cmd{constraintfield}s which must be satisfied if the preceding \cmd{antecedent} of the constraint was satisfied. \prm{quantspec} should have one of the following values:

\begin{optionlist*}

\choitem{quantifier}{all, one, none}

Specifies how many of the \cmd{constraintfield}'s inside the \cmd{consequent} have to be present to satisfy the consequent of the conditional constraint.

\end{optionlist*}

\cmditem{constraintfield}{field}

For constraints of \prm{type} <data>, the constraint applies to this \prm{field}. For constraints of \prm{type} <mandatory>, the entry must contain this \prm{field}.

The data model declaration macros may be used multiple times as they append to the previous definitions. In order to replace, change or remove existing definitions (such as the default model which is loaded with \biblatex), you should reset (clear) the current definition and then set what you want using the following macros. Typically, these macros will be the first things in any \file{biblatex-dm.cfg} file:

\cmditem{ResetDatamodelEntrytypes}

Clear all data model entrytype information.

\cmditem{ResetDatamodelFields}

Clear all data model field information.

\cmditem{ResetDatamodelEntryfields}

Clear all data model fields for entrytypes information.

\cmditem{ResetDatamodelConstraints}

Clear all data model fields Constraints information.

\end{ltxsyntax}

Here is an example of a simple data model. Refer to the core \biblatex file \file{blx-dm.def} for the default data model specification.

\begin{lstlisting}[style=latex]{}
\ResetDatamodelEntrytypes
\ResetDatamodelFields
\ResetDatamodelEntryfields
\ResetDatamodelConstraints

\DeclareDatamodelEntrytypes{<<entrytype1, entrytype2>>}

\DeclareDatamodelFields[type=field, datatype=literal]{<<field1,field2,field3,field4>>}

\DeclareDatamodelEntryfields{<<field1>>}
\DeclareDatamodelEntryfields[entrytype1]{<<field2,field3>>}
\DeclareDatamodelEntryfields[entrytype2]{<<field2,field3,field4>>}

\DeclareDatamodelConstraints[<<entrytype1>>]{
  \constraint[type=data, datatype=integer, rangemin=3, rangemax=10]{
    \constraintfield{<<field1>>}
  }
  \constraint[type=mandatory]{
    \constraintfield{<<field1>>}
    \constraintfieldsxor{
      \constraintfield{<<field2>>}
      \constraintfield{<<field3>>}
    }
  }
}
\DeclareDatamodelConstraints{
  \constraint[type=conditional]{
    \antecedent[quantifier=none]{
      \constraintfield{<<field2>>}
    }
    \consequent[quantifier=all]{
      \constraintfield{<<field3>>}
      \constraintfield{<<field4>>}
    }
  }
}
\end{lstlisting}
%
This model specifies:

\begin{itemize}
\item Clear the default data model completely
\item Two valid entry types \bibtype{entrytype1} and \bibtype{entrytype2}
\item Four valid literal field fields
\item \bibfield{field1} is valid for all entrytypes
\item \bibfield{field2} and \bibfield{field3} are valid for \bibfield{entrytype1}
\item \bibfield{field2}, \bibfield{field3} and \bibfield{field4} are valid for \bibtype{entrytype2}
\item For \bibtype{entrytype1}:
  \begin{itemize}
  \item \bibfield{field1} must be an integer between 3 and 10
  \item \bibfield{field1} must be present
  \item One and only one of \bibfield{field2} or \bibfield{field3} must be present
  \end{itemize}
\item For any entrytype, if \bibfield{field2} is not present, \bibfield{field3} and \bibfield{field4} must be present
\end{itemize}

\subsubsection{标签 Labels}
\label{aut:ctm:lab}
字母顺序制样式使用一个标签来区分参考文献条目。这个标签由条目的内容使用一个描述怎么构建标签的模板构建。该模板可以全局自定义或者分条目类型定义。标签的自定义需要用\biber 后端而不能用其它后端。
%Alphabetic styles use a label to identify bibliography entries. This label is constructed from components of the entry using a template which describes how to build the label. The template can be customised on a global or per-type basis. Label customisation requires \biber and will not work with any other backend.

\begin{ltxsyntax}

\cmditem{DeclareLabelalphaTemplate}[entrytype, \dots]{specification}\BiberOnlyMark

Defines the alphabetic label template for the given entrytypes. If no entrytypes are specified in the first argument, then the global label template is defined. The \prm{specification} is an undelimited list of \cmd{labelelement} directives which specify the elements used to build the label. Spaces, tabs, and line endings may be used freely to visually arrange the \prm{specification}. Blank lines are not permissible. This command may only be used in the preamble.

\cmditem{labelelement}{elements}

Specifies the elements used to build the label. The \prm{elements} are an undelimited list of \cmd{field} or \cmd{literal} commands which are evaluated in the order in which they are given. The first \cmd{field} or \cmd{literal} which expands to a non-empty string is used as the \cmd{labelelement} expansion and the next \cmd{labelelement}, if any, is then processed.

\cmditem{field}[options]{field}

If \prm{field} is non-empty, use it as the current label \cmd{labelelement}, subject to the options below. Useful values for \prm{field} are typically the name list type fields, date fields, and title fields. You may also use the `citekey' pseudo-field to specify the citation key as part of the label. Name list fields are treated specially and the options which take substrings of the \prm{field} to use in the \cmd{labelelement} are applied to the lastname of every name in a name list (see below).

\begin{optionlist*}

\boolitem[false]{final}

This option marks a \cmd{field} directive as the final one in the \prm{specification}. If the \prm{field} is non-empty, then this field is used for the label and the remainder of the \prm{specification} will be ignored. The short form \opt{final} is equivalent to \kvopt{final}{true}.

\boolitem[false]{lowercase}

Forces the label part derived from the field to lowercase. By default, the case is taken from the field source and not modified.

\intitem[1]{strwidth}

The number of characters of the \prm{field} to use. For name list fields, if \kvopt{useprefix}{true}, the first character of the name prefix is prepended to the substring.

\choitem[left]{strside}{left, right}

The side of the string from which to take the \texttt{strwidth} number of characters.

\choitem[right]{padside}{left, right}

Side to pad the label part when using the \texttt{padchar} option. Only for use with fixed-width label strings (\texttt{strwidth}).

\valitem{padchar}{character}

If present, pads the label part on the \texttt{padside} side with the specified character to the length of \texttt{strwidth}. Only for use with fixed-width label strings (\texttt{strwidth}).

\boolitem[false]{uppercase}

Forces the label part derived from the field to uppercase. By default, the case is taken from the field source and not modified.

\boolitem[false]{varwidth}

Use a variable width, left-side substring of characters from the \prm{field} (each lastname in name list fields). The length of the string is determined by the minimum length needed to disambiguate the substring from all other \prm{field} elements in the same position in the label. For name list fields, this means that each name substring is disambiguated from all other name substrings which occur in the same position in the name list (see examples below). This option overrides \texttt{strwidth} if both are used. The short form \opt{varwidth} is equivalent to \kvopt{varwidth}{true}. For name list fields, if \kvopt{useprefix}{true}, the first character of the name prefix is prepended to the substring.

\boolitem[false]{varwidthnorm}

As \texttt{varwidth} but will force the disambiguated substrings for the \prm{field} to be the same length as the longest disambiguated substring. This can be used to regularise the format of the labels if desired. This option overrides \texttt{strwidth} if both are used. The short form \opt{varwidthnorm} is equivalent to \kvopt{varwidthnorm}{true}.

\boolitem[false]{varwidthlist}

Alternative method of automatic label disambiguation where the field as a whole is disambiguated from all other fields in the same label position. For non-name list fields, this is equivalent to \texttt{varwidth}. For name list fields, names in a name list are not disambiguated from other names in the same position in their name lists but instead the entire name list is disambiguated as a whole from other name lists (see examples below). This option overrides \texttt{strwidth} if both are used. The short form \opt{varwidthlist} is equivalent to \kvopt{varwidthlist}{true}. For name list fields, if \kvopt{useprefix}{true}, the first character of the name prefix is prepended to the substring.

\intitem{strwidthmax}

When using \texttt{varwidth}, this option sets a limit (in number of characters) on the length of variable width substrings. This option can be used to regularise the label.

\intitem[1]{strfixedcount}

When using \texttt{varwidthnorm}, there must be at least \texttt{strfixedcount} disambiguated substrings with the same, maximal length to trigger the forcing of all disambiguated substrings to this same maximal length.

\boolitem[false]{compound}

For static (non-varwidth) disambiguation, treat lastname name components separated by whitespace or hyphens (compound last names) as separate names for label generation. This means that when forming a label out of, for example the surname <Ballam Forsyth> with a 1 character, left-side substring, this name would give <BF> with \kvopt{compound}{true} and <B> with \kvopt{compound}{false}. The short form \opt{compound} is equivalent to \kvopt{compound}{true}.

\intitem{ifnames}

Only use this \cmd{field} specification if it is a name list field with \texttt{ifnames} names in it. This allows a \cmd{labelelement} to be conditionalised on name length (see below).

\intitem{names}

By default, for name list fields, the number of names considered when building the label obeys the \cnt{maxalphanames}\slash \cnt{minalphanames} truncation. This option can be used to override this with an explicit upper limit of how many names to consider. This is useful if you have some very long name lists which might result in a very long label.

\choitem[original]{form}{original,translated,romanised,uniform}

Specifies the script variant of a field, if the datasource you are using supports this.

\choitem[none]{lang}{<language specifier>}

Specifies the \sty{babel}/\sty{polyglossia} language variant of a field if the datasource you are using supports this. The default, if no \prm{lang} option is set, this means to use the field variant in the datasource which has no explicit language defined.

\end{optionlist*}

\cmditem{literal}{characters}

Insert the literal \prm{characters} into the label at this point.

\end{ltxsyntax}

Note that the template for labels can be defined per-type and you should be aware of this when using the automatically disambiguated label functionality. Disambiguation is not per-type as this might lead to ambiguity due to different label formats for different types being isolated from each others disambiguation process. Normally, you will want to use very different label formats for different types to make the type obvious by the label.

Here are some examples. The default global \biblatex alphabetic label template is defined below. Firstly, \bibfield{shorthand} has \kvopt{final}{true} and so if there is a \bibfield{shorthand} field, it is used as the label and nothing more of the template is considered. Next, the \bibfield{label} field is used as the first label element if it exists. Otherwise, if there is only one name (\kvopt{ifnames}{1}) in the \bibfield{labelname} list, then three characters from the left side of the lastname in the \bibfield{labelname} are used as the first label element. If the \bibfield{labelname} has more than one name in it, one character from the left side of each lastname is used as the first label element. The second label element consists of 2 characters from the right side of the \bibfield{year} field.

\begin{lstlisting}[style=latex]{}
\DeclareLabelalphaTemplate{
  \labelelement{
    \field[final]{<<shorthand>>}
    \field{<<label>>}
    \field[strwidth=3,strside=left,ifnames=1]{<<labelname>>}
    \field[strwidth=1,strside=left]{<<labelname>>}
  }
  \labelelement{
    \field[strwidth=2,strside=right]{<<year>>}
  }
}
\end{lstlisting}
%
To get an idea of how the label automatic disambiguation works, consider the following author lists:

\begin{lstlisting}{}
Agassi, Chang, Laver   (2000)
Agassi, Connors, Lendl (2001)
Agassi, Courier, Laver (2002)
Borg, Connors, Edberg  (2003)
Borg, Connors, Emerson (2004)
\end{lstlisting}
%
Assuming a template declaration such as:

\begin{lstlisting}[style=latex]{}
\DeclareLabelalphaTemplate{
  \labelelement{
    \field[varwidth]{<<labelname>>}
  }
}
\end{lstlisting}
%
Then the labels would be:

\begin{lstlisting}{}
Agassi, Chang, Laver    [AChLa]
Agassi, Connors, Lendl  [AConLe]
Agassi, Courier, Laver  [ACouLa]
Borg, Connors, Edberg   [BConEd]
Borg, Connors, Emerson  [BConEm]
\end{lstlisting}
%
With normalised variable width labels defined:

\begin{lstlisting}[style=latex]{}
\DeclareLabelalphaTemplate{
  \labelelement{
    \field[varwidthnorm]{<<labelname>>}
  }
}
\end{lstlisting}
%
You would get the following as the substrings of names in each position are extended to the length of the longest substring in that same position:

\begin{lstlisting}{}
Agassi, Chang, Laver    [AChaLa]
Agassi, Connors, Lendl  [AConLe]
Agassi, Courier, Laver  [ACouLa]
Borg, Connors, Edberg   [BConEd]
Borg, Connors, Emerson  [BConEm]
\end{lstlisting}
%
With a restriction to two characters for the name components of the label element defined like this:

\begin{lstlisting}[style=latex]{}
\DeclareLabelalphaTemplate{
  \labelelement{
    \field[varwidthnorm,strwidthmax=2]{<<labelname>>}
  }
}
\end{lstlisting}
%
This would be the result (note that the individual lastname label parts are no longer unambiguous):

\begin{lstlisting}{}
Agassi, Chang, Laver    [AChLa]
Agassi, Connors, Lendl  [ACoLe]
Agassi, Courier, Laver  [ACoLa]
Borg, Connors, Edberg   [BCoEd]
Borg, Connors, Emerson  [BCoEm]
\end{lstlisting}
%
Alternatively, you could choose to disambiguate the name lists as a whole with:

\begin{lstlisting}[style=latex]{}
\DeclareLabelalphaTemplate{
  \labelelement{
    \field[varwidthlist]{<<labelname>>}
  }
}
\end{lstlisting}
%
Which would result in:

\begin{lstlisting}{}
Agassi, Chang, Laver    [AChL]
Agassi, Connors, Lendl  [ACoL]
Agassi, Courier, Laver  [ACL]
Borg, Connors, Edberg   [BCEd]
Borg, Connors, Emerson  [BCE]
\end{lstlisting}
%
Perhaps you only want to consider at most two names for label generation but disambiguate at the whole name list level:
\begin{lstlisting}[style=latex]{}
\DeclareLabelalphaTemplate{
  \labelelement{
    \field[varwidthlist,names=2]{<<labelname>>}
  }
}
\end{lstlisting}
%
Which would result in:
\begin{lstlisting}{}
Agassi, Chang, Laver    [ACh+]
Agassi, Connors, Lendl  [ACo+]
Agassi, Courier, Laver  [AC+]
Borg, Connors, Edberg   [BC+a]
Borg, Connors, Emerson  [BC+b]
\end{lstlisting}
%
In this last example, you can see \cmd{labelalphaothers} has been appended to show that there are more names. The last two labels now require disambiguating with \cmd{extraalpha} as there is no way of disambiguating this label name list with only two names.

Finally, here is an example using multiple label elements:

\begin{lstlisting}[style=latex]{}
\DeclareLabelalphaTemplate{
  \labelelement{
    \field[varwidthlist]{<<labelname>>}
  }
  \labelelement{
    \literal{-}
  }
  \labelelement{
    \field[strwidth=3,strside=right]{<<labelyear>>}
  }
}
\end{lstlisting}
%
Which would result in:
\begin{lstlisting}{}
Agassi, Chang, Laver    [AChL-000]
Agassi, Connors, Lendl  [AConL-001]
Agassi, Courier, Laver  [ACouL-002]
Borg, Connors, Edberg   [BCEd-003]
Borg, Connors, Emerson  [BCEm-004]
\end{lstlisting}
%
Here is another rather contrived example showing that you don't need to specially quote \latex special characters (apart from <\%>, obviously) when specifying padding characters and literals:

\begin{lstlisting}[style=latex]{}
\DeclareLabelalphaTemplate{
  \labelelement{
    \literal{>}
  }
  \labelelement{
    \literal{\%}
  }
  \labelelement{
    \field[strwidth=4, padchar=_]{<<labelname>>}
  }
  \labelelement{
    \field[strwidth=3, padchar=&, padside=left]{title}
  }
  \labelelement{
    \field[strwidth=2,strside=right]{<<year>>}
  }
}
\end{lstlisting}
%
which given:
\begin{lstlisting}[style=bibtex]{}
@Book{test,
  author    = {XXX YY},
  title     = {T},
  year      = {2007},
}
\end{lstlisting}
would resulting a label looking like this:
\begin{verbatim}
[>%YY__&&T07]
\end{verbatim}

\subsubsection{排序 Sorting}
\label{aut:ctm:srt}

In addition to the predefined sorting schemes discussed in \secref{use:srt}, it is possible to define new ones or modify the default definitions. The sorting process may be customized further by excluding certain fields from sorting on a per-type basis and by automatically populating the \bibfield{presort} field on a per-type basis. Note that custom sorting schemes require \biber. They will not work with any other backend.

\begin{ltxsyntax}

\cmditem{DeclareSortingScheme}[options]{name}{specification}\BiberOnlyMark

Defines the sorting scheme \prm{name}. The \prm{name} is the identifier passed to the \opt{sorting} option (\secref{use:opt:pre:gen}) when selecting the sorting scheme. The \cmd{DeclareSortingScheme} command supports the following optional arguments:

\begin{optionlist*}

\choitem{locale}{\prm{locale}}

The locale for the sorting scheme which then overrides the global sorting locale in the \opt{sortlocale} option discussed in \secref{use:opt:pre:gen}.

\end{optionlist*}

The \prm{specification} is an undelimited list of \cmd{sort} directives which specify the elements to be considered in the sorting process. Spaces, tabs, and line endings may be used freely to visually arrange the \prm{specification}. Blank lines are not permissible. This command may only be used in the preamble.

\cmditem{sort}{elements}

Specifies the elements considered in the sorting process. The \prm{elements} are an undelimited list of \cmd{field}, \cmd{literal}, and \cmd{citeorder} commands which are evaluated in the order in which they are given. If an element is defined, it is added to the sort key and the sorting routine skips to the next \cmd{sort} directive. If it is undefined, the next element is evaluated. Since literal strings are always defined, any \cmd{literal} commands should be the sole or the last element in a \cmd{sort} directive. The \cmd{sort} command supports the following optional arguments:

\begin{optionlist*}

\choitem{locale}{\prm{locale}}

Override the locale used for sorting at the level of a particular set of sorting elements. If specified, the locale overrides the locale set at the level of \cmd{DeclareSortingScheme} and also the global setting. See also the discussion of the global sorting locale option \opt{sortlocale} in \secref{use:opt:pre:gen}.

\choitem[ascending]{direction}{ascending, descending}

The sort direction, which may be either \texttt{ascending} or \texttt{descending}. The default is ascending order.

\boolitem[false]{final}

This option marks a \cmd{sort} directive as the final one in the \prm{specification}. If one of the \prm{elements} is available, the remainder of the \prm{specification} will be ignored. The short form \opt{final} is equivalent to \kvopt{final}{true}.

\boolitem{sortcase}

Whether or not to sort case"=sensitively. The default setting depends on the global \opt{sortcase} option.

\boolitem{sortupper}

Whether or not to sort in <uppercase before lowercase> (\texttt{true}) or <lowercase before uppercase> order (\texttt{false}). The default setting depends on the global \opt{sortupper} option.

\end{optionlist*}

\cmditem{field}[key=value, \dots]{field}

The \cmd{field} element adds a \prm{field} to the sorting specification. If the \prm{field} is undefined, the element is skipped. The \cmd{field} command supports the following optional arguments:

\begin{optionlist*}

\choitem[left]{padside}{left, right}

Pads a field on the \texttt{left} or \texttt{right} side using \opt{padchar} so that its width is \opt{padwidth}. If no padding option is set, no padding is done at all. If any padding option is specified, then padding is performed and the missing options are assigned built-in default values. If padding and substring matching are both specified, the substring match is performed first. Padding is particularly useful with numeric fields. For example, the command

\begin{lstlisting}[style=latex]{}
\field[padside=left,padwidth=2,padchar=0]{<<volume>>}
\end{lstlisting}
%
will pad the \bibfield{volume} field with leading zeros to a width of two characters. This way, volumes are sorted by numeric value (\texttt{01\slash 02\slash 11\slash 12}) rather than in alphabetic order (\texttt{1\slash 11\slash 12\slash 2}).

\intitem[4]{padwidth}

The target width in characters.

\valitem[0]{padchar}{character}

The character to be used when padding the field.

\choitem[left]{strside}{left, right}

Performs a substring match on the \texttt{left} or \texttt{right} side of the field. The number of characters to match is specified by the corresponding \texttt{strwidth} option. If no substring option is set, no substring matching is performed at all. If any substring option is specified, then substring matching is performed and the missing options are assigned built-in default values. If padding and substring matching are both specified, the substring match is performed first.

\intitem[4]{strwidth}

The number of characters to match.

\end{optionlist*}

\cmditem{literal}{string}

The \cmd{literal} element adds a literal \prm{string} to the sorting specification. This is useful as a fallback if some fields are not available.

\csitem{citeorder}

The \cmd{citeorder} element has a special meaning. It requests a sort based on the lexical order of the actual citations. For entries cited within the same citation command like:

\begin{lstlisting}[style=latex]{}
\cite{one,two}
\end{lstlisting}
%
there is a distinction between the lexical order and the semantic order. Here «one» and «two» have the same semantic order but a unique lexical order. The semantic order only matters if you specify further sorting to disambiguate entries with the same semantic order. For example, this is the definition of the \opt{none} sorting scheme:

\begin{lstlisting}[style=latex]{}
\DeclareSortingScheme{none}{
  \sort{\citeorder}
}
\end{lstlisting}
%
This sorts the bibliography purely lexically by the order of the keys in the citation commands. In the example above, it sorts «one» before «two». However, suppose that you consider «one» and «two» to have the same order (semantic order) since they are cited at the same time and want to further sort these by year. Suppose «two» has an earlier \bibfield{year} than «one»:

\begin{lstlisting}[style=latex]{}
\DeclareSortingScheme{noneyear}{
  \sort{\citeorder}
  \sort{<<year>>}
}
\end{lstlisting}
%
This sorts «two» before «one», even though lexically, «one» would sort before «two». This is possible because the semantic order can be disambiguated by the further sorting on year. With the standard \opt{none} sorting scheme, the lexical order and semantic order are identical because there is nothing further to disambiguate them. This means that you can use \cmd{citeorder} just like any other sorting specification element, choosing how to further sort entries cited at the same time (in the same citation command).

\end{ltxsyntax}

Here are some examples of sorting schemes. In the first example, we define a simple name\slash title\slash year scheme. The name element may be either the \bibfield{author}, the \bibfield{editor}, or the \bibfield{translator}. Given this specification, the sorting routine will use the first element which is available and continue with the \bibfield{title}. Note that the options \opt{use$<$name$>$} options are considered automatically in the sorting process:

\begin{lstlisting}[style=latex]{}
\DeclareSortingScheme{sample}{
  \sort{
    \field{<<author>>}
    \field{<<editor>>}
    \field{<<translator>>}
  }
  \sort{
    \field{<<title>>}
  }
  \sort{
    \field{<<year>>}
  }
}
\end{lstlisting}
%
In the next example, we define the same scheme in a more elaborate way, considering special fields such as \bibfield{presort}, \bibfield{sortkey}, \bibfield{sortname}, etc. Since the \bibfield{sortkey} field specifies the master sort key, it needs to override all other elements except for \bibfield{presort}. This is indicated by the \opt{final} option. If the \bibfield{sortkey} field is available, processing will stop at this point. If not, the sorting routine continues with the next \cmd{sort} directive. This setup corresponds to the default definition of the \texttt{nty} scheme:

\begin{lstlisting}[style=latex]{}
\DeclareSortingScheme{nty}{
  \sort{
    \field{<<presort>>}
  }
  \sort[final]{
    \field{<<sortkey>>}
  }
  \sort{
    \field{<<sortname>>}
    \field{<<author>>}
    \field{<<editor>>}
    \field{<<translator>>}
    \field{<<sorttitle>>}
    \field{<<title>>}
  }
  \sort{
    \field{<<sorttitle>>}
    \field{<<title>>}
  }
  \sort{
    \field{<<sortyear>>}
    \field{<<year>>}
  }
}
\end{lstlisting}
%
Finally, here is an example of a sorting scheme which overrides the global sorting locale and additionally overrides again when sorting by the \bibfield{origtitle} field. Note the use in the scheme-level override of a babel/polyglossia language name instead of a real locale identifier. \biber will map this to a suitable, real locale identifier (in this case, \texttt{sv\_SE}):

\begin{lstlisting}[style=latex]{}
\DeclareSortingScheme[locale=swedish]{custom}{
  \sort{
    \field{<<sortname>>}
    \field{<<author>>}
    \field{<<editor>>}
    \field{<<translator>>}
    \field{<<sorttitle>>}
    \field{<<title>>}
  }
  \sort[locale=de_DE_phonebook]{
    \field{<<origtitle>>}
  }
}
\end{lstlisting}

\begin{ltxsyntax}

\cmditem{DeclareSortExclusion}{entrytype, \dots}{field, \dots}\BiberOnlyMark

Specifies fields to be excluded from sorting on a per-type basis. The \prm{entrytype} argument and the \prm{field} argument may be a comma"=separated list of values. A blank \prm{field} argument will clear all exclusions for this \prm{entrytype}. This command may only be used in the preamble.

\cmditem{DeclarePresort}[entrytype, \dots]{string}\BiberOnlyMark

Specifies a string to be used to automatically populate the \bibfield{presort} field of entries without a \bibfield{presort} field. The \bibfield{presort} may be defined globally or on a per-type basis. If the optional \prm{entrytype} argument is given, the \prm{string} applies to the respective entry type. If not, it serves as the global default value. Specifying an \prm{entrytype} in conjunction with a blank \prm{string} will clear the type-specific setting. The \prm{entrytype} argument may be a comma"=separated list of values. This command may only be used in the preamble.

\end{ltxsyntax}

\subsubsection[参考文献表过滤器 Bibliography List Filters]{参考文献表过滤器 Bibliography List Filters\BiberOnlyMark}
\label{aut:ctm:bibfilt}

When using customisable bibliography lists (See \secref{use:bib:biblist}), usually one wants to return in the \file{.bbl} only those entries which have the particular fields which the bibliography list is summarising. For example, when printing a normal list of shorthands, you want the list returned by \biber in the \file{.bbl} to contain only those entries which have a \bibfield{shorthand} field. This is accomplished by defining a bibliography list filter using the \cmd{DeclareBiblistFilter} command. This differs from the filters defined using \cmd{defbibfilter} (see \secref{use:bib:flt}) since the filters defined by \cmd{defbibfilter} run inside \biblatex after the \file{.bbl} has been generated. In addition, bibliography lists in the \file{.bbl} do not contain entry data, only the citation keys for the entries and so no filtering by \biblatex using \cmd{defbibfilter} is possible for bibliography lists.

\begin{ltxsyntax}
\cmditem{DeclareBiblistFilter}{name}{specification}\BiberOnlyMark

Defines a bibliography list filter with \prm{name}. The \prm{specification} consists of one or more \cmd{filter} or \cmd{filteror} macros, all of which must be satisfied for the entry to pass the filter:

\cmditem{filter}{type}{filter}

Filter entries according to the \prm{type} and \prm{filter}. \prm{type} can be one of:

\end{ltxsyntax}

\begin{description}
\item[type/nottype] Entry is/is not of \bibfield{entrytype} \prm{filter}
\item[subtype/notsubtype] Entry is/is not of \bibfield{subtype} \prm{filter}
\item[keyword/notkeyword] Entry has/does not have \bibfield{keyword} \prm{filter}
\item[field/notfield] Entry has/does not have a field called \prm{filter}
\end{description}

\begin{ltxsyntax}
\cmditem{filteror}{type}{filters}

A wrapper around one or more \cmd{filter} commands specifying that they form a disjunctive set, i.e. any one of the \prm{filters} must be satisfied.

\end{ltxsyntax}

Fields in the datamodel which are marked as <Label fields> (see \secref{aut:ctm:dm}) automatically have a filter defined for them with the same name and which filters out any entries which do no contain the field. For example, \biblatex automatically generates a filter for the \bibfield{shorthand} field:

\begin{lstlisting}[style=latex]{}
\DeclareBiblistFilter{<<shorthand>>}{
  \filter[type=field,filter=shorthand]
}
\end{lstlisting}

\subsubsection{控制姓名首字母生成 Controlling Name Initials Generation}
\label{aut:ctm:noinit}

Generating initials for name parts from a given name involves some difficulties when you have names with prefixes, diacritics, hyphens etc. Often, you want to ignore things like prefixes when generating initials so that the initials for «al-Hasan» is just «H» instead of «a-H». This is tricky when you also have names like «Ho-Pun» where you want the initials to be «H-P», for example.

\begin{ltxsyntax}

\cmditem{DeclareNoinit}{specification}\BiberOnlyMark

Defines regular expressions to strip from names before generating initials. The \prm{specification} is an undelimited list of \cmd{noinit} directives which specify the regular expressions to remove from the name. Spaces, tabs and line endings may be used freely to visually arrange the \prm{specification}. Blank lines are not permissible. This command may only be used in the preamble.

\cmditem{noinit}{regexp}

Any number of \cmd{noinit} commands can be given each of which specifies to remove the \prm{regexp} from the copy of the name which the initials generation system sees. Since regular expressions usually contain special characters, it is best to enclose them in the provided \cmd{regexp} macro as shown---this will pass the expression through to \biber correctly.

\end{ltxsyntax}

If there is no \cmd{DeclareNoinit} specification, \biber will default to:

\begin{lstlisting}[style=latex]{}
\DeclareNoinit{
  % strip lowercase prefixes like 'al-' when generating initials from names
  \noinit{\regexp{<<\b\p{Ll}{2}\p{Pd}>>}}
  % strip some common diacritics when generating initials from names
  \noinit{\regexp{<<[\x{2bf}\x{2018}]>>}}
}
\end{lstlisting}
%
This \biber default strips a couple of diacritics and also strips lowercase prefixes from names before generating initials.

\subsubsection{排序微调 Fine Tuning Sorting}
\label{aut:ctm:nosort}
对排序微调是很有用的，它可以忽略一些特殊域的某些部分。
%It can be useful to fine tune sorting so that it ignores certain parts of particular fields.

\begin{ltxsyntax}

\cmditem{DeclareNosort}{specification}\BiberOnlyMark

Defines regular expressions to strip from particular fields or types of fields when sorting. The \prm{specification} is an undelimited list of \cmd{nosort} directives which specify the regular expressions to remove from particular fields or type of field. Spaces, tabs and line endings may be used freely to visually arrange the \prm{specification}. Blank lines are not permissible. This command may only be used in the preamble.

\cmditem{nosort}{field or field type}{regexp}

Any number of \cmd{nosort} commands can be given each of which specifies to remove the \prm{regexp} from the \prm{field} or \prm{field type}. A \prm{field type} is simple a convenience grouping of semantically similar fields from which you might want to remove a regexp. Table \ref{aut:nosort} shows the available field types. Since regular expressions usually contain special characters, it is best to enclose them in the provided \cmd{regexp} macro as shown---this will pass the expression through to \biber correctly.

\end{ltxsyntax}

If there is no \cmd{DeclareNosort} specification, \biber will default to:

\begin{lstlisting}[style=latex]{}
\DeclareNosort{
  % strip prefixes like 'al-' when sorting names
  \nosort{type_names}{\regexp{<<\A\p{L}{2}\p{Pd}>>}}
  % strip some diacritics when sorting names
  \nosort{type_names}{\regexp{<<[\x{2bf}\x{2018}]>>}}
}
\end{lstlisting}
%
This \biber default strips a couple of diacritics and also strips prefixes from names when sorting. Suppose you wanted to ignore «The» at the beginning of a \bibfield{title} field when sorting:

\begin{lstlisting}[style=latex]{}
\DeclareNosort{
  \nosort{<<title>>}{\regexp{<<\AThe\s+>>}}
}
\end{lstlisting}
%
Or if you wanted to ignore «The» at the beginning of any title field:

\begin{lstlisting}[style=latex]{}
\DeclareNosort{
  \nosort{<<type_title>>}{\regexp{<<\AThe\s+>>}}
}
\end{lstlisting}

\begin{table}[h]
\tablesetup
\begin{tabular}{@{}V{0.5\textwidth}@{}V{0.5\textwidth}@{}}
\toprule
\multicolumn{1}{@{}H}{Field Type} &
\multicolumn{1}{@{}H}{Fields} \\
\cmidrule(r){1-1}\cmidrule{2-2}
|type_name| & |author| \\
             & |afterword| \\
             & |annotator| \\
             & |bookauthor| \\
             & |commentator| \\
             & |editor| \\
             & |editora| \\
             & |editorb| \\
             & |editorc| \\
             & |foreword| \\
             & |holder| \\
             & |introduction| \\
             & |namea| \\
             & |nameb| \\
             & |namec| \\
             & |shortauthor| \\
             & |shorteditor| \\
             & |translator| \\
|type_title| & |booktitle| \\
              & |eventtitle| \\
              & |issuetitle| \\
              & |journaltitle| \\
              & |maintitle| \\
              & |origtitle| \\
              & |title| \\
\bottomrule
\end{tabular}
\caption{Field types for \cmd{nosort}}
\label{aut:nosort}
\end{table}

\subsubsection{特殊域 Special Fields}
\label{aut:ctm:fld}

Some of the automatically generated fields from \secref{aut:bbx:fld:lab} may be customized. Note that this requires \biber.

\begin{ltxsyntax}

\cmditem{DeclareLabelname}[entrytype, \dots]{specification}\BiberOnlyMark

Defines the fields to consider when generating the \bibfield{labelname} field (see \secref{aut:bbx:fld:lab}). The \prm{specification} is an ordered list of \cmd{field} commands. The fields are checked in the order listed and the first field which is available will be used as \bibfield{labelname}. This is the default definition:

\begin{lstlisting}[style=latex]{}
\DeclareLabelname{%
  \field{shortauthor}
  \field{author}
  \field{shorteditor}
  \field{editor}
  \field{translator}
}
\end{lstlisting}
%
The \bibfield{labelname} field may be customized globally or on a per-type basis. If the optional \prm{entrytype} argument is given, the specification applies to the respective entry type. If not, it is applied globally. The \prm{entrytype} argument may be a comma"=separated list of values. This command may only be used in the preamble.

\cmditem{DeclareLabeldate}[entrytype, \dots]{specification}\BiberOnlyMark

Defines the date components to consider when generating \bibfield{labelyear}, \bibfield{labelmonth} and \bibfield{labelday} fields (see \secref{aut:bbx:fld:lab}). The \prm{specification} is an ordered list of \cmd{field} or \cmd{literal} commands. The items are checked in the order listed and the first item which is available will be used to popluate the \bibfield{labelyear}, \bibfield{labelmonth} and \bibfield{labelday} fields. Note that the \cmd{field} items do not have to be datetype <date> in the data model so that you can create pseudo-year labels by, for example, using a \bibfield{pubstate} field contents, if available, as the year label by defining \cmd{DeclareLabeldate} suitably. Note also that a \cmd{literal} command will always be used when found and so this should always be the last thing in the list. If the value of a \cmd{literal} command is a valid localization string, then this will be resolved in the current language, otherwise the value is used as a literal string as-is. This is the default definition:

\begin{lstlisting}[style=latex]{}
\DeclareLabeldate{%
  \field{date}
  \field{eventdate}
  \field{origdate}
  \field{urldate}
  \literal{nodate}
}
\end{lstlisting}
%
Note that the \bibfield{date} field is split by the backend into \bibfield{year}, \bibfield{month} which are also valid fields in the default data model. In order to support legacy data which directly sets \bibfield{year} and/or \bibfield{month}, the specification <\bibfield{date}> in \cmd{DeclareLabeldate} will also match \bibfield{year} and \bibfield{month} fields, if present.
The \bibfield{labelyear}, \bibfield{labelmonth} and \bibfield{labelday} fields may be customized globally or on a per-type basis. If the optional \prm{entrytype} argument is given, the specification applies to the respective entry type. If not, it is applied globally. The \prm{entrytype} argument may be a comma"=separated list of values. This command may only be used in the preamble. See also \secref{aut:bbx:fld:dat}.

\cmditem{DeclareLabeltitle}[entrytype, \dots]{specification}\BiberOnlyMark

Defines the fields to consider when generating the \bibfield{labeltitle} field (see \secref{aut:bbx:fld:lab}). The \prm{specification} is an ordered list of \cmd{field} commands. The fields are checked in the order listed and the first field which is available will be used as \bibfield{labeltitle}. This is the default definition:

\begin{lstlisting}[style=latex]{}
\DeclareLabeltitle{%
  \field{shorttitle}
  \field{title}
}
\end{lstlisting}
%
The \bibfield{labeltitle} field may be customized globally or on a per-type basis. If the optional \prm{entrytype} argument is given, the specification applies to the respective entry type. If not, it is applied globally. The \prm{entrytype} argument may be a comma"=separated list of values. This command may only be used in the preamble.

\end{ltxsyntax}

\subsubsection{数据继承 Data Inheritance (\bibfield{crossref})}
\label{aut:ctm:ref}

\biber features a highly customizable cross-referencing mechanism with flexible data inheritance rules. This sections deals with the configuration interface. See \apxref{apx:ref} for the default configuration. Note that customized data inheritance requires \biber. It will not work with any other backend. A note on terminology: the \emph{child} or \emph{target} is the entry with the \bibfield{crossref} field, the \emph{parent} or \emph{source} is the entry the \bibfield{crossref} field points to. The child inherits data from the parent.

\begin{ltxsyntax}

\cmditem{DefaultInheritance}[exceptions]{options}\BiberOnlyMark

Configures the default inheritance behavior. This command may only be used in the preamble. The default behavior may be customized be setting the following \prm{options}:

\begin{optionlist*}

\boolitem[true]{all} Whether or not to inherit all fields from the parent by default. \kvopt{all}{true} means that the child entry inherits all fields from the parent, unless a more specific inheritance rule has been set up with \cmd{DeclareDataInheritance}. If an inheritance rule is defined for a field, data inheritance is controlled by that rule. \kvopt{all}{false} means that no data is inherited from the parent by default. Each field to be inherited requires an explicit inheritance rule set up with \cmd{DeclareDataInheritance}. The package default is \kvopt{all}{true}.

\boolitem[false]{override} Whether or not to overwrite target fields with source fields if both are defined. This applies both to automatic inheritance and to explicit inheritance rules. The package default is \kvopt{override}{false}, \ie existing fields of the child entry are not overwritten.

\end{optionlist*}

The optional \prm{exceptions} are an undelimited list of \cmd{except} directives. Spaces, tabs, and line endings may be used freely to visually arrange the \prm{exceptions}. Blank lines are not permissible.

\cmditem{except}{source}{target}{options}

Sets the \prm{options} for a specific \prm{source} and \prm{target} combination. The \prm{source} and \prm{target} arguments specify the parent and the child entry type. The asterisk matches all types and is permissible in either argument.

\cmditem{DeclareDataInheritance}{source, \dots}{target, \dots}{rules}\BiberOnlyMark

Declares inheritance rules. The \prm{source} and \prm{target} arguments specify the parent and the child entry type. Either argument may be a single entry type, a comma"=separated list of types, or an asterisk. The asterisk matches all entry types. The \prm{rules} are an undelimited list of \cmd{inherit} and\slash or \cmd{noinherit} directives. Spaces, tabs, and line endings may be used freely to visually arrange the \prm{rules}. Blank lines are not permissible. This command may only be used in the preamble.

\cmditem{inherit}[option]{source}{target}

Defines an inheritance rule by mapping a \prm{source} field to a \prm{target} field. The \prm{option} is the \opt{override} option explained above. When set locally, it takes precedence over any global options set with \cmd{DefaultInheritance}.

\cmditem{noinherit}{source}

Unconditionally prevents inheritance of the \prm{source} field.

\csitem{ResetDataInheritance}\BiberOnlyMark

Clears all inheritance rules defined with \cmd{DeclareDataInheritance}. This command may only be used in the preamble.

\end{ltxsyntax}

Here are some practical examples:

\begin{lstlisting}[style=latex]{}
\DefaultInheritance{<<all=true>>,<<override=false>>}
\end{lstlisting}
%
This example shows how to configure the default inheritance behavior. The above settings are the package defaults.

\begin{lstlisting}[style=latex]{}
\DefaultInheritance[
  \except{<<*>>}{<<online>>}{<<all=false>>}
]{all=true,override=false}
\end{lstlisting}
%
This example is similar to the one above but adds one exception: entries of type \bibtype{online} will, by default, not inherit any data from any parent.

\begin{lstlisting}[style=latex]{}
\DeclareDataInheritance{<<collection>>}{<<incollection>>}{
  \inherit{<<title>>}{<<booktitle>>}
  \inherit{<<subtitle>>}{<<booksubtitle>>}
  \inherit{<<titleaddon>>}{<<booktitleaddon>>}
}
\end{lstlisting}
%
So far we have looked at setting up the defaults. For example, \kvopt{all}{true} means that the \bibfield{publisher} field of a source entry is copied to the \bibfield{publisher} field of the target entry. In some cases, however, asymmetric mappings are required. They are defined with \cmd{DeclareDataInheritance}. The above example sets up three typical rules for \bibtype{incollection} entries referencing a \bibtype{collection}. We map the \bibfield{title} and related fields of the source to the corresponding \bibfield{booktitle} fields of the target.

\begin{lstlisting}[style=latex]{}
\DeclareDataInheritance{<<mvbook,book>>}{<<inbook,bookinbook>>}{
  \inherit{<<author>>}{<<author>>}
  \inherit{<<author>>}{<<bookauthor>>}
}
\end{lstlisting}
%
This rule is an example of one-to-many mapping: it maps the \bibfield{author} field of the source to both the \bibfield{author} and the \bibfield{bookauthor} fields of the target in order to allow for compact \bibfield{inbook}\slash \bibfield{bookinbook} entries. The source may be either a \bibtype{mvbook} or a \bibtype{book} entry, the target either an \bibtype{inbook} or a \bibtype{bookinbook} entry.

\begin{lstlisting}[style=latex]{}
\DeclareDataInheritance{<<*>>}{<<inbook,incollection>>}{
  \noinherit{<<introduction>>}
}
\end{lstlisting}
%
This rule prevents inheritance of the \bibfield{introduction} field. It applies to all targets of type
\bibtype{inbook} or \bibtype{incollection}, regardless of the source entry type.

\begin{lstlisting}[style=latex]{}
\DeclareDataInheritance{<<*>>}{<<*>>}{
  \noinherit{<<abstract>>}
}
\end{lstlisting}
%
This rule, which applies to all entries, regardless of the source and target entry types, prevents inheritance of the \bibfield{abstract} field.

\begin{lstlisting}[style=latex]{}
\DefaultInheritance{all=true,override=false}
\ResetDataInheritance
\end{lstlisting}
%
This example demonstrates how to emulate traditional \bibtex's cross"=referencing mechanism. It enables inheritance by default, disables overwriting, and clears all other inheritance rules and mappings.

\subsection{辅助命令 Auxiliary Commands}
\label{aut:aux}
本节的工具用来分析和保存参考文献数据而不是格式化或者打印它们。
%The facilities in this section are intended for analyzing and saving bibliographic data rather than formatting and printing it.

\subsubsection{数据命令}%Data Commands
\label{aut:aux:dat}
本节的命令允许以low"=level方式访问未格式化的参考文献数据。这些命令不是用来输出，而是用来将数据保存到临时宏中，可以用于下一步的比较。
%The commands in this section grant low"=level access to the unformatted bibliographic data. They are not intended for typesetting but rather for things like saving data to a temporary macro so that it may be used in a comparison later.

\begin{ltxsyntax}

\cmditem{thefield}{field}
展开为未格式化的\prm{field}。如果\prm{field}未定义那么展开为一个空字符串。

%Expands to the unformatted \prm{field}. If the \prm{field} is undefined, this command expands to an empty string.

\cmditem{strfield}{field}

类似于\cmd{thefield}命令，但其值经自动净化，以便安全的用于构成控制序列名。
%Similar to \cmd{thefield}, except that the field is automatically sanitized such that its value may safely be used in the formation of a control sequence name.

\cmditem{csfield}{field}
类似于\cmd{thefield}命令，但禁止展开
%Similar to \cmd{thefield}, but prevents expansion.

\cmditem{usefield}{command}{field}
执行\prm{command}命令使用未格式化的\prm{field}作为其参数
%Executes \prm{command} using the unformatted \prm{field} as its argument.

\cmditem{thelist}{literal list}
展开为未格式化的\prm{literal list}。如果list未定义那么展开为一个空字符串。注意该命令中将\prm{literal list}转存为本宏包使用的内部格式。这一格式不适合打印。
%Expands to the unformatted \prm{literal list}. If the list is undefined, this command expands to an empty string. Note that this command will dump the \prm{literal list} in the internal format used by this package. This format is not suitable for printing.

\cmditem{thename}{name list}
展开为未格式化的\prm{name list}。如果list未定义那么展开为一个空字符串。注意该命令中将\prm{name list}转存为本宏包使用的内部格式。这一格式不适合打印。
%Expands to the unformatted \prm{name list}. If the list is undefined, this command expands to an empty string. Note that this command will dump the \prm{name list} in the internal format used by this package. This format is not suitable for printing.

\cmditem{savefield}{field}{macro}
\cmditem*{savefield*}{field}{macro}
将未格式化的\prm{field}拷贝到一个\prm{macro}中。不带星的命令全局的定义\prm{macro}，而带星的命令是局部定义。
%Copies an unformatted \prm{field} to a \prm{macro}. The regular variant of this command defines the \prm{macro} globally, the starred one works locally.

\cmditem{savelist}{literal list}{macro}
\cmditem*{savelist*}{literal list}{macro}
将未格式化的\prm{literal list}拷贝到一个\prm{macro}中。不带星的命令全局的定义\prm{macro}，而带星的命令是局部定义。
%Copies an unformatted \prm{literal list} to a \prm{macro}. The regular variant of this command defines the \prm{macro} globally, the starred one works locally.

\cmditem{savename}{name list}{macro}
\cmditem*{savename*}{name list}{macro}
将未格式化的\prm{name list}拷贝到一个\prm{macro}中。不带星的命令全局的定义\prm{macro}，而带星的命令是局部定义。
%Copies an unformatted \prm{name list} to a \prm{macro}. The regular variant of this command defines the \prm{macro} globally, the starred one works locally.

\cmditem{savefieldcs}{field}{csname}
\cmditem*{savefieldcs*}{field}{csname}
类似于\cmd{savefield}命令，当将控制序列名\prm{csname}(即没有斜杠)作为参数，而不是宏。
%Similar to \cmd{savefield}, but takes the control sequence name \prm{csname} (without a leading backslash) as an argument, rather than a macro name.

\cmditem{savelistcs}{literal list}{csname}
\cmditem*{savelistcs*}{literal list}{csname}
类似于\cmd{savelist}命令，当将控制序列名\prm{csname}(即没有斜杠)作为参数，而不是宏。
%Similar to \cmd{savelist}, but takes the control sequence name \prm{csname} (without a leading backslash) as an argument, rather than a macro name.

\cmditem{savenamecs}{name list}{csname}
\cmditem*{savenamecs*}{name list}{csname}
类似于\cmd{savename}命令，当将控制序列名\prm{csname}(即没有斜杠)作为参数，而不是宏。
%Similar to \cmd{savename}, but takes the control sequence name \prm{csname} (without a leading backslash) as an argument, rather than a macro name.

\cmditem{restorefield}{field}{macro}
从之前用\cmd{savefield}命令定义的\prm{macro}中将\prm{field}恢复回来。该域是在局部范围内恢复。
%Restores a \prm{field} from a \prm{macro} defined with \cmd{savefield} before. The field is restored within a local scope.

\cmditem{restorelist}{literal list}{macro}
从之前用\cmd{savelist}命令定义的\prm{macro}中将\prm{literal list}恢复回来。该list是在局部范围内恢复。
%Restores a \prm{literal list} from a \prm{macro} defined with \cmd{savelist} before. The list is restored within a local scope.

\cmditem{restorename}{name list}{macro}
从之前用\cmd{savename}命令定义的\prm{macro}中将\prm{name list}恢复回来。该list是在局部范围内恢复。
%Restores a \prm{name list} from a \prm{macro} defined with \cmd{savename} before. The list is restored within a local scope.

\cmditem{clearfield}{field}
在局部范围内清除\prm{field}。以这种方式清除的域对于后续的数据命令来说相当于没有定义。
%Clears the \prm{field} within a local scope. A field cleared this way is treated as undefined by subsequent data commands.

\cmditem{clearlist}{literal list}
在局部范围内清除\prm{literal list}。以这种方式清除的list对于后续的数据命令来说相当于没有定义。
%Clears the \prm{literal list} within a local scope. A list cleared this way is treated as undefined by subsequent data commands.

\cmditem{clearname}{name list}
在局部范围内清除\prm{name list}。以这种方式清除的list对于后续的数据命令来说相当于没有定义。
%Clears the \prm{name list} within a local scope. A list cleared this way is treated as undefined by subsequent data commands.

\end{ltxsyntax}

\subsubsection{独立判断命令}%Stand-alone Tests
\label{aut:aux:tst}
本节的命令是不同类型的stand"=alone判断命令，用于参考文献著录和标注样式中。
%The commands in this section are various kinds of stand"=alone tests for use in bibliography and citation styles.

\begin{ltxsyntax}

\cmditem{iffieldundef}{field}{true}{false}
展开为\prm{true}，如果\prm{field}未定义，否则展开为\prm{false}
%Expands to \prm{true} if the \prm{field} is undefined, and to \prm{false} otherwise.

\cmditem{iflistundef}{literal list}{true}{false}
展开为\prm{true}，如果\prm{literal list}未定义，否则展开为\prm{false}
%Expands to \prm{true} if the \prm{literal list} is undefined, and to \prm{false} otherwise.

\cmditem{ifnameundef}{name list}{true}{false}
展开为\prm{true}，如果\prm{name list}未定义，否则展开为\prm{false}
%Expands to \prm{true} if the \prm{name list} is undefined, and to \prm{false} otherwise.

\cmditem{iffieldsequal}{field 1}{field 2}{true}{false}
展开为\prm{true}，如果\prm{field 1}和\prm{field 2}相等，否则展开为\prm{false}
%Expands to \prm{true} if the values of \prm{field 1} and \prm{field 2} are equal, and to \prm{false} otherwise.

\cmditem{iflistsequal}{literal list 1}{literal list 2}{true}{false}
展开为\prm{true}，如果\prm{literal list 1}和\prm{literal list 2}相等，否则展开为\prm{false}
%Expands to \prm{true} if the values of \prm{literal list 1} and \prm{literal list 2} are equal, and to \prm{false} otherwise.

\cmditem{ifnamesequal}{name list 1}{name list 2}{true}{false}
展开为\prm{true}，如果\prm{name list 1}和\prm{name list 2}相等，否则展开为\prm{false}
%Expands to \prm{true} if the values of \prm{name list 1} and \prm{name list 2} are equal, and to \prm{false} otherwise.

\cmditem{iffieldequals}{field}{macro}{true}{false}
展开为\prm{true}，如果\prm{field}的值和\prm{macro}的定义相等，否则展开为\prm{false}。\footnote{可以用于改进gb7714-2015中的新闻和标准的判断}
%Expands to \prm{true} if the value of the \prm{field} is equal to the definition of \prm{macro}, and to \prm{false} otherwise.

\cmditem{iflistequals}{literal list}{macro}{true}{false}
展开为\prm{true}，如果\prm{literal list}的值和\prm{macro}的定义相等，否则展开为\prm{false}。
%Expands to \prm{true} if the value of the \prm{literal list} is equal to the definition of \prm{macro}, and to \prm{false} otherwise.

\cmditem{ifnameequals}{name list}{macro}{true}{false}
展开为\prm{true}，如果\prm{name list}的值和\prm{macro}的定义相等，否则展开为\prm{false}。
%Expands to \prm{true} if the value of the \prm{name list} is equal to the definition of \prm{macro}, and to \prm{false} otherwise.

\cmditem{iffieldequalcs}{field}{csname}{true}{false}
类似于\cmd{iffieldequals}，但将控制序列名\prm{csname}(不带斜杠)作为参数，而不是一个宏名。
%Similar to \cmd{iffieldequals} but takes the control sequence name \prm{csname} (without a leading backslash) as an argument, rather than a macro name.

\cmditem{iflistequalcs}{literal list}{csname}{true}{false}
类似于\cmd{iflistequals}，但将控制序列名\prm{csname}(不带斜杠)作为参数，而不是一个宏名。
%Similar to \cmd{iflistequals} but takes the control sequence name \prm{csname} (without a leading backslash) as an argument, rather than a macro name.

\cmditem{ifnameequalcs}{name list}{csname}{true}{false}
类似于\cmd{ifnameequals}，但将控制序列名\prm{csname}(不带斜杠)作为参数，而不是一个宏名。
%Similar to \cmd{ifnameequals} but takes the control sequence name \prm{csname} (without a leading backslash) as an argument, rather than a macro name.

\cmditem{iffieldequalstr}{field}{string}{true}{false}
展开为\prm{true}，如果\prm{field}的值和字符串\prm{string}的定义相等，否则展开为\prm{false}。该命令是鲁棒的。
%Executes \prm{true} if the value of the \prm{field} is equal to \prm{string}, and \prm{false} otherwise. This command is robust.

\cmditem{iffieldxref}{field}{true}{false}
如果一个条目定义了\bibfield{crossref}\slash \bibfield{xref}，该命令检测\prm{field}是否与cross"=referenced父条目相关联。如果子条目的\prm{field}与父条目对应的\prm{field}相等，那么执行\prm{true}，否则执行\prm{false}。如果\bibfield{crossref}\slash \bibfield{xref}未定义，总是执行\prm{false}。该命令是鲁棒的。\bibfield{crossref}和 \bibfield{xref}域的描述见\secref{bib:fld:spc}，更多关于cross"=referencing的信息见\secref{bib:cav:ref}。
%If the \bibfield{crossref}\slash \bibfield{xref} field of an entry is defined, this command checks if the \prm{field} is related to the cross"=referenced parent entry. It executes \prm{true} if the \prm{field} of the child entry is equal to the corresponding \prm{field} of the parent entry, and \prm{false} otherwise. If the \bibfield{crossref}\slash \bibfield{xref} field is undefined, it always executes \prm{false}. This command is robust. See the description of the \bibfield{crossref} and \bibfield{xref} fields in \secref{bib:fld:spc} as well as \secref{bib:cav:ref} for further information concerning cross"=referencing.

\cmditem{iflistxref}{literal list}{true}{false}
类似于\cmd{iffieldxref}命令，但检测\prm{literal list}是否与cross"=referenced父条目相关联。
\bibfield{crossref}和 \bibfield{xref}域的描述见\secref{bib:fld:spc}，更多关于cross"=referencing的信息见\secref{bib:cav:ref}。
%Similar to \cmd{iffieldxref} but checks if a \prm{literal list} is related to the cross"=referenced parent entry. See the description of the \bibfield{crossref} and \bibfield{xref} fields in \secref{bib:fld:spc} as well as \secref{bib:cav:ref} for further information concerning cross"=referencing.

\cmditem{ifnamexref}{name list}{true}{false}
类似于\cmd{iffieldxref}命令，但检测\prm{name list}是否与cross"=referenced父条目相关联。
\bibfield{crossref}和 \bibfield{xref}域的描述见\secref{bib:fld:spc}，更多关于cross"=referencing的信息见\secref{bib:cav:ref}。
%Similar to \cmd{iffieldxref} but checks if a \prm{name list} is related to the cross"=referenced parent entry. See the description of the \bibfield{crossref} and \bibfield{xref} fields in \secref{bib:fld:spc} as well as \secref{bib:cav:ref} for further information concerning cross"=referencing.

\cmditem{ifcurrentfield}{field}{true}{false}
执行\prm{true}，如果当前域为\prm{field}，否则执行\prm{false}。该命令是鲁棒的。它主要用于域格式指令中，如果在其它环境中总是执行\prm{false}。
%Executes \prm{true} if the current field is \prm{field}, and \prm{false} otherwise. This command is robust. It is intended for use in field formatting directives and always executes \prm{false} when used in any other context.

\cmditem{ifcurrentlist}{literal list}{true}{false}
执行\prm{true}，如果当前list为\prm{literal list}，否则执行\prm{false}。该命令是鲁棒的。它主要用于域格式指令中，如果在其它环境中总是执行\prm{false}。
%Executes \prm{true} if the current list is \prm{literal list}, and \prm{false} otherwise. This command is robust. It is intended for use in list formatting directives and always executes \prm{false} when used in any other context.

\cmditem{ifcurrentname}{name list}{true}{false}
执行\prm{true}，如果当前list为\prm{name list}，否则执行\prm{false}。该命令是鲁棒的。它主要用于域格式指令中，如果在其它环境中总是执行\prm{false}。
%Executes \prm{true} if the current list is \prm{name list}, and \prm{false} otherwise. This command is robust. It is intended for use in list formatting directives and always executes \prm{false} when used in any other context.

\cmditem{ifuseprefix}{true}{false}
执行\prm{true}，如果\opt{useprefix}选项打开(无论是全局的还是针对当前条目)，否则执行\prm{false}。该选项的细节见\secref{use:opt:bib}。
%Expands to \prm{true} if the \opt{useprefix} option is enabled (either globally or for the current entry), and \prm{false} otherwise. See \secref{use:opt:bib} for details on this option.

\cmditem{ifuseauthor}{true}{false}
这只是下面的\cmd{ifuse$<$name$>$}宏的一个特例，因为\bibfield{author}是默认数据模型的一部分所以放到这里来说。执行\prm{true}，如果\opt{useauthor}选项打开(无论是全局的还是针对当前条目)，否则执行\prm{false}。该选项的细节见\secref{use:opt:bib}。
%This is just a particular case of the \cmd{ifuse$<$name$>$} macro below but is mentioned here as \bibfield{author} is part of the default data model. Expands to \prm{true} if the \opt{useauthor} option is enabled (either globally or for the current entry), and \prm{false} otherwise. See \secref{use:opt:bib} for details on this option.

\cmditem{ifuseeditor}{true}{false}
这只是下面的\cmd{ifuse$<$name$>$}宏的一个特例，因为\bibfield{editor}是默认数据模型的一部分所以放到这里来说。执行\prm{true}，如果\opt{useeditor}选项打开(无论是全局的还是针对当前条目)，否则执行\prm{false}。该选项的细节见\secref{use:opt:bib}。
%This is just a particular case of the \cmd{ifuse$<$name$>$} macro below but is mentioned here as \bibfield{editor} is part of the default data model. Expands to \prm{true} if the \opt{useeditor} option is enabled (either globally or for the current entry), and \prm{false} otherwise. See \secref{use:opt:bib} for details on this option.

\cmditem{ifusetranslator}{true}{false}
这只是下面的\cmd{ifuse$<$name$>$}宏的一个特例，因为\bibfield{translator}是默认数据模型的一部分所以放到这里来说。执行\prm{true}，如果\opt{usetranslator}选项打开(无论是全局的还是针对当前条目)，否则执行\prm{false}。该选项的细节见\secref{use:opt:bib}。
%This is just a particular case of the \cmd{ifuse$<$name$>$} macro below but is mentioned here as \bibfield{translator} is part of the default data model. Expands to \prm{true} if the \opt{usetranslator} option is enabled (either globally or for the current entry), and \prm{false} otherwise. See \secref{use:opt:bib} for details on this option.

\cmditem{ifuse$<$name$>$}{true}{false}

Expands to \prm{true} if the \opt{use$<$name$>$} option is enabled (either globally or for the current entry), and \prm{false} otherwise. See \secref{use:opt:bib} for details on this option.

\cmditem{ifsingletitle}{true}{false}

Expands to \prm{true} if there is only one work by the \opt{labelname} name in the bibliography, and to \prm{false} otherwise. If there is no \opt{labelname} name at all for the entry, then this expands to \prm{true} if there is only one work with the \opt{labeltitle} title in the bibliography and \prm{false} otherwise. If neither \opt{labelname} nor \opt{labeltitle} are set for an entry, this will always expand to \prm{false}. Note that this feature needs to be enabled explicitly with the package option \opt{singletitle}.

\cmditem{ifandothers}{list}{true}{false}

Expands to \prm{true} if the \prm{list} is defined and has been truncated in the \file{bib} file with the keyword <\texttt{and others}>, and to \prm{false} otherwise. The \prm{list} may be a literal list or a name list.

\cmditem{ifmorenames}{true}{false}

Expands to \prm{true} if the current name list has been or will be truncated, and to \prm{false} otherwise. This command is intended for use in formatting directives for name lists. It will always expand to \prm{false} when used elsewhere. This command performs the equivalent of an \cmd{ifandothers} test for the current list. If this test is negative, it also checks if the \cnt{listtotal} counter is larger than \cnt{liststop}. This command may be used in a formatting directive to decide if a note such as «and others» or «et al.» is to be printed at the end of the list. Note that you still need to check whether you are in the middle or at the end of the list, \ie whether \cnt{listcount} is smaller than or equal to \cnt{liststop}, see \secref{aut:bib:dat} for details.

\cmditem{ifmoreitems}{true}{false}

This command is similar to \cmd{ifmorenames} but checks the current literal list. It is intended for use in formatting directives for literal lists. It will always expand to \prm{false} when used elsewhere.

\cmditem{iffirstinits}{true}{false}

Expands to \prm{true} or \prm{false}, depending on the state of the \opt{firstinits} package option (see \secref{use:opt:pre:int}). This command is intended for use in formatting directives for name lists.

\cmditem{ifterseinits}{true}{false}

Expands to \prm{true} or \prm{false}, depending on the state of the \opt{terseinits} package option (see \secref{use:opt:pre:int}). This command is intended for use in formatting directives for name lists.

\cmditem{ifentrytype}{type}{true}{false}

Executes \prm{true} if the entry type of the entry currently being processed is \prm{type}, and \prm{false} otherwise.

\cmditem{ifkeyword}{keyword}{true}{false}

Executes \prm{true} if the \prm{keyword} is found in the \bibfield{keywords} field of the entry currently being processed, and \prm{false} otherwise.

\cmditem{ifentrykeyword}{entrykey}{keyword}{true}{false}

A variant of \cmd{ifkeyword} which takes an entry key as its first argument. This is useful for testing an entry other than the one currently processed.

\cmditem{ifcategory}{category}{true}{false}

Executes \prm{true} if the entry currently being processed has been assigned to a \prm{category} with \cmd{addtocategory}, and \prm{false} otherwise.

\cmditem{ifentrycategory}{entrykey}{category}{true}{false}

A variant of \cmd{ifcategory} which takes an entry key as its first argument. This is useful for testing an entry other than the one currently processed.

\cmditem{ifciteseen}{true}{false}

Executes \prm{true} if the entry currently being processed has been cited before, and \prm{false} otherwise. This command is robust and intended for use in citation styles. If there are any \env{refsection} environments in the document, the citation tracking is local to these environments. Note that the citation tracker needs to be enabled explicitly with the package option \opt{citetracker}. The behavior of this test depends on the mode the citation tracker is operating in, see \secref{use:opt:pre:int} for details. If the citation tracker is disabled, the test always yields \prm{false}. Also see the \cmd{citetrackertrue} and \cmd{citetrackerfalse} switches in \secref{aut:aux:msc}.

\cmditem{ifentryseen}{entrykey}{true}{false}

A variant of \cmd{ifciteseen} which takes an entry key as its first argument. Since the \prm{entrykey} is expanded prior to performing the test, it is possible to test for entry keys in a field such as \bibfield{xref}:

\begin{lstlisting}[style=latex]{}
\ifentryseen{<<\thefield{xref}>>}{true}{false}
\end{lstlisting}
%
Apart from the additional argument, \cmd{ifentryseen} behaves like \cmd{ifciteseen}.

\cmditem{ifentryinbib}{entrykey}{true}{false}

Executes \prm{true} if the entry \prm{entrykey} appears in the current bibliography, and \prm{false} otherwise. This command is intended for use in bibliography styles.

\cmditem{iffirstcitekey}{true}{false}

Executes \prm{true} if the entry currently being processed is the first one in the citation list, and \prm{false} otherwise. This command relies on the \cnt{citecount}, \cnt{citetotal}, \cnt{multicitecount} and \cnt{multicitetotal} counters (\secref{aut:fmt:ilc}) and thus is intended for use only in the \prm{loopcode} of a citation command defined with \cmd{DeclareCiteCommand}.

\cmditem{iflastcitekey}{true}{false}

Similar \cmd{iffirstcitekey}, but executes \prm{true} if the entry currently being processed is the last one in the citation list, and \prm{false} otherwise.

\cmditem{ifciteibid}{true}{false}

Expands to \prm{true} if the entry currently being processed is the same as the last one, and to \prm{false} otherwise. This command is intended for use in citation styles. If there are any \env{refsection} environments in the document, the tracking is local to these environments. Note that the <ibidem> tracker needs to be enabled explicitly with the package option \opt{ibidtracker}. The behavior of this test depends on the mode the tracker is operating in, see \secref{use:opt:pre:int} for details. If the tracker is disabled, the test always yields \prm{false}. Also see the \cmd{citetrackertrue} and \cmd{citetrackerfalse} switches in \secref{aut:aux:msc}.

\cmditem{ifciteidem}{true}{false}

Expands to \prm{true} if the primary name (\ie the author or editor) in the entry currently being processed is the same as the last one, and to \prm{false} otherwise. This command is intended for use in citation styles. If there are any \env{refsection} environments in the document, the tracking is local to these environments. Note that the <idem> tracker needs to be enabled explicitly with the package option \opt{idemtracker}. The behavior of this test depends on the mode the tracker is operating in, see \secref{use:opt:pre:int} for details. If the tracker is disabled, the test always yields \prm{false}. Also see \cmd{citetrackertrue} and \cmd{citetrackerfalse} in \secref{aut:aux:msc}.

\cmditem{ifopcit}{true}{false}

This command is similar to \cmd{ifciteibid} except that it expands to \prm{true} if the entry currently being processed is the same as the last one \emph{by this author or editor}. Note that the <opcit> tracker needs to be enabled explicitly with the package option \opt{opcittracker}. The behavior of this test depends on the mode the tracker is operating in, see \secref{use:opt:pre:int} for details. If the tracker is disabled, the test always yields \prm{false}. Also see the \cmd{citetrackertrue} and \cmd{citetrackerfalse} switches in \secref{aut:aux:msc}.

\cmditem{ifloccit}{true}{false}

This command is similar to \cmd{ifopcit} except that it also compares the \prm{postnote} arguments and expands to \prm{true} only if they match and are numerical (in the sense of \cmd{ifnumerals} from \secref{aut:aux:tst}), \ie \cmd{ifloccit} will yield \texttt{true} if the citation refers to the same page cited before. Note that the <loccit> tracker needs to be enabled explicitly with the package option \opt{loccittracker}. The behavior of this test depends on the mode the tracker is operating in, see \secref{use:opt:pre:int} for details. If the tracker is disabled, the test always yields \prm{false}. Also see the \cmd{citetrackertrue} and \cmd{citetrackerfalse} switches in \secref{aut:aux:msc}.

\cmditem{iffirstonpage}{true}{false}

The behavior of this command is responsive to the package option \opt{pagetracker}. If the option is set to \texttt{page}, it expands to \prm{true} if the current item is the first one on the page, and to \prm{false} otherwise. If the option is set to \texttt{spread}, it expands to \prm{true} if the current item is the first one on the double-page spread, and to \prm{false} otherwise. If the page tracker is disabled, this test always yields \prm{false}. Depending on the context, the <item> may be a citation or an entry in the bibliography or a bibliography list. Note that this test distinguishes between body text and footnotes. For example, if used in the first footnote on a page, it will expand to \prm{true} even if there is a citation in the body text prior to the footnote. Also see the \cmd{pagetrackertrue} and \cmd{pagetrackerfalse} switches in \secref{aut:aux:msc}.

\cmditem{ifsamepage}{instance 1}{instance 2}{true}{false}

This command expands to \prm{true} if two instances of a reference are located on the same page or double-page spread, and to \prm{false} otherwise. An instance of a reference may be a citation or an entry in the bibliography or a bibliography list. These instances are identified by the value of the \cnt{instcount} counter, see \secref{aut:fmt:ilc}. The behavior of this command is responsive to the package option \opt{pagetracker}. If this option is set to \texttt{spread}, \cmd{ifsamepage} is in fact an <if same spread> test. If the page tracker is disabled, this test always yields \prm{false}. The arguments \prm{instance 1} and \prm{instance 2} are treated as integer expressions in the sense of \etex's \cmd{numexpr}. This implies that it is possible to make calculations within these arguments, for example:

\begin{lstlisting}[style=latex]{}
\ifsamepage{<<\value>>{instcount}}{<<\value>>{instcount}<<-1>>}{true}{false}
\end{lstlisting}

Note that \cmd{value} is not prefixed by \cmd{the} and that the subtraction is included in the second argument in the above example. If \prm{instance 1} or \prm{instance 2} is an invalid number (for example, a negative one), the test yields \prm{false}. Also note that this test does not distinguish between body text and footnotes. Also see the \cmd{pagetrackertrue} and \cmd{pagetrackerfalse} switches in \secref{aut:aux:msc}.

\cmditem{ifinteger}{string}{true}{false}

Executes \prm{true} if the \prm{string} is a positive integer, and \prm{false} otherwise. This command is robust.

\cmditem{ifnumeral}{string}{true}{false}

Executes \prm{true} if the \prm{string} is an Arabic or Roman numeral, and \prm{false} otherwise. This command is robust. See also \cmd{DeclareNumChars} and \cmd{NumCheckSetup} in \secref{aut:aux:msc}.

\cmditem{ifnumerals}{string}{true}{false}

Executes \prm{true} if the \prm{string} is a range or a list of Arabic or Roman numerals, and \prm{false} otherwise. This command is robust. In contrast to \cmd{ifnumeral}, it will also execute \prm{true} with arguments like «52--58», «14/15», «1,~3,~5», and so on. See also \cmd{DeclareNumChars}, \cmd{DeclareRangeChars}, \cmd{DeclareRangeCommands}, and \cmd{NumCheckSetup} in \secref{aut:aux:msc}.

\cmditem{ifpages}{string}{true}{false}

Similar to \cmd{ifnumerals}, but also considers \cmd{DeclarePageCommands} from \secref{aut:aux:msc}.

\cmditem{iffieldint}{field}{true}{false}

Similar to \cmd{ifinteger}, but uses the value of a \prm{field} rather than a literal string in the test. If the \prm{field} is undefined, it executes \prm{false}.

\cmditem{iffieldnum}{field}{true}{false}

Similar to \cmd{ifnumeral}, but uses the value of a \prm{field} rather than a literal string in the test. If the \prm{field} is undefined, it executes \prm{false}.

\cmditem{iffieldnums}{field}{true}{false}

Similar to \cmd{ifnumerals}, but uses the value of a \prm{field} rather than a literal string in the test. If the \prm{field} is undefined, it executes \prm{false}.

\cmditem{iffieldpages}{field}{true}{false}

Similar to \cmd{ifpages}, but uses the value of a \prm{field} rather than a literal string in the test. If the \prm{field} is undefined, it executes \prm{false}.

\cmditem{ifbibstring}{string}{true}{false}

Expands to \prm{true} if the \prm{string} is a known localization key, and to \prm{false} otherwise. The localization keys defined by default are listed in \secref{aut:lng:key}. New ones may be defined with \cmd{NewBibliographyString}.

\cmditem{ifbibxstring}{string}{true}{false}

Similar to \cmd{ifbibstring}, but the \prm{string} is expanded.

\cmditem{iffieldbibstring}{field}{true}{false}

Similar to \cmd{ifbibstring}, but uses the value of a \prm{field} rather than a literal string in the test. If the \prm{field}  is undefined, it expands to \prm{false}.

\cmditem{ifdriver}{entrytype}{true}{false}

Expands to \prm{true} if a driver for the \prm{entrytype} is available, and to \prm{false} otherwise.

\cmditem{ifcapital}{true}{false}

Executes \prm{true} if \biblatex's punctuation tracker would capitalize a localization string at the current location, and \prm{false} otherwise. This command is robust. It may be useful for conditional capitalization of certain parts of a name in a formatting directive.

\cmditem{ifcitation}{true}{false}

Expands to \prm{true} when located in a citation, and to \prm{false} otherwise. Note that this command is responsive to the outermost context in which it is used. For example, if a citation command defined with \cmd{DeclareCiteCommand} executes a driver defined with \cmd{DeclareBibliographyDriver}, any \cmd{ifcitation} tests in the driver code will yield \prm{true}. See \secref{aut:cav:mif} for a practical example.

\cmditem{ifbibliography}{true}{false}

Expands to \prm{true} when located in a bibliography, and to \prm{false} otherwise. Note that this command is responsive to the outermost context in which it is used. For example, if a driver defined with \cmd{DeclareBibliographyDriver} executes a citation command defined with \cmd{DeclareCiteCommand}, any \cmd{ifbibliography} tests in the citation code will yield \prm{true}. See \secref{aut:cav:mif} for a practical example.

\cmditem{ifnatbibmode}{true}{false}

Expands to \prm{true} or \prm{false} depending on the \opt{natbib} option from \secref{use:opt:ldt}.

\cmditem{ifciteindex}{true}{false}

Expands to \prm{true} or \prm{false} depending on the \opt{indexing} option from \secref{use:opt:pre:gen}.

\cmditem{ifbibindex}{true}{false}

Expands to \prm{true} or \prm{false} depending on the \opt{indexing} option from \secref{use:opt:pre:gen}.

\cmditem{iffootnote}{true}{false}

Expands to \prm{true} when located in a footnote, and to \prm{false} otherwise. Note that footnotes in \env{minipage} environments are considered to be part of the body text. This command will only expand to \prm{true} in footnotes a the bottom of the page and in endnotes as provided by the \sty{endnotes} package.

\cntitem{citecounter}

This counter indicates how many times the entry currently being processed is cited in the current reference section. Note that this feature needs to be enabled explicitly with the package option \opt{citecounter}. If the option is set to \texttt{context}, citations in the body text and in footnotes are counted separately. In this case, \cnt{citecounter} will hold the value of the context it is used in.

\cntitem{uniquename}\BiberOnlyMark
This counter refers to the \bibfield{labelname} list. It is set on a per-name basis. Its value is \texttt{0} if the last name is unique, \texttt{1} if adding the other parts of the name (first name, prefix, suffix) as initials will make it unique, and \texttt{2} if the full name is required to disambiguate the name. This information is required by author-year and author-title citation schemes which add additional parts of the name when citing different authors with the same last name. For example, if there is one <John Doe> and one <Edward Doe> in the list of references, this counter will be set to \texttt{1}. If there is one <John Doe> and one <Jane Doe>, the value of the counter will be \texttt{2}. If the option is set to \texttt{init}\slash \texttt{allinit}\slash \texttt{mininit}, the counter will be limited to \texttt{1}. This is useful for citations styles which use initials to disambiguate names but never print the full name in citations. If adding the initials is not sufficient to disambiguate the name, \cnt{uniquename} will also be set to \texttt{0} for that name. This feature needs to be enabled explicitly with the package option \opt{uniquename}. Note that the \cnt{uniquename} counter is local to \cmd{printnames} and that it is only set for the \bibfield{labelname} list and to the name list \bibfield{labelname} has been derived from (typically \bibfield{author} or \bibfield{editor}). Its value is zero in any other context, i.e., it must be evaluated in the name formatting directives handling name lists. See \secref{aut:cav:amb} for further details and practical examples.

\cntitem{uniquelist}\BiberOnlyMark
This counter refers to the \bibfield{labelname} list. It is set on a per-field basis. Its value indicates the number of names required to disambiguate the name list if automatic \cnt{maxnames}\slash \cnt{minnames} truncation would lead to ambiguous citations. For example, if there is one work by <Doe\slash Smith\slash Johnson> and another one by <Doe\slash Edwards\slash Williams>, setting \kvopt{maxnames}{1} would lead to <Doe et al.> in both cases. In this case, \cnt{uniquelist} would be set to \texttt{2} on the \bibfield{labelname} lists of both entries because at least the first two names are required to disambiguate them. Note that the \cnt{uniquelist} counter is local to \cmd{printnames} and that it is only set for the \bibfield{labelname} list and to the name list \bibfield{labelname} has been derived from (typically \bibfield{author} or \bibfield{editor}). Its value is zero in any other context. If available, the \cnt{uniquelist} value will be used automatically by \cmd{printnames} when processing the name list, \ie it will automatically override \cnt{maxnames}\slash \cnt{minnames}. This feature needs to be enabled explicitly with the package option \opt{uniquelist}. See \secref{aut:cav:amb} for further details and practical examples.

\cntitem{parenlevel}

The current nesting level of parentheses and\slash or brackets. This information is only available if the \opt{parentracker} from \secref{use:opt:pre:int} is enabled.

\end{ltxsyntax}

\subsubsection{使用\cmd{ifboolexpr}和\cmd{ifthenelse}的判断}%Tests with \cmd{ifboolexpr} and \cmd{ifthenelse}
\label{aut:aux:ife}

The tests introduced in \secref{aut:aux:tst} may also be used with the \cmd{ifboolexpr} command provided by the \sty{etoolbox} package and the \cmd{ifthenelse} command provided by the \sty{ifthen} package. The syntax of the tests is slightly different in this case: the \prm{true} and \prm{false} arguments are omitted from the test itself and passed to the \cmd{ifboolexpr} or \cmd{ifthenelse} command instead. Note that the use of these commands implies some processing overhead. If you do not need any boolean operators, it is more efficient to use the stand"=alone tests from \secref{aut:aux:tst}.

\begin{ltxsyntax}

\cmditem{ifboolexpr}{expression}{true}{false}

\sty{etoolbox} command which allows for complex tests with boolean operators and grouping:

\begin{lstlisting}[style=ifthen]{}
\ifboolexpr{ (
	       test {\ifnameundef{editor}}
	       and
	       not test {\iflistundef{location}}
	     )
	     or test {\iffieldundef{year}}
  }
  {...}
  {...}
\end{lstlisting}

\cmditem{ifthenelse}{tests}{true}{false}

\sty{ifthen} command which allows for complex tests with boolean operators and grouping:

\begin{lstlisting}[style=ifthen]{}
\ifthenelse{ \(
		\ifnameundef{editor}
		\and
		\not \iflistundef{location}
	     \)
	     \or \iffieldundef{year}
  }
  {...}
  {...}
\end{lstlisting}
%
The additional tests provided by \biblatex are only available when \cmd{ifboolexpr} or \cmd{ifthenelse} are used in citation commands and in the bibliography.

\end{ltxsyntax}

\subsubsection{综合命令 Miscellaneous Commands}
\label{aut:aux:msc}

The section introduced miscellaneous commands and little helpers for use in bibliography and citation styles.

\begin{ltxsyntax}

\cmditem{newbibmacro}{name}[arguments][optional]{definition}
\cmditem*{newbibmacro*}{name}[arguments][optional]{definition}

Defines a macro to be executed via \cmd{usebibmacro} later. The syntax of this command is very similar to \cmd{newcommand} except that \prm{name} may contain characters such as numbers and punctuation marks and does not start with a backslash. The optional argument \prm{arguments} is an integer specifying the number of arguments taken by the macro. If \prm{optional} is given, it specifies a default value for the first argument of the macro, which automatically becomes an optional argument. In contrast to \cmd{newcommand}, \cmd{newbibmacro} issues a warning message if the macro is already defined, and automatically falls back to \cmd{renewbibmacro}. As with \cmd{newcommand}, the regular variant of this command uses the \cmd{long} prefix in the definition while the starred one does not. If a macro has been declared to be long, it may take arguments containing \cmd{par} tokens. \cmd{newbibmacro} and \cmd{renewbibmacro} are provided for convenience. Style authors are free to use \cmd{newcommand} or \cmd{def} instead. However, note that most shared definitions found in \path{biblatex.def} are defined with \cmd{newbibmacro}, hence they must be used and modified accordingly.

\cmditem{renewbibmacro}{name}[arguments][optional]{definition}
\cmditem*{renewbibmacro*}{name}[arguments][optional]{definition}

Similar to \cmd{newbibmacro} but redefines \prm{name}. In contrast to \cmd{renewcommand}, \cmd{renewbibmacro} issues a warning message if the macro is undefined, and automatically falls back to \cmd{newbibmacro}.

\cmditem{providebibmacro}{name}[arguments][optional]{definition}
\cmditem*{providebibmacro*}{name}[arguments][optional]{definition}

Similar to \cmd{newbibmacro} but only defines \prm{name} if it is undefined. This command is similar in concept to \cmd{providecommand}.

\cmditem{usebibmacro}{name}
\cmditem*{usebibmacro*}{name}

This command executes the macro \prm{name}, as defined with \cmd{newbibmacro}. If the macro takes any arguments, they are simply appended after \prm{name}. The regular variant of this command sanitizes
\prm{name} while the starred variant does not.

\cmditem{savecommand}{command}
\cmditem{restorecommand}{command}

These commands save and restore any \prm{command}, which must be a command name starting with a backslash. Both commands work within a local scope. They are mainly provided for use in localization files.

\cmditem{savebibmacro}{name}
\cmditem{restorebibmacro}{name}

These commands save and restore the macro \prm{name}, where \prm{name} is the identifier of a macro defined with \cmd{newbibmacro}. Both commands work within a local scope. They are mainly provided for use in localization files.

\cmditem{savefieldformat}[entry type]{format}
\cmditem{restorefieldformat}[entry type]{format}

These commands save and restore the formatting directive \prm{format}, as defined with \cmd{DeclareFieldFormat}. Both commands work within a local scope. They are mainly provided for use in localization files.

\cmditem{savelistformat}[entry type]{format}
\cmditem{restorelistformat}[entry type]{format}

These commands save and restore the formatting directive \prm{format}, as defined with \cmd{DeclareListFormat}. Both commands work within a local scope. They are mainly provided for use in localization files.

\cmditem{savenameformat}[entry type]{format}
\cmditem{restorenameformat}[entry type]{format}

These commands save and restore the formatting directive \prm{format}, as defined with \cmd{DeclareNameFormat}. Both commands work within a local scope. They are mainly provided for use in localization files.

\cmditem{ifbibmacroundef}{name}{true}{false}

Expands to \prm{true} if the bibliography macro \prm{name} is undefined, and to \prm{false} otherwise.

\cmditem{iffieldformatundef}[entry type]{name}{true}{false}
\cmditem{iflistformatundef}[entry type]{name}{true}{false}
\cmditem{ifnameformatundef}[entry type]{name}{true}{false}

Expands to \prm{true} if the formatting directive \prm{format} is undefined, and to \prm{false}
otherwise.

\cmditem{usedriver}{code}{entrytype}

Executes the bibliography driver for an \prm{entrytype}. Calling this command in the \prm{loopcode} of a citation command defined with \cmd{DeclareCiteCommand} is a simple way to print full citations similar to a bibliography entry. Commands such as \cmd{newblock}, which are not applicable in a citation, are disabled automatically. Additional initialization commands may be passed as the \prm{code} argument. This argument is executed inside the group in which \cmd{usedriver} runs the respective driver. Note that it is mandatory in terms of the syntax but may be left empty. Also note that this command will automatically switch languages if the \opt{autolang} package option is enabled.

\cmditem{bibhypertarget}{name}{text}

A wrapper for \sty{hyperref}'s \cmd{hypertarget} command. The \prm{name} is the name of the anchor, the \prm{text} is arbitrary printable text or code which serves as an anchor. If there are any \env{refsection} environments in the document, the \prm{name} is local to the current environment. If the \opt{hyperref} package option is disabled or the \sty{hyperref} package has not been loaded, this command will simply pass on its \prm{text} argument. See also the formatting directive \texttt{bibhypertarget} in \secref{aut:fmt:ich}.

\cmditem{bibhyperlink}{name}{text}

A wrapper for \sty{hyperref}'s \cmd{hyperlink} command. The \prm{name} is the name of an anchor defined with \cmd{bibhypertarget}, the \prm{text} is arbitrary printable text or code to be transformed into a link. If there are any \env{refsection} environments in the document, the \prm{name} is local to the current environment. If the \opt{hyperref} package option is disabled or the \sty{hyperref} package has not been loaded, this command will simply pass on its \prm{text} argument. See also the formatting directive \texttt{bibhyperlink} in \secref{aut:fmt:ich}.

\cmditem{bibhyperref}[entrykey]{text}

Transforms \prm{text} into an internal link pointing to \prm{entrykey} in the bibliography. If \prm{entrykey} is omitted, this command uses the key of the entry currently being processed. This command is employed to transform citations into clickable links pointing to the corresponding entry in the bibliography. The link target is marked automatically by \biblatex. If there are multiple bibliographies in a document, the target will be the first occurence of \prm{entrykey} in one of the bibliographies. If there are \env{refsection} environments, the links are local to the environment. See also the formatting directive \texttt{bibhyperref} in \secref{aut:fmt:ich}.

\cmditem{ifhyperref}{true}{false}

Expands to \prm{true} if the \opt{hyperref} package option is enabled (which implies that the \sty{hyperref} package has been loaded), and to \prm{false} otherwise.

\cmditem{docsvfield}{field}

Similar to the \cmd{docsvlist} command from the \sty{etoolbox} package, except that it takes a field name as its argument. The value of this field is parsed as a comma"=separated list. If the \prm{field} is undefined, this command expands to an empty string.

\cmditem{forcsvfield}{handler}{field}

Similar to the \cmd{forcsvlist} command from the \sty{etoolbox} package, except that it takes a field name as its argument. The value of this field is parsed as a comma"=separated list. If the \prm{field} is undefined, this command expands to an empty string.

\cmditem{MakeCapital}{text}

Similar to \cmd{MakeUppercase} but only coverts the first printable character in \prm{text} to uppercase. Note that the restrictions that apply to \cmd{MakeUppercase} also apply to this command. Namely, all commands in \prm{text} must either be robust or prefixed with \cmd{protect} since the \prm{text} is expanded during capitalization. Apart from Ascii characters and the standard accent commands, this command also handles the active characters of the \sty{inputenc} package as well as the shorthands of the \sty{babel} package. If the \prm{text} starts with a control sequence, nothing is capitalized. This command is robust.

\cmditem{MakeSentenceCase}{text}
\cmditem*{MakeSentenceCase*}{text}

Converts its \prm{text} argument to sentence case, \ie the first word is capitalized and the remainder of the string is converted to lowercase. This command is robust. The starred variant differs from the regular version in that it considers the language of the entry, as specified in the \bibfield{langid} field. It only converts the \prm{text} to sentence case if the \bibfield{langid} field is undefined or if it holds a language declared with \cmd{DeclareCaseLangs} (see below).\footnote{By default, converting to sentence case is enabled for the following language identifiers: \texttt{american}, \texttt{british}, \texttt{canadian}, \texttt{english}, \texttt{australian}, \texttt{newzealand} as well as the aliases \texttt{USenglish} and \texttt{UKenglish}. Use \cmd{DeclareCaseLangs} to extend or change this list.} Otherwise, the \prm{text} is not altered in any way. It is recommended to use \cmd{MakeSentenceCase*} rather than the regular variant in formatting directives. Both variants support the traditional \bibtex convention for \file{bib} files that anything wrapped in a pair of curly braces is not modified when changing the case. For example:

\begin{lstlisting}[style=latex]{}
\MakeSentenceCase{an Introduction to LaTeX}
\MakeSentenceCase{an Introduction to {LaTeX}}
\end{lstlisting}
%
would yield:

\begin{lstlisting}[style=plain]{}
An introduction to latex
An introduction to LaTeX
\end{lstlisting}
%
In \file{bib} files designed with traditional \bibtex in mind, it has been fairly common to only wrap single letters in braces to prevent case"=changing:

\begin{lstlisting}[style=bibtex]{}
title = {An Introduction to {L}a{T}e{X}}
\end{lstlisting}
%
The problem with this convention is that the braces will suppress the kerning on both sides of the enclosed letter. It is preferable to wrap the entire word in braces as shown in the first example.

\cmditem{mkpageprefix}[pagination][postpro]{text}

This command is intended for use in field formatting directives which format the page numbers in the \prm{postnote} argument of citation commands and the \bibfield{pages} field of bibliography entries. It will parse its \prm{text} argument and prefix it with <p.> or <pp.> by default. The optional \prm{pagination} argument holds the name of a field indicating the pagination type. This may be either \bibfield{pagination} or \bibfield{bookpagination}, with \bibfield{pagination} being the default. The spacing between the prefix and the \prm{text} may be modified by redefining \cmd{ppspace}. The default is an unbreakable interword space. See \secref{bib:use:pag, use:cav:pag} for further details. See also \cmd{DeclareNumChars}, \cmd{DeclareRangeChars}, \cmd{DeclareRangeCommands}, and \cmd{NumCheckSetup}. The optional \prm{postpro} argument specifies a macro to be used for post-processing the \prm{text}. If only one optional argument is given, it is taken as \prm{pagination}. Here are two typical examples:

\begin{lstlisting}[style=latex]{}
\DeclareFieldFormat{postnote}{<<\mkpageprefix[pagination]{#1}>>}
\DeclareFieldFormat{pages}{<<\mkpageprefix[bookpagination]{#1}>>}
\end{lstlisting}
%
The optional argument \bibfield{pagination} in the first example is omissible.

\cmditem{mkpagetotal}[pagination][postpro]{text}

This command is similar to \cmd{mkpageprefix} except that it is intended for the \bibfield{pagetotal} field of bibliography entries, \ie it will print «123 pages» rather than «page 123». The optional \prm{pagination} argument defaults to \bibfield{bookpagination}. The spacing inserted between the pagination suffix and the \prm{text} may be modified by redefining the macro \cmd{ppspace}. The optional \prm{postpro} argument specifies a macro to be used for post-processing the \prm{text}. If only one optional argument is given, it is taken as \prm{pagination}. Here is a typical example:

\begin{lstlisting}[style=latex]{}
\DeclareFieldFormat{pagetotal}{<<\mkpagetotal[bookpagination]{#1}>>}
\end{lstlisting}
%
The optional argument \bibfield{bookpagination} is omissible in this case.

\begin{table}
\tablesetup\lnstyle
\begin{tabularx}{\textwidth}{@{}>{\ttfamily}X@{}p{0.25\textwidth}@{}p{0.25\textwidth}@{}p{0.25\textwidth}@{}}
\toprule
\multicolumn{1}{@{}H}{Input} &
\multicolumn{3}{@{}H}{Output} \\
\cmidrule(r){1-1}\cmidrule{2-4}
& \multicolumn{1}{@{}H}{\ttfamily mincomprange=10}
& \multicolumn{1}{@{}H}{\ttfamily mincomprange=100}
& \multicolumn{1}{@{}H}{\ttfamily mincomprange=1000} \\
\cmidrule(r){2-2}\cmidrule(r){3-3}\cmidrule{4-4}
11--15		& 11--5		& 11--15	& 11--15	\\
111--115	& 111--5	& 111--5	& 111--115	\\
1111--1115	& 1111--5	& 1111--5	& 1111--5	\\
\cmidrule{2-4}
& \multicolumn{1}{@{}H}{\ttfamily maxcomprange=1000}
& \multicolumn{1}{@{}H}{\ttfamily maxcomprange=100}
& \multicolumn{1}{@{}H}{\ttfamily maxcomprange=10} \\
\cmidrule(r){2-2}\cmidrule(r){3-3}\cmidrule{4-4}
1111--1115	& 1111--5	& 1111--5	& 1111--5	\\
1111--1155	& 1111--55	& 1111--55	& 1111--1155	\\
1111--1555	& 1111--555	& 1111--1555	& 1111--1555	\\
\cmidrule{2-4}
& \multicolumn{1}{@{}H}{\ttfamily mincompwidth=1}
& \multicolumn{1}{@{}H}{\ttfamily mincompwidth=10}
& \multicolumn{1}{@{}H}{\ttfamily mincompwidth=100} \\
\cmidrule(r){2-2}\cmidrule(r){3-3}\cmidrule{4-4}
1111--1115	& 1111--5	& 1111--15	& 1111--115	\\
1111--1155	& 1111--55	& 1111--55	& 1111--155	\\
1111--1555	& 1111--555	& 1111--555	& 1111--555	\\
\bottomrule
\end{tabularx}
\caption{\cmd{mkcomprange} setup}
\label{aut:aux:tab1}
\end{table}

\cmditem{mkcomprange}[postpro]{text}
\cmditem*{mkcomprange*}[postpro]{text}

This command, which is intended for use in field formatting directives, will parse its \prm{text} argument for page ranges and compress them. For example, «125--129» may be formatted as «125--9». You may configure the behavior of \cmd{mkcomprange} by adjusting the \latex counters \cnt{mincomprange}, \cnt{maxcomprange}, and \cnt{mincompwidth}, as illustrated in \tabref{aut:aux:tab1}. The default settings are \texttt{10}, \texttt{100000}, and \texttt{1}, respectively. This means that the command tries to compress as much as possible by default. Use \cmd{setcounter} to adjust the parameters. The scanner recognizes \cmd{bibrangedash} and hyphens as range dashes. It will normalize the dash by replacing any number of consecutive hyphens with \cmd{bibrangedash}. Lists of ranges delimited with \cmd{bibrangessep} (\biber\footnote{\biber will always convert commas/semicolon multi-range separators into \cmd{bibrangessep} so that it can be controlled in the style.}) or commas/semicolons (BibTeX) are also supported. With \biber, the scanner will normalise any comma or semi-colons surrounded by optional space by replacing them with \cmd{bibrangessep}. If you want to hide a character from the list/range scanner for some reason, wrap the character or the entire string in curly braces. The optional \prm{postpro} argument specifies a macro to be used for post-processing the \prm{text}. This is important if you want to combine \cmd{mkcomprange} with other formatting macros which also need to parse their \prm{text} argument, such as \cmd{mkpageprefix}. Simply nesting these commands will not work as expected. Use the \prm{postpro} argument to set up the processing chain as follows:

\begin{lstlisting}[style=latex]{}
\DeclareFieldFormat{postnote}{\mkcomprange[<<{>>\mkpageprefix[pagination]<<}>>]{#1}}
\end{lstlisting}
%
Note that \cmd{mkcomprange} is executed first, using \cmd{mkpageprefix} as post-processor. Also note that the \prm{postpro} argument is wrapped in an additional pair of braces. This is only required in this particular case to prevent \latex's optional argument scanner from getting confused by the nested brackets. The starred version of this command differs from the regular one in the way the \prm{postpro} argument is applied to a list of values. For example:

\begin{lstlisting}[style=latex]{}
\mkcomprange[\mkpageprefix]{5, 123-129, 423-439}
\mkcomprange*[\mkpageprefix]{5, 123-129, 423-439}
\end{lstlisting}
%
will output:

\begin{lstlisting}[style=latex]{}
pp. 5, 123-9, 423-39
p. 5, pp. 123-9, pp. 423-39
\end{lstlisting}

\cmditem{mkfirstpage}[postpro]{text}
\cmditem*{mkfirstpage*}[postpro]{text}

This command, which is intended for use in field formatting directives, will parse its \prm{text} argument for page ranges and print the start page of the range only. The scanner recognizes \cmd{bibrangedash} and hyphens as range dashes. Lists of ranges delimited with \cmd{bibrangessep} (\biber\footnote{\biber will always convert commas/semicolon multi-range separators into \cmd{bibrangessep} so that it can be controlled in the style.}) or commas/semicolons (BibTeX) are also supported. If you want to hide a character from the list/range scanner for some reason, wrap the character or the entire string in curly braces. The optional \prm{postpro} argument specifies a macro to be used for post-processing the \prm{text}. See \cmd{mkcomprange} on how to use this argument. The starred version of this command differs from the regular one in the way the \prm{postpro} argument is applied to a list of values. For example:

\begin{lstlisting}[style=latex]{}
\mkfirstpage[\mkpageprefix]{5, 123-129, 423-439}
\mkfirstpage*[\mkpageprefix]{5, 123-129, 423-439}
\end{lstlisting}
%
will output:

\begin{lstlisting}[style=latex]{}
pp. 5, 123, 423
p. 5, p. 123, p. 423
\end{lstlisting}

\cmditem{rangelen}{text}

This command will parse its argument as a range and return the length of the range. It will return -1 for open-ended ranges.

\begin{lstlisting}[style=latex]{}
\rangelen{5-10} returns '5'
\rangelen{-10} returns '0'
\rangelen{5-} returns '0'
\rangelen{5} returns '1'
\end{lstlisting}
%
This can be used as part of tests in styles which require, for example, <f> as a suffix for ranges of only two pages as when a page range <36-37> should be printed as <36f>. This could be done using \cmd{ifnumcomp}:

\begin{lstlisting}[style=latex]{}
\ifnumcomp{\rangelen{\thefield{pages}}}{=}{1}{add 'f'}{do nothing}
\end{lstlisting}

\cmditem{frangelen}{rangefield}\BiberOnlyMark

Takes the name of a bibfield declared as a range field in the data model and returns the length of the range. This is calculated by \biber, can handle many special cases and is generally more robust than \cmd{rangelen}. It will return -1 for open ended ranges. Specifically \cmd{frangelen} can:

\begin{itemize}
\item Calculate the total of multiple ranges in the same field such as <1-10, 20-30>
\item Handle implicit ranges such as <22-4> and <130-33>
\item Handle roman numeral ranges in upper and lower case and consisting of both ASCII and Unicode roman numeral representations.
\end{itemize}
%
Here are some examples:

\begin{tabular}{ll}
pages = <10> & |\frangelen{pages}| returns '1'\\
pages = <10-15> & |\frangelen{pages}| returns '6'\\
pages = <10-15,47-53> & |\frangelen{pages}| returns '13'\\
pages = <10-> & |\frangelen{pages}| returns '-1'\\
pages = <-10> & |\frangelen{pages}| returns '-1'\\
pages = <48-9> & |\frangelen{pages}| returns '2'\\
pages = <172-77> & |\frangelen{pages}| returns '6'\\
pages = <i-vi> & |\frangelen{pages}| returns '6'\\
pages = <X-XX> & |\frangelen{pages}| returns '11'\\
pages = <ⅥⅠ-ⅻ> & |\frangelen{pages}| returns '6'\\
pages = <ⅥⅠ-ⅻ, 145-7, 135-39> & |\frangelen{pages}| returns '14'
\end{tabular}

As with \cmd{rangelen}, \cmd{frangelen} can be used in tests:

\begin{lstlisting}[style=latex]{}
\ifnumcomp{\frangelen{pages}}{=}{1}{add 'f'}{do nothing}
\end{lstlisting}

\cmditem{DeclareNumChars}{characters}
\cmditem*{DeclareNumChars*}{characters}

This command configures the \cmd{ifnumeral}, \cmd{ifnumerals}, and \cmd{ifpages} tests from \secref{aut:aux:tst}. The setup will also affect \cmd{iffieldnum}, \cmd{iffieldnums}, \cmd{iffieldpages} as well as \cmd{mkpageprefix} and \cmd{mkpagetotal}. The \prm{characters} argument is an undelimited list of characters which are to be considered as being part of a number. The regular version of this command replaces the current setting, the starred version appends its argument to the current list. The default setting is:

\begin{lstlisting}[style=latex]{}
\DeclareNumChars{.}
\end{lstlisting}
%
This means that a (section or other) number like <3.4.5> will be considered as a number. Note that Arabic and Roman numerals are detected by default, there is no need to declare them explicitly.

\cmditem{DeclareRangeChars}{characters}
\cmditem*{DeclareRangeChars*}{characters}

This command configures the \cmd{ifnumerals} and \cmd{ifpages} tests from \secref{aut:aux:tst}. The setup will also affect \cmd{iffieldnums} and \cmd{iffieldpages} as well as \cmd{mkpageprefix} and \cmd{mkpagetotal}. The \prm{characters} argument is an undelimited list of characters which are to be considered as range indicators. The regular version of this command replaces the current setting, the starred version appends its argument to the current list. The default setting is:

\begin{lstlisting}[style=latex]{}
\DeclareRangeChars{~,;-+/}
\end{lstlisting}
%
This means that strings like <3--5>, <35+>, <8/9> and so on will be considered as a range by \cmd{ifnumerals} and \cmd{ifpages}. Non-range characters in such strings are recognized as numbers. So strings like <3a--5a> and <35b+> are not deemed to be ranges by default. See also \secref{bib:use:pag, use:cav:pag} for further details.

\cmditem{DeclareRangeCommands}{commands}
\cmditem*{DeclareRangeCommands*}{commands}

This command is similar to \cmd{DeclareRangeChars}, except that the \prm{commands} argument is an undelimited list of commands which are to be considered as range indicators. The regular version of this command replaces the current setting, the starred version appends its argument to the current list. The default list is rather long and should cover all common cases; here is a shorter example:

\begin{lstlisting}[style=latex]{}
\DeclareRangeCommands{\&\bibrangedash\textendash\textemdash\psq\psqq}
\end{lstlisting}
%
See also \secref{bib:use:pag, use:cav:pag} for further details.

\cmditem{DeclarePageCommands}{commands}
\cmditem*{DeclarePageCommands*}{commands}

This command is similar to \cmd{DeclareRangeCommands}, except that it only affects the \cmd{ifpages} and \cmd{iffieldpages} tests but not \cmd{ifnumerals} and \cmd{iffieldnums}. The default setting is:

\begin{lstlisting}[style=latex]{}
\DeclarePageCommands{\pno\ppno}
\end{lstlisting}

\cmditem{NumCheckSetup}{code}

Use this command to temporarily redefine any commands which interfere with the tests performed by \cmd{ifnumeral}, \cmd{ifnumerals}, and \cmd{ifpages} from \secref{aut:aux:tst}. The setup will also affect \cmd{iffieldnum}, \cmd{iffieldnums}, \cmd{iffieldpages} as well as \cmd{mkpageprefix} and \cmd{mkpagetotal}. The \prm{code} will be executed in a group by these commands. Since the above mentioned commands will expand the string to be analyzed, it is possible to remove commands to be ignored by the tests by making them expand to an empty string. See also \secref{bib:use:pag, use:cav:pag} for further details.

\cmditem{DeclareCaseLangs}{languages}
\cmditem*{DeclareCaseLangs*}{languages}

Defines the list of languages which are considered by the \cmd{MakeSentenceCase*} command as it converts a string to sentence case. The \prm{languages} argument is a comma"=separated list of \sty{babel}/\sty{polyglossia} languages identifiers. The regular version of this command replaces the current setting, the starred version appends its argument to the current list. The default setting is:

\begin{lstlisting}[style=latex]{}
\DeclareCaseLangs{%
  american,british,canadian,english,australian,newzealand,
  USenglish,UKenglish}
\end{lstlisting}
%
See the \sty{babel}/\sty{polyglossia} manuals and \tabref{bib:fld:tab1} for a list of languages identifiers.

\cmditem{BibliographyWarning}{message}

This command is similar to \cmd{PackageWarning} but prints the entry key of the entry currently being processed in addition to the input line number. It may be used in the bibliography as well as in citation commands. If the \prm{message} is fairly long, use \cmd{MessageBreak} to include line breaks. Note that the standard \cmd{PackageWarning} command does not provide a meaningful clue when used in the bibliography since the input line number is the line on which the \cmd{printbibliography} command was given.

\cmditem{RequireBiber}[severity]

This command is intended for use in \file{cbx}\slash\file{bbx} files and in the \texttt{@preamble} of \file{bib} files. It checks the selected backend and warns if it is not \biber. The optional \prm{severity} argument is an integer specifying the severity. The value 1 triggers an informational message stating that \biber is recommended; 2 triggers a warning stating that \biber is required and the style\slash\file{bib} file may not work properly; 3 triggers an error stating that \biber is strictly required and the style\slash\file{bib} file will not work at all with any other backend. If \cmd{RequireBiber} is used multiple times, the highest \prm{severity} takes precedence. \file{cbx}\slash\file{bbx} files on the one hand and the \texttt{@preamble} snippets of all \file{bib} files on the other are tracked separately. If the optional \prm{severity} argument is omitted, the default severity is 2 (warning).

\boolitem{pagetracker}

These commands activate or deactivate the citation tracker locally (this will affect the \cmd{iffirstonpage} and \cmd{ifsamepage} test from \secref{aut:aux:tst}). They are intended for use in the definition of citation commands or anywhere in the document body. If a citation command is to be excluded from page tracking, use \cmd{pagetrackerfalse} in the \prm{precode} argument of \cmd{DeclareCiteCommand}. See \secref{aut:cbx:cbx} for details. Note that these commands have no effect if page tracking has been disabled globally.

\boolitem{citetracker}

These commands activate or deactivate all citation trackers locally (this will affect the \cmd{ifciteseen}, \cmd{ifentryseen}, \cmd{ifciteibid}, and \cmd{ifciteidem} tests from \secref{aut:aux:tst}). They are intended for use in the definition of citation commands or anywhere in the document body. If a citation command is to be excluded from tracking, use \cmd{citetrackerfalse} in the \prm{precode} argument of \cmd{DeclareCiteCommand}. See \secref{aut:cbx:cbx} for details. Note that these commands have no effect if tracking has been disabled globally.

\boolitem{backtracker}

These commands activate or deactivate the \texttt{backref} tracker locally. They are intended for use in the definition of citation commands or anywhere in the document body. If a citation command is to be excluded from backtracking, use \cmd{backtrackerfalse} in the \prm{precode} argument of \cmd{DeclareCiteCommand}. Note that these commands have no effect if the \texttt{backref} option has been not been set globally.

\end{ltxsyntax}

\subsection[标点 Punctuation]{标点和间距 Punctuation and Spacing}
\label{aut:pct}

The \biblatex package provides elaborate facilities designed to manage and track punctuation and spacing in the bibliography and in citations. These facilities work on two levels. The high"=level commands discussed in \secref{aut:pct:new} deal with punctuation and whitespace inserted by the bibliography style between the individual segments of a bibliography entry. The commands in \secref{aut:pct:chk, aut:pct:pct, aut:pct:spc} work at a lower level. They use \tex's space factor and modified space factor codes to track punctuation in a robust and efficient way. This way it is possible to detect trailing punctuation marks within fields, not only those explicitly inserted between fields. The same technique is also used for automatic capitalization of localization strings, see \cmd{DeclareCapitalPunctuation} in \secref{aut:pct:cfg} as well as \secref{aut:str} for details. Note that these facilities are only made available locally in citations and bibliographies. They will not affect any other part of a document.

\subsubsection{块和单元标点 Block and Unit Punctuation}
\label{aut:pct:new}

The major segments of a bibliography entry are <blocks> and <units>. A block is the larger segment of the two, a unit is shorter or at most equal in length. For example, the values of fields such as \bibfield{title} or \bibfield{note} usually form a unit which is separated from subsequent data by a period or a comma. A block may comprise several fields which are treated as separate units, for example \bibfield{publisher}, \bibfield{location}, and \bibfield{year}. The segmentation of an entry into blocks and units is at the discretion of the bibliography style. An entry is segmented by inserting \cmd{newblock} and \cmd{newunit} commands at suitable places and \cmd{finentry} at the very end (see \secref{aut:bbx:drv} for an example). See also \secref{aut:cav:pct} for some practical hints.

\begin{ltxsyntax}

\csitem{newblock}

Records the end of a block. This command does not print anything, it merely marks the end of the block. The block delimiter \cmd{newblockpunct} will be inserted by a subsequent \cmd{printtext}, \cmd{printfield}, \cmd{printlist}, \cmd{printnames}, or \cmd{bibstring} command. You may use \cmd{newblock} at suitable places without having to worry about spurious blocks. A new block will only be started by the next \cmd{printfield} (or similar) command if this command prints anything. See \secref{aut:cav:pct} for further details.

\csitem{newunit}

Records the end of a unit and puts the default delimiter \cmd{newunitpunct} in the punctuation buffer. This command does not print anything, it merely marks the end of the unit. The punctuation buffer will be inserted by the next \cmd{printtext}, \cmd{printfield}, \cmd{printlist}, \cmd{printnames}, or \cmd{bibstring} command. You may use \cmd{newunit} after commands like \cmd{printfield} without having to worry about spurious punctuation and whitespace. The buffer will only be inserted by the next \cmd{printfield} or similar command if \emph{both} fields are non"=empty. This also applies to \cmd{printtext}, \cmd{printlist}, \cmd{printnames}, and \cmd{bibstring}. See \secref{aut:cav:pct} for further details.

\csitem{finentry}

Inserts \cmd{finentrypunct}. This command should be used at the very end of every bibliography entry.

\cmditem{setunit}{punctuation}
\cmditem*{setunit*}{punctuation}

The \cmd{setunit} command is similar to \cmd{newunit} except that it uses \prm{punctuation} instead of \cmd{newunitpunct}. The starred variant differs from the regular version in that it checks if the last \cmd{printtext}, \cmd{printfield}, \cmd{printlist}, \cmd{printnames}, or \cmd{bibstring} command did actually print anything. If not, it does nothing.

\cmditem{printunit}{punctuation}
\cmditem*{printunit*}{punctuation}

The \cmd{printunit} command is similar to \cmd{setunit} except that \prm{punctuation} persists in the buffer until the next \cmd{printtext}, \cmd{printfield}, \cmd{printlist}, \cmd{printnames}, or \cmd{bibstring} command.

\cmditem{setpunctfont}{command}

This command, which is intended for use in field formatting directives, provides an alternative way of dealing with unit punctuation after a field printed in a different font (for example, a title printed in italics). The standard \latex way of dealing with this is adding a small amount of space, the so-called italic correction. This command allows adapting the punctuation to the font of the preceding field. The \prm{command} should be a text font command which takes one argument, such as \cmd{emph} or \cmd{textbf}. This command will only affect punctuation marks inserted by one of the commands from \secref{aut:pct:pct}. The font adaption is applied to the next punctuation mark only and will be reset automatically thereafter. If you want to reset it manually before it takes effect, issue \cmd{resetpunctfont}. If the \opt{punctfont} package option is disabled, this command does nothing. Note that the \cmd{mkbibemph}, \cmd{mkbibitalic} and \cmd{mkbibbold}  wrappers from \secref{aut:fmt:ich} incorporate this feature by default.

\csitem{resetpunctfont}

This command resets the unit punctuation font defined with \cmd{setpunctfont} before it takes effect. If the \opt{punctfont} package option is disabled, this command does nothing.

\end{ltxsyntax}

\subsubsection{标点判断 Punctuation Tests}
\label{aut:pct:chk}

The following commands may be used to test for preceding punctuation marks at any point in citations and the bibliography.

\begin{ltxsyntax}

\cmditem{ifpunct}{true}{false}

Executes \prm{true} if preceded by any punctuation mark except for an abbreviation dot, and \prm{false} otherwise.

\cmditem{ifterm}{true}{false}

Executes \prm{true} if preceded by a terminal punctuation mark, and \prm{false} otherwise. A terminal punctuation mark is any punctuation mark which has been registered for automatic capitalization, either with \cmd{DeclareCapitalPunctuation} or by default, see \secref{aut:pct:cfg} for details. By default, this applies to periods, exclamation marks, and question marks.

\cmditem{ifpunctmark}{character}{true}{false}

Executes \prm{true} if preceded by the punctuation mark \prm{character}, and \prm{false} otherwise. The \prm{character} may be a comma, a semicolon, a colon, a period, an exclamation mark, a question mark, or an asterisk. Note that a period denotes an end-of"=sentence period. Use the asterisk to test for the dot after an abbreviation. If this command is used in a formatting directive for name lists, \ie in the argument to \cmd{DeclareNameFormat}, the \prm{character} may also be an apostrophe.

\end{ltxsyntax}

\subsubsection{添加标点  Adding Punctuation}
\label{aut:pct:pct}
下面的命令设计用来重复标点。参考文献和标注样式总需要使用这些命令来代替原样输出标点符号。本节中所有的\cmd{add...}命令自动利用\cmd{unspace}命令移除前面的空白(见\secref{aut:pct:spc})。注意:下面讨论的所有的\cmd{add...}命令的作用是宏包默认的，无论\biblatex 换哪种语言都会重新恢复。其作用可以通过\cmd{DeclarePunctuationPairs}命令进行调整，见\secref{aut:pct:cfg}。节

%The following commands are designed to prevent double punctuation marks. Bibliography and citation styles should always use these commands instead of literal punctuation marks. All \cmd{add...} commands in this section automatically remove preceding whitespace with \cmd{unspace} (see \secref{aut:pct:spc}). Note that the behavior of all \cmd{add...} commands discussed below is the package default, which is restored whenever \biblatex switches languages. This behavior may be adjusted with \cmd{DeclarePunctuationPairs} from \secref{aut:pct:cfg}.

\begin{ltxsyntax}

\csitem{adddot}

如果前面输出的不是任何一种标点符号，那么添加一个句点(period)。该命令的目的是在一个缩写后面插入点(dot)。以这种方式插入的点被认为与其它标点命令插入的标点性质相同。该命令也用来将前面如实输出的句点(原样输出的句点，literal period) 转换成一个缩写的点。
%Adds a period unless it is preceded by any punctuation mark. The purpose of this command is inserting the dot after an abbreviation. Any dot inserted this way is recognized as such by the other punctuation commands. This command may also be used to turn a previously inserted literal period into an abbreviation dot.

\csitem{addcomma}

如果前面输出不是一个逗号(comma)、分号(semicolon)、冒号(colon)和句点(period)，那么添加一个逗号。
%Adds a comma unless it is preceded by another comma, a semicolon, a colon, or a period.

\csitem{addsemicolon}

Adds a semicolon unless it is preceded by a comma, another semicolon, a colon, or a period.

\csitem{addcolon}

Adds a colon unless it is preceded by a comma, a semicolon, another colon, or a period.

\csitem{addperiod}

如果前面输出不是一个缩写点或其他任何标点符号，那么添加一个句号。该命令也可以用来将前面插入的缩写点转换为句号，比如在句子的末尾\footnote{不是很理解，前面如果是缩写的点，那么不加入句号，那么缩写的点就转变为句号了？}。
%Adds a period unless it is preceded by an abbreviation dot or any other punctuation mark. This command may also be used to turn a previously inserted abbreviation dot into a period, for example at the end of a sentence.

\csitem{addexclam}
Adds an exclamation mark unless it is preceded by any punctuation mark except for an abbreviation dot.

\csitem{addquestion}

Adds a question mark unless it is preceded by any punctuation mark except for an abbreviation dot.

\csitem{isdot}

当前面输出的是句号的时候，将其转换为缩写的点，如果前面是其它符号那么不添加任何符号。
%Turns a previously inserted literal period into an abbreviation dot. In contrast to \cmd{adddot}, nothing is inserted if this command is not preceded by a period.

\csitem{nopunct}

Adds an internal marker which will cause the next punctuation command to print nothing.

\end{ltxsyntax}

\subsubsection{添加空格 Adding Whitespace}
\label{aut:pct:spc}

The following commands are designed to prevent spurious whitespace. Bibliography and citation styles should always use these commands instead of literal whitespace. In contrast to the commands in \secref{aut:pct:chk, aut:pct:pct}, they are not restricted to citations and the bibliography but available globally.

\begin{ltxsyntax}

\csitem{unspace}

Removes preceding whitespace, \ie removes all skips and penalties from the end of the current horizontal list. This command is implicitly executed by all of the following commands.

\csitem{addspace}

Adds a breakable interword space.

\csitem{addnbspace}

Adds a non"=breakable interword space.

\csitem{addthinspace}

Adds a \emph{breakable} thin space.

\csitem{addnbthinspace}

Adds a non"=breakable thin space. This is similar to \cmd{,} and \cmd{thinspace}.

\csitem{addlowpenspace}

Adds a space penalized by the value of the \cnt{lownamepenalty} counter, see \secref{use:fmt:len, aut:fmt:len} for details.

\csitem{addhighpenspace}

Adds a space penalized by the value of the \cnt{highnamepenalty} counter, see \secref{use:fmt:len, aut:fmt:len} for details.

\csitem{addlpthinspace}

Similar to \cmd{addlowpenspace} but adds a breakable thin space.

\csitem{addhpthinspace}

Similar to \cmd{addhighpenspace} but adds a breakable thin space.

\csitem{addabbrvspace}

Adds a space penalized by the value of the \cnt{abbrvpenalty} counter, see \secref{use:fmt:len, aut:fmt:len} for details.

\csitem{addabthinspace}

Similar to \cmd{addabbrvspace} but using a thin space.

\csitem{adddotspace}

Executes \cmd{adddot} and adds a space penalized by the value of the \cnt{abbrvpenalty} counter, see \secref{use:fmt:len, aut:fmt:len} for details.

\csitem{addslash}

Adds a breakable slash. This command differs from the \cmd{slash} command in the \latex kernel in that a linebreak after the slash is not penalized at all.

\end{ltxsyntax}

Note that the commands in this section implicitly execute \cmd{unspace} to remove spurious whitespace, hence they may be used to override each other. For example, you may use \cmd{addnbspace} to transform a previously inserted interword space into a non"=breakable one and \cmd{addspace} to turn a non"=breakable space into a breakable one.

\footnote{注意有的时候\cmd{unspace}看似能够起到作用，但其实并不能随意使用的。在beamer中printtext老是有些问题，可能是实现printtext命令的依赖命令，在beamer中重定义了，跟aritcle文档类中的情况差别很大。}

\subsubsection{标点设置和大写 Configuring Punctuation and Capitalization}
\label{aut:pct:cfg}

The following commands configure various features related to punctuation and automatic capitalization.
\footnote{这里的capitalization是大写的意思么？}
\begin{ltxsyntax}

\cmditem{DeclareAutoPunctuation}{characters}

This command defines the punctuation marks to be considered by the citation commands as they scan ahead for punctuation. Note that \prm{characters} is an undelimited list of characters. Valid \prm{characters} are period, comma, semicolon, colon, exclamation and question mark. The default setting is:

\begin{lstlisting}[style=latex]{}
\DeclareAutoPunctuation{.,;:!?}
\end{lstlisting}
%
This definition is restored automatically whenever the \opt{autopunct} package option is set to \texttt{true}. Executing |\DeclareAutoPunctuation{}| is equivalent to setting \kvopt{autopunct}{false}, \ie it disables this feature.

\cmditem{DeclareCapitalPunctuation}{characters}

When \biblatex inserts localization strings, \ie key terms such as <edition> or <volume>, it automatically capitalizes them after terminal punctuation marks. This command defines the punctuation marks which will cause localization strings to be capitalized if one of them precedes a string. Note that \prm{characters} is an undelimited list of characters. Valid \prm{characters} are period, comma, semicolon, colon, exclamation and question mark. The package default is:

\begin{lstlisting}[style=latex]{}
\DeclareCapitalPunctuation{.!?}
\end{lstlisting}
%
Using \cmd{DeclareCapitalPunctuation} with an empty argument is equivalent to disabling automatic capitalization. Since this feature is language specific, this command must be used in the argument to \cmd{DefineBibliographyExtras} (when used in the preamble) or \cmd{DeclareBibliographyExtras} (when used in a localization module). See \secref{use:lng, aut:lng} for details. By default, strings are capitalized after periods, exclamation marks, and question marks. All strings are generally capitalized at the beginning of a paragraph (in fact whenever \tex is in vertical mode).

\cmditem{DeclarePunctuationPairs}{identifier}{characters}

Use this command to declare valid pairs of punctuation marks. This will affect the punctuation commands discussed in \secref{aut:pct:pct}. For example, the description of \cmd{addcomma} states that this command adds a comma unless it is preceded by another comma, a semicolon, a colon, or a period. In other words, commas after abbreviation dots, exclamation marks, and question marks are permitted. These valid pairs are declared as follows:

\begin{lstlisting}[style=latex]{}
\DeclarePunctuationPairs{comma}{*!?}
\end{lstlisting}
%
The \prm{identifier} selects the command to be configured. The identifiers correspond to the names of the punctuation commands from \secref{aut:pct:pct} without the \cmd{add} prefix, \ie valid \prm{identifier} strings are \texttt{dot}, \texttt{comma}, \texttt{semicolon}, \texttt{colon}, \texttt{period}, \texttt{exclam}, \texttt{question}. The \prm{characters} argument is an undelimited list of punctuation marks. Valid \prm{characters} are comma, semicolon, colon, period, exclamation mark, question mark, and asterisk. A period in the \prm{characters} argument denotes an end-of"=sentence period, an asterisk the dot after an abbreviation. This is the default setup, which is automatically restored whenever \biblatex switches languages and corresponds to the behavior described in \secref{aut:pct:pct}:

\begin{lstlisting}[style=latex]{}
\DeclarePunctuationPairs{dot}{}
\DeclarePunctuationPairs{comma}{*!?}
\DeclarePunctuationPairs{semicolon}{*!?}
\DeclarePunctuationPairs{colon}{*!?}
\DeclarePunctuationPairs{period}{}
\DeclarePunctuationPairs{exclam}{*}
\DeclarePunctuationPairs{question}{*}
\end{lstlisting}
%
Since this feature is language specific, \cmd{DeclarePunctuationPairs} must be used in the argument to \cmd{DefineBibliographyExtras} (when used in the preamble) or \cmd{DeclareBibliographyExtras} (when used in a localization module). See \secref{use:lng, aut:lng} for details. Note that some localization modules may use a setup which is different from the package default.\footnote{As of this writing, the \texttt{american} module uses different settings for <American-style> punctuation.}

\cmditem{DeclareQuotePunctuation}{characters}

This command controls <American-style> punctuation. The \cmd{mkbibquote} wrapper from \secref{aut:fmt:ich} can interact with the punctuation facilities discussed in \secref{aut:pct:new, aut:pct:pct, aut:pct:spc}. Punctuation marks after \cmd{mkbibquote} will be moved inside the quotes if they have been registered with \cmd{DeclareQuotePunctuation}. Note that \prm{characters} is an undelimited list of characters. Valid \prm{characters} are period, comma, semicolon, colon, exclamation and question mark. Here is an example:

\begin{lstlisting}[style=latex]{}
\DeclareQuotePunctuation{.,}
\end{lstlisting}
%
Executing |\DeclareQuotePunctuation{}| is equivalent to disabling this feature. This is the package default. Since this feature is language specific, this command must be used in the argument to \cmd{DefineBibliographyExtras} (when used in the preamble) or \cmd{DeclareBibliographyExtras} (when used in a localization module). See \secref{use:lng, aut:lng} for details. See also \secref{use:loc:us}.

\csitem{uspunctuation}

A shorthand using the lower-level commands \cmd{DeclareQuotePunctuation} and \cmd{DeclarePunctuationPairs} to activate <American-style> punctuation. See \secref{use:loc:us} for details. This shorthand is provided for convenience only. The effective settings are applied by the lower-level commands.

\csitem{stdpunctuation}

Undoes the settings applied by \cmd{uspunctuation}, restoring standard punctuation. As standard punctuation is the default setting, you only need this command to override a previously executed \cmd{uspunctuation} command. See \secref{use:loc:us} for details.

\end{ltxsyntax}

\subsubsection{修正标点追踪 Correcting Punctuation Tracking}
\label{aut:pct:ctr}

The facilities for punctuation tracking and automatic capitalization are very reliable under normal circumstances, but there are always marginal cases which may require manual intervention. Typical cases are localization strings printed as the first word in a footnote (which is usually treated as the beginning of a paragraph as far as capitalization is concerned, but \tex is not in vertical mode at this point) or punctuation after periods which are not really end"=of"=sentence periods (for example, after an ellipsis like «[\dots\unkern]» a command such as \cmd{addperiod} would do nothing since parentheses and brackets are transparent to the punctuation tracker). In such cases, use the following commands in bibliography and citation styles to mark the beginning or middle of a sentence if and where required:

\begin{ltxsyntax}

\csitem{bibsentence}

This command marks the beginning of a sentence. A localization string immediately after this command will be capitalized and the punctuation tracker is reset, \ie this command hides all preceding punctuation marks from the punctuation tracker and enforces capitalization.

\csitem{midsentence}

This command marks the middle of a sentence. A localization string immediately after this command will not be capitalized and the punctuation tracker is reset, \ie this command hides all preceding punctuation marks from the punctuation tracker and suppresses capitalization.

\csitem*{midsentence*}

The starred variant of \cmd{midsentence} differs from the regular one in that a preceding abbreviation dot is not hidden from the the punctuation tracker, \ie any code after \cmd{midsentence*} will see a preceding abbreviation dot. All other punctuation marks are hidden from the punctuation tracker and capitalization is suppressed.

\end{ltxsyntax}

\subsection{本地化字符串 Localization Strings}
\label{aut:str}

Localization strings are key terms such as <edition> or <volume> which are automatically translated by \biblatex's localization modules. See \secref{aut:lng} for an overview and \secref{aut:lng:key} for a list of all strings supported by default. The commands in this section are used to print the localized term.

\begin{ltxsyntax}

\cmditem{bibstring}[wrapper]{key}

Prints the localization string \prm{key}, where \prm{key} is an identifier in lowercase letters (see \secref{aut:lng:key}). The string will be capitalized as required, see \secref{aut:pct:cfg} for details.
Depending on the \opt{abbreviate} package option from \secref{use:opt:pre:gen}, \cmd{bibstring} prints the short or the long version of the string. If localization strings are nested, \ie if \cmd{bibstring} is used in another string, it will behave like \cmd{bibxstring}.
If the \prm{wrapper} argument is given, the string is passed to the \prm{wrapper} for formatting. This is intended for font commands such as \cmd{emph}.

\cmditem{biblstring}[wrapper]{key}

Similar to \cmd{bibstring} but always prints the long string, ignoring the \opt{abbreviate} option.

\cmditem{bibsstring}[wrapper]{key}

Similar to \cmd{bibstring} but always prints the short string, ignoring the \opt{abbreviate} option.

\cmditem{bibcpstring}[wrapper]{key}

Similar to \cmd{bibstring} but the term is always capitalized.

\cmditem{bibcplstring}[wrapper]{key}

Similar to \cmd{biblstring} but the term is always capitalized.

\cmditem{bibcpsstring}[wrapper]{key}

Similar to \cmd{bibsstring} but the term is always capitalized.

\cmditem{bibucstring}[wrapper]{key}

Similar to \cmd{bibstring} but the whole term is uppercased.

\cmditem{bibuclstring}[wrapper]{key}

Similar to \cmd{biblstring} but the whole term is uppercased.

\cmditem{bibucsstring}[wrapper]{key}

Similar to \cmd{bibsstring} but the whole term is uppercased.

\cmditem{biblcstring}[wrapper]{key}

Similar to \cmd{bibstring} but the whole term is lowercased.

\cmditem{biblclstring}[wrapper]{key}

Similar to \cmd{biblstring} but the whole term is lowercased.

\cmditem{biblcsstring}[wrapper]{key}

Similar to \cmd{bibsstring} but the whole term is lowercased.

\cmditem{bibxstring}{key}

A simplified but expandable version of \cmd{bibstring}. Note that this variant does not capitalize automatically, nor does it hook into the punctuation tracker. It is intended for special cases in which strings are nested or an expanded localization string is required in a test.

\cmditem{bibxlstring}[wrapper]{key}

Similar to \cmd{bibxstring} but always uses the long string, ignoring the \opt{abbreviate} option.

\cmditem{bibxsstring}[wrapper]{key}

Similar to \cmd{bibxstring} but always uses the short string, ignoring the \opt{abbreviate} option.

\cmditem{mainlang}

Switches from the current language to the main document language. This can be used the \prm{wrapper} argument in the localization string commands above.

\end{ltxsyntax}

\subsection{本地化模块 Localization Modules}
\label{aut:lng}

A localization module provides translations for key terms such as <edition> or <volume> as well as definitions for language specific features such as the date format and ordinals. These definitions are provided in files with the suffix \file{lbx}. The base name of the file must be a language name known to the \sty{babel}/\sty{polyglossia} packages. The \file{lbx} files may also be used to map \sty{babel}/\sty{polyglossia} language names to the backend modules of the \biblatex package. All localization modules are loaded on demand in the document body. Note that the contents of the file are processed in a group and that the category code of the character \texttt{@} is temporarily set to <letter>.

\subsubsection{本地化命令 Localization Commands}
\label{aut:lng:cmd}

The user"=level versions of the localization commands were already introduced in \secref{use:lng}. When used in \file{lbx} files, however, the syntax of localization commands is different from the user syntax in the preamble and the configuration file. When used in localization files, there is no need to specify the \prm{language} because the mapping of strings to a language is already provided by the name of the \file{lbx} file.

\begin{ltxsyntax}

\cmditem{DeclareBibliographyStrings}{definitions}

This command is only available in \file{lbx} files. It is used to define localization strings. The \prm{definitions} consist of \keyval pairs which assign an expression to an identifier. A complete list of all keys supported by default is given is \secref{aut:lng:key}. Note that the syntax of the value is different in \file{lbx} files. The value assigned to a key consists of two expressions, each of which is wrapped in an additional pair of brackets. This is best shown by example:

\begin{lstlisting}[style=latex]{}
\DeclareBibliographyStrings{%
  bibliography  = {{Bibliography}{Bibliography}},
  shorthands    = {{List of Abbreviations}{Abbreviations}},
  editor        = {{editor}{ed.}},
  editors       = {{editors}{eds.}},
}
\end{lstlisting}
%
The first value is the long, written out expression, the second one is an abbreviated or short form. Both strings must always be given even though they may be identical if an expression is always (or never) abbreviated. Depending on the setting of the \opt{abbreviate} package option (see \secref{use:opt:pre:gen}), \biblatex selects one expression when loading the \file{lbx} file. There is also a special key named \texttt{inherit} which copies the strings from a different language. This is intended for languages which only differ in a few expressions, such as German and Austrian or American and British English. For example, here are the complete definitions for Austrian:

\begin{lstlisting}[style=latex]{}
\DeclareBibliographyStrings{%
  inherit       = {german},
  january       = {{J\"anner}{J\"an.}},
}
\end{lstlisting}

The above examples are slightly simplified. Real localization files should use the punctuation and formatting commands discussed in \secref{aut:pct:pct, use:fmt} instead of literal punctuation. Here is an excerpt from a real localization file:

\begin{lstlisting}[style=latex]{}
  bibliography     = {{Bibliography}{Bibliography}},
  shorthands       = {{List of Abbreviations}{Abbreviations}},
  editor           = {{editor}{ed\adddot}},
  editors          = {{editors}{eds\adddot}},
  byeditor         = {{edited by}{ed\adddotspace by}},
  mathesis         = {{Master's thesis}{MA\addabbrvspace thesis}},
\end{lstlisting}
%
Note the handling of abbreviation dots, the spacing in abbreviated expressions, and the capitalization in the example above. All expressions should be capitalized as they usually are when used in the middle of a sentence. The \biblatex package will automatically capitalize the first word when required at the beginning of a sentence, see \cmd{DeclareCapitalPunctuation} in \secref{aut:pct:cfg} for details. Expressions intended for use in headings are special. They should be capitalized in a way that is suitable for titling and should not be abbreviated (but they may have a short form).

\cmditem{InheritBibliographyStrings}{language}

This command is only available in \file{lbx} files. It copies the localization strings for \prm{language} to the current language, as specified by the name of the \file{lbx} file.

\cmditem{DeclareBibliographyExtras}{code}

This command is only available in \file{lbx} files. It is used to adapt language specific features such as the date format and ordinals. The \prm{code}, which may be arbitrary \latex code, will usually consist of redefinitions of the formatting commands from \secref{aut:fmt:lng}.

\cmditem{UndeclareBibliographyExtras}{code}

This command is only available in \file{lbx} files. It is used to restore any formatting commands modified with \cmd{DeclareBibliographyExtras}. If a redefined command is included in \secref{aut:fmt:lng}, there is no need to restore its previous definition since these commands are localized by all language modules anyway.

\cmditem{InheritBibliographyExtras}{language}

This command is only available in \file{lbx} files. It copies the bibliography extras for \prm{language} to the current language, as specified by the name of the \file{lbx} file.

\cmditem{DeclareHyphenationExceptions}{text}

This command corresponds to \cmd{DefineHyphenationExceptions} from \secref{use:lng}. The difference is that it is only available in \file{lbx} files and that the \prm{language} argument is omitted. The hyphenation exceptions will affect the language of the \file{lbx} file currently being processed.

\cmditem{DeclareRedundantLanguages}{language, language, ...}{langid, langid, ...}

This command provides the language mappings required by the \opt{clearlang} option from \secref{use:opt:pre:gen}.
The \prm{language} is the string given in the \bibfield{language} field (without the optional \texttt{lang} prefix); \prm{langid} is \sty{babel}/\sty{polyglossia}'s language identifier, as given in the optional argument of \cmd{usepackage} when loading \sty{babel} or the argument of \cmd{setdefaultlanguage} or \cmd{setotherlanguages} when using \sty{polyglossia}. This command may be used in \file{lbx} files or in the document preamble. Here are some examples:

\begin{lstlisting}[style=latex]{}
\DeclareRedundantLanguages{french}{french}
\DeclareRedundantLanguages{german}{german,ngerman,austrian,naustrian}
\DeclareRedundantLanguages{english,american}{english,american,british,
	canadian,australian,newzealand,USenglish,UKenglish}
\end{lstlisting}
%
Note that this feature needs to be enabled globally with the \opt{clearlang} option from \secref{use:opt:pre:gen}. If it is disabled, all mappings will be ignored. If the \prm{langid} parameter is blank, \biblatex will clear the mappings for the corresponding \prm{language}, \ie the feature will be disabled for this \prm{language} only.

\cmditem{DeclareLanguageMapping}{language}{file}

This command maps a \sty{babel}/\sty{polyglossia} language identifier to an \file{lbx} file. The \prm{language} must be a language name known to the \sty{babel}/\sty{polyglossia} package, \ie one of the identifiers listed in \tabref{bib:fld:tab1}. The \prm{file} argument is the name of an alternative \file{lbx} file without the \texttt{.lbx} suffix. Declaring the same mapping more than once is possible. Subsequent declarations will simply overwrite any previous ones. This command may only be used in the preamble. See \secref{aut:cav:lng} for further details.

\cmditem{NewBibliographyString}{key}

This command, which may be used in the preamble (including \file{cbx} and \file{bbx} files) as well as in \file{lbx} files, declares new localization strings, \ie it initializes a new \prm{key} to be used in the \prm{definitions} of \cmd{DefineBibliographyStrings} or \cmd{DeclareBibliographyStrings}. The \prm{key} argument may also be a comma"=separated list of key names. When used in an \file{lbx}, the \prm{key} is initialized only for the language specified by the name of the \file{lbx} file. The keys listed in \secref{aut:lng:key} are defined by default.

\end{ltxsyntax}

\subsubsection{本地化关键词 Localization Keys}
\label{aut:lng:key}

The localization keys in this section are defined by default and covered by the localization files which come with \biblatex. Note that these strings are only available in citations, the bibliography and bibliography lists. All expressions should be capitalized as they usually are when used in the middle of a sentence. \biblatex will capitalize them automatically at the beginning of a sentence. The only exceptions to these rules are the three strings intended for use in headings.

\paragraph{Headings}
\label{aut:lng:key:bhd}

The following strings are special because they are intended for use in headings and made available globally via macros. For this reason, they should be capitalized for use in headings and they must not include any local commands which are part of \biblatex's author interface.

\begin{keymarglist}
\item[bibliography] The term <bibliography>, also available as \cmd{bibname}.
\item[references] The term <references>, also available as \cmd{refname}.
\item[shorthands] The term <list of shorthands> or <list of abbreviations>, also available as \cmd{biblistname}.
\end{keymarglist}

\paragraph{Roles, Expressed as Functions}
\label{aut:lng:key:efn}

The following keys refer to roles which are expressed as a function (<editor>, <translator>) rather than as an action (<edited by>, <translated by>).

\begin{keymarglist}
\item[editor] The term <editor>, referring to the main editor. This is the most generic editorial role.
\item[editors] The plural form of \texttt{editor}.
\item[compiler] The term <compiler>, referring to an editor whose task is to compile a work.
\item[compilers] The plural form of \texttt{compiler}.
\item[founder] The term <founder>, referring to a founding editor.
\item[founders] The plural form of \texttt{founder}.
\item[continuator] An expression like <continuator>, <continuation>, or <continued>, referring to a past editor who continued the work of the founding editor but was subsequently replaced by the current editor.
\item[continuators] The plural form of \texttt{continuator}.
\item[redactor] The term <redactor>, referring to a secondary editor.
\item[redactors] The plural form of \texttt{redactor}.
\item[reviser] The term <reviser>, referring to a secondary editor.
\item[revisers] The plural form of \texttt{reviser}.
\item[collaborator] A term like <collaborator>, <collaboration>, <cooperator>, or <cooperation>, referring to a secondary editor.
\item[collaborators] The plural form of \texttt{collaborator}.
\item[translator] The term <translator>.
\item[translators] The plural form of \texttt{translator}.
\item[commentator] The term <commentator>, referring to the author of a commentary to a work.
\item[commentators] The plural form of \texttt{commentators}.
\item[annotator] The term <annotator>, referring to the author of annotations to a work.
\item[annotators] The plural form of \texttt{annotators}.
\end{keymarglist}

\paragraph{Concatenated Editor Roles, Expressed as Functions}
\label{aut:lng:key:cef}

The following keys are similar in function to \texttt{editor}, \texttt{translator}, etc. They are used to indicate additional roles of the editor, \eg\ <editor and translator>, <editor and foreword>.

\begin{keymarglist}
\item[editortr] Used if \bibfield{editor}\slash \bibfield{translator} are identical.
\item[editorstr] The plural form of \texttt{editortr}.
\item[editorco] Used if \bibfield{editor}\slash \bibfield{commentator} are identical.
\item[editorsco] The plural form of \texttt{editorco}.
\item[editoran] Used if \bibfield{editor}\slash \bibfield{annotator} are identical.
\item[editorsan] The plural form of \texttt{editoran}.
\item[editorin] Used if \bibfield{editor}\slash \bibfield{introduction} are identical.
\item[editorsin] The plural form of \texttt{editorin}.
\item[editorfo] Used if \bibfield{editor}\slash \bibfield{foreword} are identical.
\item[editorsfo] The plural form of \texttt{editorfo}.
\item[editoraf] Used if \bibfield{editor}\slash \bibfield{aftword} are identical.
\item[editorsaf] The plural form of \texttt{editoraf}.
\end{keymarglist}
%
Keys for \bibfield{editor}\slash \bibfield{translator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[editortrco] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{commentator} are identical.
\item[editorstrco] The plural form of \texttt{editortrco}.
\item[editortran] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{annotator} are identical.
\item[editorstran] The plural form of \texttt{editortran}.
\item[editortrin] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{introduction} are identical.
\item[editorstrin] The plural form of \texttt{editortrin}.
\item[editortrfo] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{foreword} are identical.
\item[editorstrfo] The plural form of \texttt{editortrfo}.
\item[editortraf] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{aftword} are identical.
\item[editorstraf] The plural form of \texttt{editortraf}.
\end{keymarglist}
%
Keys for \bibfield{editor}\slash \bibfield{commentator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[editorcoin] Used if \bibfield{editor}\slash \bibfield{commentator}\slash \bibfield{introduction} are identical.
\item[editorscoin] The plural form of \texttt{editorcoin}.
\item[editorcofo] Used if \bibfield{editor}\slash \bibfield{commentator}\slash \bibfield{foreword} are identical.
\item[editorscofo] The plural form of \texttt{editorcofo}.
\item[editorcoaf] Used if \bibfield{editor}\slash \bibfield{commentator}\slash \bibfield{aftword} are identical.
\item[editorscoaf] The plural form of \texttt{editorcoaf}.
\end{keymarglist}
%
Keys for \bibfield{editor}\slash \bibfield{annotator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[editoranin] Used if \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{introduction} are identical.
\item[editorsanin] The plural form of \texttt{editoranin}.
\item[editoranfo] Used if \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{foreword} are identical.
\item[editorsanfo] The plural form of \texttt{editoranfo}.
\item[editoranaf] Used if \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{aftword} are identical.
\item[editorsanaf] The plural form of \texttt{editoranaf}.
\end{keymarglist}
%
Keys for \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{commentator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[editortrcoin] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{commentator}\slash \bibfield{introduction} are identical.
\item[editorstrcoin] The plural form of \texttt{editortrcoin}.
\item[editortrcofo] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{commentator}\slash \bibfield{foreword} are identical.
\item[editorstrcofo] The plural form of \texttt{editortrcofo}.
\item[editortrcoaf] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{commentator}\slash \bibfield{aftword} are identical.
\item[editorstrcoaf] The plural form of \texttt{editortrcoaf}.
\end{keymarglist}
%
Keys for \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{commentator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[editortranin] Used if \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{commentator}\slash \bibfield{introduction} are identical.
\item[editorstranin] The plural form of \texttt{editortranin}.
\item[editortranfo] Used if \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{commentator}\slash \bibfield{foreword} are identical.
\item[editorstranfo] The plural form of \texttt{editortranfo}.
\item[editortranaf] Used if \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{commentator}\slash \bibfield{aftword} are identical.
\item[editorstranaf] The plural form of \texttt{editortranaf}.
\end{keymarglist}

\paragraph{Concatenated Translator Roles, Expressed as Functions}
\label{aut:lng:key:ctf}

The following keys are similar in function to \texttt{translator}. They are used to indicate additional roles of the translator, \eg\ <translator and commentator>, <translator and introduction>.

\begin{keymarglist}
\item[translatorco] Used if \bibfield{translator}\slash \bibfield{commentator} are identical.
\item[translatorsco] The plural form of \texttt{translatorco}.
\item[translatoran] Used if \bibfield{translator}\slash \bibfield{annotator} are identical.
\item[translatorsan] The plural form of \texttt{translatoran}.
\item[translatorin] Used if \bibfield{translator}\slash \bibfield{introduction} are identical.
\item[translatorsin] The plural form of \texttt{translatorin}.
\item[translatorfo] Used if \bibfield{translator}\slash \bibfield{foreword} are identical.
\item[translatorsfo] The plural form of \texttt{translatorfo}.
\item[translatoraf] Used if \bibfield{translator}\slash \bibfield{aftword} are identical.
\item[translatorsaf] The plural form of \texttt{translatoraf}.
\end{keymarglist}
%
Keys for \bibfield{translator}\slash \bibfield{commentator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[translatorcoin] Used if \bibfield{translator}\slash \bibfield{commentator}\slash \bibfield{introduction} are identical.
\item[translatorscoin] The plural form of \texttt{translatorcoin}.
\item[translatorcofo] Used if \bibfield{translator}\slash \bibfield{commentator}\slash \bibfield{foreword} are identical.
\item[translatorscofo] The plural form of \texttt{translatorcofo}.
\item[translatorcoaf] Used if \bibfield{translator}\slash \bibfield{commentator}\slash \bibfield{aftword} are identical.
\item[translatorscoaf] The plural form of \texttt{translatorcoaf}.
\end{keymarglist}
%
Keys for \bibfield{translator}\slash \bibfield{annotator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[translatoranin] Used if \bibfield{translator}\slash \bibfield{annotator}\slash \bibfield{introduction} are identical.
\item[translatorsanin] The plural form of \texttt{translatoranin}.
\item[translatoranfo] Used if \bibfield{translator}\slash \bibfield{annotator}\slash \bibfield{foreword} are identical.
\item[translatorsanfo] The plural form of \texttt{translatoranfo}.
\item[translatoranaf] Used if \bibfield{translator}\slash \bibfield{annotator}\slash \bibfield{aftword} are identical.
\item[translatorsanaf] The plural form of \texttt{translatoranaf}.
\end{keymarglist}

\paragraph{Roles, Expressed as Actions}
\label{aut:lng:key:eac}

The following keys refer to roles which are expressed as an action (<edited by>, <translated by>) rather than as a function (<editor>, <translator>).

\begin{keymarglist}
\item[byauthor] The expression <[created] by \prm{name}>.
\item[byeditor] The expression <edited by \prm{name}>.
\item[bycompiler] The expression <compiled by \prm{name}>.
\item[byfounder] The expression <founded by \prm{name}>.
\item[bycontinuator] The expression <continued by \prm{name}>.
\item[byredactor] The expression <redacted by \prm{name}>.
\item[byreviser] The expression <revised by \prm{name}>.
\item[byreviewer] The expression <reviewed by \prm{name}>.
\item[bycollaborator] An expression like <in collaboration with \prm{name}> or <in cooperation with \prm{name}>.
\item[bytranslator] The expression <translated by \prm{name}> or <translated from \prm{language} by \prm{name}>.
\item[bycommentator] The expression <commented by \prm{name}>.
\item[byannotator] The expression <annotated by \prm{name}>.
\end{keymarglist}

\paragraph{Concatenated Editor Roles, Expressed as Actions}
\label{aut:lng:key:cea}

The following keys are similar in function to \texttt{byeditor}, \texttt{bytranslator}, etc. They are used to indicate additional roles of the editor, \eg\ <edited and translated by>, <edited and furnished with an introduction by>, <edited, with a foreword, by>.

\begin{keymarglist}
\item[byeditortr] Used if \bibfield{editor}\slash \bibfield{translator} are identical.
\item[byeditorco] Used if \bibfield{editor}\slash \bibfield{commentator} are identical.
\item[byeditoran] Used if \bibfield{editor}\slash \bibfield{annotator} are identical.
\item[byeditorin] Used if \bibfield{editor}\slash \bibfield{introduction} are identical.
\item[byeditorfo] Used if \bibfield{editor}\slash \bibfield{foreword} are identical.
\item[byeditoraf] Used if \bibfield{editor}\slash \bibfield{aftword} are identical.
\end{keymarglist}
%
Keys for \bibfield{editor}\slash \bibfield{translator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[byeditortrco] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{commentator} are identical.
\item[byeditortran] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{annotator} are identical.
\item[byeditortrin] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{introduction} are identical.
\item[byeditortrfo] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{foreword} are identical.
\item[byeditortraf] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{aftword} are identical.
\end{keymarglist}
%
Keys for \bibfield{editor}\slash \bibfield{commentator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[byeditorcoin] Used if \bibfield{editor}\slash \bibfield{commentator}\slash \bibfield{introduction} are identical.
\item[byeditorcofo] Used if \bibfield{editor}\slash \bibfield{commentator}\slash \bibfield{foreword} are identical.
\item[byeditorcoaf] Used if \bibfield{editor}\slash \bibfield{commentator}\slash \bibfield{aftword} are identical.
\end{keymarglist}
%
Keys for \bibfield{editor}\slash \bibfield{annotator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[byeditoranin] Used if \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{introduction} are identical.
\item[byeditoranfo] Used if \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{foreword} are identical.
\item[byeditoranaf] Used if \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{aftword} are identical.
\end{keymarglist}
%
Keys for \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{commentator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[byeditortrcoin] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{commentator}\slash \bibfield{introduction} are identical.
\item[byeditortrcofo] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{commentator}\slash \bibfield{foreword} are identical.
\item[byeditortrcoaf] Used if \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{commentator}\slash \bibfield{aftword} are identical.
\end{keymarglist}
%
Keys for \bibfield{editor}\slash \bibfield{translator}\slash \bibfield{annotator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[byeditortranin] Used if \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{commentator}\slash \bibfield{introduction} are identical.
\item[byeditortranfo] Used if \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{commentator}\slash \bibfield{foreword} are identical.
\item[byeditortranaf] Used if \bibfield{editor}\slash \bibfield{annotator}\slash \bibfield{commentator}\slash \bibfield{aftword} are identical.
\end{keymarglist}

\paragraph{Concatenated Translator Roles, Expressed as Actions}
\label{aut:lng:key:cta}

The following keys are similar in function to \texttt{bytranslator}. They are used to indicate additional roles of the translator, \eg\ <translated and commented by>, <translated and furnished with an introduction by>, <translated, with a foreword, by>.

\begin{keymarglist}
\item[bytranslatorco] Used if \bibfield{translator}\slash \bibfield{commentator} are identical.
\item[bytranslatoran] Used if \bibfield{translator}\slash \bibfield{annotator} are identical.
\item[bytranslatorin] Used if \bibfield{translator}\slash \bibfield{introduction} are identical.
\item[bytranslatorfo] Used if \bibfield{translator}\slash \bibfield{foreword} are identical.
\item[bytranslatoraf] Used if \bibfield{translator}\slash \bibfield{aftword} are identical.
\end{keymarglist}
%
Keys for \bibfield{translator}\slash \bibfield{commentator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[bytranslatorcoin] Used if \bibfield{translator}\slash \bibfield{commentator}\slash \bibfield{introduction} are identical.
\item[bytranslatorcofo] Used if \bibfield{translator}\slash \bibfield{commentator}\slash \bibfield{foreword} are identical.
\item[bytranslatorcoaf] Used if \bibfield{translator}\slash \bibfield{commentator}\slash \bibfield{aftword} are identical.
\end{keymarglist}
%
Keys for \bibfield{translator}\slash \bibfield{annotator}\slash \prm{role} combinations:

\begin{keymarglist}
\item[bytranslatoranin] Used if \bibfield{translator}\slash \bibfield{annotator}\slash \bibfield{introduction} are identical.
\item[bytranslatoranfo] Used if \bibfield{translator}\slash \bibfield{annotator}\slash \bibfield{foreword} are identical.
\item[bytranslatoranaf] Used if \bibfield{translator}\slash \bibfield{annotator}\slash \bibfield{aftword} are identical.
\end{keymarglist}

\paragraph{Roles, Expressed as Objects}
\label{aut:lng:key:rob}

Roles which are related to supplementary material may also be expressed as objects (<with a commentary by>) rather than as functions (<commentator>) or as actions (<commented by>).

\begin{keymarglist}
\item[withcommentator] The expression <with a commentary by \prm{name}>.
\item[withannotator] The expression <with annotations by \prm{name}>.
\item[withintroduction] The expression <with an introduction by \prm{name}>.
\item[withforeword] The expression <with a foreword by \prm{name}>.
\item[withafterword] The expression <with an afterword by \prm{name}>.
\end{keymarglist}

\paragraph{Supplementary Material}
\label{aut:lng:key:mat}

\begin{keymarglist}
\item[commentary] The term <commentary>.
\item[annotations] The term <annotations>.
\item[introduction] The term <introduction>.
\item[foreword] The term <foreword>.
\item[afterword] The term <afterword>.
\end{keymarglist}

\paragraph{Publication Details}
\label{aut:lng:key:pdt}

\begin{keymarglist}
\item[volume] The term <volume>, referring to a book.
\item[volumes] The plural form of \texttt{volume}.
\item[involumes] The term <in>, as used in expressions like <in \prm{number of volumes} volumes>.
\item[jourvol] The term <volume>, referring to a journal.
\item[jourser] The term <series>, referring to a journal.
\item[book] The term <book>, referring to a document division.
\item[part] The term <part>, referring to a part of a book or a periodical.
\item[issue] The term <issue>, referring to a periodical.
\item[newseries] The expression <new series>, referring to a journal.
\item[oldseries] The expression <old series>, referring to a journal.
\item[edition] The term <edition>.
\item[in] The term <in>, referring to the title of a work published as part of another one, \eg\ <\prm{title of article} in \prm{title of journal}>.
\item[inseries] The term <in>, as used in expressions like <volume \prm{number} in \prm{name of series}>.
\item[ofseries] The term <of>, as used in expressions like <volume \prm{number} of \prm{name of series}>.
\item[number] The term <number>, referring to an issue of a journal.
\item[chapter] The term <chapter>, referring to a chapter in a book.
\item[version] The term <version>, referring to a revision number.
\item[reprint] The term <reprint>.
\item[reprintof] The expression <reprint of \prm{title}>.
\item[reprintas] The expression <reprinted as \prm{title}>.
\item[reprintfrom] The expression <reprinted from \prm{title}>.
\item[translationof] The expression <translation of \prm{title}>.
\item[translationas] The expression <translated as \prm{title}>.
\item[translationfrom] The expression <translated from [the] \prm{language}>.
\item[reviewof] The expression <review of \prm{title}>.
\item[origpubas] The expression <originally published as \prm{title}>.
\item[origpubin] The expression <originally published in \prm{year}>.
\item[astitle] The term <as>, as used in expressions like <published by \prm{publisher} as \prm{title}>.
\item[bypublisher] The term <by>, as used in expressions like <published by \prm{publisher}>.
\end{keymarglist}

\paragraph{Publication State}
\label{aut:lng:key:pst}

\begin{keymarglist}
\item[inpreparation] The expression <in preparation> (the manuscript is being prepared for publication).
\item[submitted] The expression <submitted> (the manuscript has been submitted to a journal or conference).
\item[forthcoming] The expression <forthcoming> (the manuscript has been accepted by a press or journal).
\item[inpress] The expression <in press> (the manuscript is fully copyedited and out of the author's hands; it is in the final stages of the production process).
\item[prepublished] The expression <pre-published> (the manuscript is published in a preliminary form or location, such as online version in advance of print publication).
\end{keymarglist}

\paragraph{Pagination}
\label{aut:lng:key:pag}

\begin{keymarglist}
\item[page] The term <page>.
\item[pages] The plural form of \texttt{page}.
\item[column] The term <column>, referring to a column on a page.
\item[columns] The plural form of \texttt{column}.
\item[section] The term <section>, referring to a document division (usually abbreviated as \S).
\item[sections] The plural form of \texttt{section} (usually abbreviated as \S\S).
\item[paragraph] The term <paragraph> (\ie a block of text, not to be confused with \texttt{section}).
\item[paragraphs] The plural form of \texttt{paragraph}.
\item[verse] The term <verse> as used when referring to a work which is cited by verse numbers.
\item[verses] The plural form of \texttt{verse}.
\item[line] The term <line> as used when referring to a work which is cited by line numbers.
\item[lines] The plural form of \texttt{line}.
\end{keymarglist}

\paragraph{Types}
\label{aut:lng:key:typ}

The following keys are typically used in the \bibfield{type} field of \bibtype{thesis}, \bibtype{report}, \bibtype{misc}, and other entries:

\begin{keymarglist}
\item[mathesis] An expression equivalent to the term <Master's thesis>.
\item[phdthesis] The term <PhD thesis>, <PhD dissertation>, <doctoral thesis>, etc.
\item[candthesis] An expression equivalent to the term <Candidate thesis>. Used for <Candidate> degrees that have no clear equivalent to the Master's or doctoral level.
\item[techreport] The term <technical report>.
\item[resreport] The term <research report>.
\item[software] The term <computer software>.
\item[datacd] The term <data \textsc{cd}> or <\textsc{cd-rom}>.
\item[audiocd] The term <audio \textsc{cd}>.
\end{keymarglist}

\paragraph{Miscellaneous}
\label{aut:lng:key:msc}

\begin{keymarglist}
\item[nodate] The term to use in place of a date when there is no date for an entry \eg\ <n.d.>
\item[and] The term <and>, as used in a list of authors or editors, for example.
\item[andothers] The expression <and others> or <et alii>, used to mark the truncation of a name list.
\item[andmore] Like \texttt{andothers} but used to mark the truncation of a literal list.
\end{keymarglist}

\paragraph{Labels}
\label{aut:lng:key:lab}

The following strings are intended for use as labels, \eg\ <Address: \prm{url}> or <Abstract: \prm{abstract}>.

\begin{keymarglist}
\item[url] The term <address> in the sense of an internet address.
\item[urlfrom] An expression like <available from \prm{url}> or <available at \prm{url}>.
\item[urlseen] An expression like <accessed on \prm{date}>, <retrieved on \prm{date}>, <visited on \prm{date}>, referring to the access date of an online resource.
\item[file] The term <file>.
\item[library] The term <library>.
\item[abstract] The term <abstract>.
\item[annotation] The term <annotations>.
\end{keymarglist}

\paragraph{Citations}
\label{aut:lng:key:cit}

Traditional scholarly expressions used in citations:

\begin{keymarglist}
\item[idem] The term equivalent to the Latin <idem> (<the same [person]>).
\item[idemsf] The feminine singular form of \texttt{idem}.
\item[idemsm] The masculine singular form of \texttt{idem}.
\item[idemsn] The neuter singular form of \texttt{idem}.
\item[idempf] The feminine plural form of \texttt{idem}.
\item[idempm] The masculine plural form of \texttt{idem}.
\item[idempn] The neuter plural form of \texttt{idem}.
\item[idempp] The plural form of \texttt{idem} suitable for a mixed gender list of names.
\item[ibidem] The term equivalent to the Latin <ibidem> (<in the same place>).
\item[opcit] The term equivalent to the Latin term <opere citato> (<[in] the work [already] cited>).
\item[loccit] The term equivalent to the Latin term <loco citato> (<[at] the place [already] cited>).
\item[confer] The term equivalent to the Latin <confer> (<compare>).
\item[sequens] The term equivalent to the Latin <sequens> (<[and] the following [page]>), as used to indicate a range of two pages when only the starting page is provided (\eg\ <25\,sq.> or <25\,f.> instead of <25--26>).
\item[sequentes] The term equivalent to the Latin <sequentes> (<[and] the following [pages]>), as used to indicate an open"=ended range of pages when only the starting page is provided (\eg\ <25\,sqq.> or <25\,ff.>).
\item[passim] The term equivalent to the Latin <passim> (<throughout>, <here and there>, <scatteredly>).
\end{keymarglist}
%
Other expressions frequently used in citations:

\begin{keymarglist}
\item[see] The term <see>.
\item[seealso] The expression <see also>.
\item[seenote] An expression like <see note \prm{footnote}> or <as in \prm{footnote}>, used to refer to a previous footnote in a citation.
\item[backrefpage] An expression like <see page \prm{page}> or <cited on page \prm{page}>, used to introduce back references in the bibliography.
\item[backrefpages] The plural form of \texttt{backrefpage}, \eg\ <see pages \prm{pages}> or <cited on pages \prm{pages}>.
\item[quotedin] An expression like <quoted in \prm{citation}>, used when quoting a passage which was already a quotation in the cited work.
\item[citedas] An expression like <henceforth cited as \prm{shorthand}>, used to introduce a shorthand in a citation.
\item[thiscite] The expression used in some verbose citation styles to differentiate between the page range of the cited item (typically an article in a journal, collection, or conference proceedings) and the page number the citation refers to. For example: \enquote{Author, Title, in: Book, pp. 45--61, \texttt{thiscite} p. 52.}
\end{keymarglist}

\paragraph{Month Names}
\label{aut:lng:key:mon}

\begin{keymarglist}
\item[january] The name <January>.
\item[february] The name <February>.
\item[march] The name <March>.
\item[april] The name <April>.
\item[may] The name <May>.
\item[june] The name <June>.
\item[july] The name <July>.
\item[august] The name <August>.
\item[september] The name <September>.
\item[october] The name <October>.
\item[november] The name <November>.
\item[december] The name <December>.
\end{keymarglist}

\paragraph{Language Names}
\label{aut:lng:key:lng}

\begin{keymarglist}
\item[langamerican] The language <American> or <American English>.
\item[langbrazilian] The language <Brazilian> or <Brazilian Portuguese>.
\item[langcatalan] The language <Catalan>.
\item[langcroatian] The language <Croatian>.
\item[langczech] The language <Czech>.
\item[langdanish] The language <Danish>.
\item[langdutch] The language <Dutch>.
\item[langenglish] The language <English>.
\item[langfinnish] The language <Finnish>.
\item[langfrench] The language <French>.
\item[langgerman] The language <German>.
\item[langgreek] The language <Greek>.
\item[langitalian] The language <Italian>.
\item[langlatin] The language <Latin>.
\item[langnorwegian] The language <Norwegian>.
\item[langpolish] The language <Polish>.
\item[langportuguese] The language <Portuguese>.
\item[langrussian] The language <Russian>.
\item[langslovene] The language <Slovene>.
\item[langspanish] The language <Spanish>.
\item[langswedish] The language <Swedish>.
\end{keymarglist}
%
The following strings are intended for use in phrases like <translated from [the] English by \prm{translator}>:

\begin{keymarglist}
\item[fromamerican] The expression <from [the] American> or <from [the] American English>.
\item[frombrazilian] The expression <from [the] Brazilian> or <from [the] Brazilian Portuguese>.
\item[fromcatalan] The expression <from [the] Catalan>.
\item[fromczech] The expression <from [the] Czech>.
\item[fromcroatian] The expression <from [the] Croatian>.
\item[fromdanish] The expression <from [the] Danish>.
\item[fromdutch] The expression <from [the] Dutch>.
\item[fromenglish] The expression <from [the] English>.
\item[fromfinnish] The expression <from [the] Finnish>.
\item[fromfrench] The expression <from [the] French>.
\item[fromgerman] The expression <from [the] German>.
\item[fromgreek] The expression <from [the] Greek>.
\item[fromitalian] The expression <from [the] Italian>.
\item[fromlatin] The expression <from [the] Latin>.
\item[fromnorwegian] The expression <from [the] Norwegian>.
\item[frompolish] The expression <from [the] Polish>.
\item[fromportuguese] The expression <from [the] Portuguese>.
\item[fromrussian] The expression <from [the] Russian>.
\item[fromslovene] The expression <from [the] Slovene>.
\item[fromspanish] The expression <from [the] Spanish>.
\item[fromswedish] The expression <from [the] Swedish>.
\end{keymarglist}

\paragraph{Country Names}
\label{aut:lng:key:cnt}

Country names are localized by using the string \texttt{country} plus the \acr{ISO}-3166 country code as the key. The short version of the translation should be the \acr{ISO}-3166 country code. Note that only a small number of country names is defined by default, mainly to illustrate this scheme. These keys are used in the \bibfield{location} list of \bibtype{patent} entries but they may be useful for other purposes as well.

\begin{keymarglist}
\item[countryde] The name <Germany>, abbreviated as \texttt{DE}.
\item[countryeu] The name <European Union>, abbreviated as \texttt{EU}.
\item[countryep] Similar to \opt{countryeu} but abbreviated as \texttt{EP}. This is intended for \bibfield{patent} entries.
\item[countryfr] The name <France>, abbreviated as \texttt{FR}.
\item[countryuk] The name <United Kingdom>, abbreviated (according to \acr{ISO}-3166) as \texttt{GB}.
\item[countryus] The name <United States of America>, abbreviated as \texttt{US}.
\end{keymarglist}

\paragraph{Patents and Patent Requests}
\label{aut:lng:key:pat}

Strings related to patents are localized by using the term \texttt{patent} plus the \acr{ISO}-3166 country code as the key. Note that only a small number of patent keys is defined by default, mainly to illustrate this scheme. These keys are used in the \bibfield{type} field of \bibtype{patent} entries.

\begin{keymarglist}
\item[patent] The generic term <patent>.
\item[patentde] The expression <German patent>.
\item[patenteu] The expression <European patent>.
\item[patentfr] The expression <French patent>.
\item[patentuk] The expression <British patent>.
\item[patentus] The expression <U.S. patent>.
\end{keymarglist}
%
Patent requests are handled in a similar way, using the string \texttt{patreq} as the base name of the key:

\begin{keymarglist}
\item[patreq] The generic term <patent request>.
\item[patreqde] The expression <German patent request>.
\item[patreqeu] The expression <European patent request>.
\item[patreqfr] The expression <French patent request>.
\item[patrequk] The expression <British patent request>.
\item[patrequs] The expression <U.S. patent request>.
\end{keymarglist}

\subsection{格式化命令 Formatting Commands}
\label{aut:fmt}

This section corresponds to \secref{use:fmt} in the user part of this manual. Bibliography and citation styles should incorporate the commands and facilities discussed in this section in order to provide a certain degree of high"=level configurability. Users should not be forced to write new styles if all they want to do is modify the spacing in the bibliography or the punctuation used in citations.

\subsubsection{用户可定义的命令和钩子 User-definable Commands and Hooks}
\label{aut:fmt:fmt}

This section corresponds to \secref{use:fmt:fmt} in the user part of the manual. The commands and hooks discussed here are meant to be redefined by users, but bibliography and citation styles may provide a default definition which is different from the package default. These commands are defined in \path{biblatex.def}. Note that all commands starting with \cmd{mk\dots} take one mandatory argument.

\begin{ltxsyntax}

\csitem{bibnamedelima}\BiberOnlyMark
This delimiter controls the spacing between the elements which make up a name part. It is inserted automatically by the backend after the first name element if the element is less than three characters long and before the last element. The default definition is \cmd{addhighpenspace}, \ie a space penalized by the value of the \cnt{highnamepenalty} counter (\secref{use:fmt:len}). Please refer to \secref{use:cav:nam} for further details.

\csitem{bibnamedelimb}\BiberOnlyMark
This delimiter controls the spacing between the elements which make up a name part. It is inserted automatically by the backend between all name elements where \cmd{bibnamedelima} does not apply. The default definition is \cmd{addlowpenspace}, \ie a space penalized by the value of the \cnt{lownamepenalty} counter (\secref{use:fmt:len}). Please refer to \secref{use:cav:nam} for further details.

\csitem{bibnamedelimc}
This delimiter controls the spacing between name parts. The default name formats use it between the name prefix and the last name if \kvopt{useprefix}{true}. The default definition is \cmd{addhighpenspace}, \ie a space penalized by the value of the \cnt{highnamepenalty} counter (\secref{use:fmt:len}). Please refer to \secref{use:cav:nam} for further details.

\csitem{bibnamedelimd}
This delimiter controls the spacing between name parts. The default name formats use it between all name parts where \cmd{bibnamedelimc} does not apply. The default definition is \cmd{addlowpenspace}, \ie a space penalized by the value of the \cnt{lownamepenalty} counter (\secref{use:fmt:len}). Please refer to \secref{use:cav:nam} for further details.

\csitem{bibnamedelimi}\BiberOnlyMark
This delimiter replaces \cmd{bibnamedelima/b} after initials. Note that this only applies to initials given as such in the \file{bib} file, not to the initials automatically generated by \biblatex which use their own set of delimiters.

\csitem{bibinitperiod}\BiberOnlyMark
The punctuation inserted automatically by the backend after all initials unless \cmd{bibinithyphendelim} applies. The default definition is a period (\cmd{adddot}). Please refer to \secref{use:cav:nam} for further details.

\csitem{bibinitdelim}\BiberOnlyMark
The spacing inserted automatically by the backend between multiple initials unless \cmd{bibinithyphendelim} applies. The default definition is an unbreakable interword space. Please refer to \secref{use:cav:nam} for further details.

\csitem{bibinithyphendelim}\BiberOnlyMark
The punctuation inserted automatically by the backend between the initials of hyphenated name parts, replacing \cmd{bibinitperiod} and \cmd{bibinitdelim}. The default definition is a period followed by an unbreakable hyphen. Please refer to \secref{use:cav:nam} for further details.

\csitem{bibindexnamedelima}
Replaces \cmd{bibnamedelima} in the index.

\csitem{bibindexnamedelimb}
Replaces \cmd{bibnamedelimb} in the index.

\csitem{bibindexnamedelimc}
Replaces \cmd{bibnamedelimc} in the index.

\csitem{bibindexnamedelimd}
Replaces \cmd{bibnamedelimd} in the index.

\csitem{bibindexnamedelimi}
Replaces \cmd{bibnamedelimi} in the index.

\csitem{bibindexinitperiod}
Replaces \cmd{bibinitperiod} in the index.

\csitem{bibindexinitdelim}
Replaces \cmd{bibinitdelim} in the index.

\csitem{bibindexinithyphendelim}
Replaces \cmd{bibinithyphendelim} in the index.

\csitem{revsdnamepunct}
The punctuation to be printed between the first and last name parts when a name is reversed. The default is a comma. This command should be incorporated in formatting directives for name lists.  Please refer to \secref{use:cav:nam} for further details.

\csitem{bibnamedash}
The dash to be used as a replacement for recurrent authors or editors in the bibliography. The default is an <em> or an <en> dash, depending on the indentation of the list of references.

\csitem{labelnamepunct}
The separator to be printed after the name used for alphabetizing in the bibliography (\bibfield{author} or \bibfield{editor}, if the \bibfield{author} field is undefined). Use this separator instead of \cmd{newunitpunct} at this location. The default is \cmd{newunitpunct}, \ie it is not handled differently from regular unit punctuation but permits convenient reconfiguration.

\csitem{subtitlepunct}
The separator to be printed between the fields \bibfield{title} and \bibfield{subtitle}, \bibfield{booktitle} and \bibfield{booksubtitle}, as well as \bibfield{maintitle} and \bibfield{mainsubtitle}. Use this separator instead of \cmd{newunitpunct} at this location. The default is \cmd{newunitpunct}, \ie it is not handled differently from regular unit punctuation but permits convenient reconfiguration.

\csitem{intitlepunct}
The separator to be printed between the word «in» and the following title in entry types such as \bibtype{article}, \bibtype{inbook}, \bibtype{incollection}, etc. Use this separator instead of \cmd{newunitpunct} at this location. The default definition is a colon plus an interword space.

\csitem{bibpagespunct}
The separator to be printed before the \bibfield{pages} field. Use this separator instead of \cmd{newunitpunct} at this location. The default is a comma plus an interword space.

\csitem{bibpagerefpunct}
The separator to be printed before the \bibfield{pageref} field. Use this separator instead of \cmd{newunitpunct} at this location. The default is an interword space.

\csitem{multinamedelim}
The delimiter to be printed between multiple items in a name list like \bibfield{author} or \bibfield{editor} if there are more than two names in the list. If there are only two names in the list, use the \cmd{finalnamedelim} instead. This command should be incorporated in all formatting directives for name lists.

\csitem{finalnamedelim}
Use this command instead of \cmd{multinamedelim} before the final name in a name list.

\csitem{revsdnamedelim}
The extra delimiter to be printed after the first name in a name list (in addition to \cmd{finalnamedelim}) if the first name is reversed. This command should be incorporated in all formatting directives for name lists.

\csitem{andothersdelim}
The delimiter to be printed before the localization string <\texttt{andothers}> if a name list like \bibfield{author} or \bibfield{editor} is truncated. This command should be incorporated in all formatting directives for name lists.

\csitem{multilistdelim}
The delimiter to be printed between multiple items in a literal list like \bibfield{publisher} or \bibfield{location} if there are more than two names in the list. If there are only two items in the list, use the \cmd{finallistdelim} instead. This command should be incorporated in all formatting directives for literal lists.

\csitem{finallistdelim}
Use this command instead of \cmd{multilistdelim} before the final item in a literal list.

\csitem{andmoredelim}
The delimiter to be printed before the localization string <\texttt{andmore}> if a literal list like \bibfield{publisher} or \bibfield{location} is truncated. This command should be incorporated in all formatting directives for literal lists.

\csitem{multicitedelim}
The delimiter printed between citations if multiple entry keys are passed to a single citation command. This command should be incorporated in the definition of all citation commands, for example in the \prm{sepcode} argument passed to \cmd{DeclareCiteCommand}. See \secref{aut:cbx:cbx} for details.

\csitem{supercitedelim}
Similar to \cmd{multinamedelim}, but intended for the \cmd{supercite} command only.

\csitem{compcitedelim}
Similar to \cmd{multicitedelim}, but intended for citation styles that <compress> multiple citations, \ie print the author only once if subsequent citations share the same author etc.

\csitem{textcitedelim}
Similar to \cmd{multicitedelim}, but intended for \cmd{textcite} and related commands (\secref{use:cit:cbx}).

\csitem{nametitledelim}
The delimiter to be printed between the author\slash editor and the title. This command should be incorporated in the definition of all citation commands of author-title and some verbose citation styles.

\csitem{nameyeardelim}
The delimiter to be printed between the author\slash editor and the year. This command should be incorporated in the definition of all citation commands of author-year citation styles.

\csitem{volcitedelim}
The delimiter to be printed between the volume portion and the page/text portion of \cmd{volcite} and related commands (\secref{use:cit:spc}).

\csitem{prenotedelim}
The delimiter to be printed after the \prm{prenote} argument of a citation command.

\csitem{postnotedelim}
The delimiter to be printed after the \prm{postnote} argument of a citation command.

\cmditem{mkbibnamelast}{text}
Formatting hook for the last name, to be used in all formatting directives for name lists.

\cmditem{mkbibnamefirst}{text}
Similar to \cmd{mkbibnamelast}, but intended for the first name.

\cmditem{mkbibnameprefix}{text}
Similar to \cmd{mkbibnamelast}, but intended for the name prefix.

\cmditem{mkbibnameaffix}{text}
Similar to \cmd{mkbibnamelast}, but intended for the name affix.

\csitem{relatedpunct}
The separator between the relatedtype bibliography localization string and the data from the first related entry.

\csitem{relateddelim}
The separator between the data of multiple related entries. The default definition is a linebreak.

\end{ltxsyntax}

\subsubsection{不同语言的命令 Language-specific Commands}
\label{aut:fmt:lng}

This section corresponds to \secref{use:fmt:lng} in the user part of the manual. The commands discussed here are usually handled by the localization modules, but may also be redefined by users on a per"=language basis. Note that all commands starting with \cmd{mk\dots} take one or more mandatory arguments.

\begin{ltxsyntax}

\csitem{bibrangedash}

The language specific range dash.

\csitem{bibdatedash}

The language specific date range dash.

\csitem{mkbibdatelong}

Takes the names of three field as arguments which correspond to three date components (in the order year\slash month\slash day) and uses their values to print the date in the language specific long date format.

\csitem{mkbibdateshort}

Similar to \cmd{mkbibdatelong} but using the language specific short date format.

\csitem{finalandcomma}

Prints the comma to be inserted before the final <and> in an enumeration, if applicable in the respective language.

\csitem{finalandsemicolon}

Prints the semicolon to be inserted before the final <and> in an enumeration, if applicable in the respective language.

\cmditem{mkbibordinal}{integer}

Takes an integer argument and prints it as an ordinal number.

\cmditem{mkbibmascord}{integer}

Similar to \cmd{mkbibordinal}, but prints a masculine ordinal, if applicable in the respective language.

\cmditem{mkbibfemord}{integer}

Similar to \cmd{mkbibordinal}, but prints a feminine ordinal, if applicable in the respective language.

\cmditem{mkbibneutord}{integer}

Similar to \cmd{mkbibordinal}, but prints a neuter ordinal, if applicable in the respective language.

\cmditem{mkbibordedition}{integer}

Similar to \cmd{mkbibordinal}, but intended for use with the term <edition>.

\cmditem{mkbibordseries}{integer}

Similar to \cmd{mkbibordinal}, but intended for use with the term <series>.

\end{ltxsyntax}

\subsubsection{用户可定义的尺寸和计数器 User-definable Lengths and Counters}
\label{aut:fmt:len}

This section corresponds to \secref{use:fmt:len} in the user part of the manual. The length registers and counters discussed here are meant to be altered by users. Bibliography and citation styles should incorporate them where applicable and may also provide a default setting which is different from the package default.

\begin{ltxsyntax}

\lenitem{bibhang}

The hanging indentation of the bibliography, if applicable. This length is initialized to \cmd{parindent} at load-time. If \cmd{parindent} is zero length for some reason, \cmd{bibhang} will default to \texttt{1em}.

\lenitem{biblabelsep}

The horizontal space between entries and their corresponding labels. Bibliography styles which use \env{list} environments and print a label should set \len{labelsep} to \len{biblabelsep} in the definition of the respective environment.

\lenitem{bibitemsep}

The vertical space between the individual entries in the bibliography. Bibliography styles using \env{list} environments should set \len{itemsep} to \len{bibitemsep} in the definition of the respective environment.

\lenitem{bibparsep}

The vertical space between paragraphs within an entry in the bibliography. Bibliography styles using \env{list} environments should set \len{parsep} to \len{bibparsep} in the definition of the respective environment.

\cntitem{abbrvpenalty}

The penalty used by \cmd{addabbrvspace}, \cmd{addabthinspace}, and \cmd{adddotspace}, see \secref{aut:pct:spc} for details.

\cntitem{lownamepenalty}

The penalty used by \cmd{addlowpenspace} and \cmd{addlpthinspace}, see \secref{aut:pct:spc} for details.

\cntitem{highnamepenalty}

The penalty used by \cmd{addhighpenspace} and \cmd{addhpthinspace}, see \secref{aut:pct:spc} for details.

\cntitem{biburlnumpenalty}

If this counter is set to a value greater than zero, \biblatex will permit linebreaks after numbers in all strings formatted with the \cmd{url} command from the \sty{url} package. This will affect \acr{url}s and \acr{doi}s in the bibliography. The breakpoints will be penalized by the value of this counter. If \acr{url}s and/or \acr{doi}s in the bibliography run into the margin, try setting this counter to a value greater than zero but less than 10000 (you normally want to use a high value like 9000). Setting the counter to zero disables this feature. This is the default setting.

\cntitem{biburlucpenalty}

Similar to \cnt{biburlnumpenalty}, except that it will add a breakpoint after all uppercase letters.

\cntitem{biburllcpenalty}

Similar to \cnt{biburlnumpenalty}, except that it will add a breakpoint after all lowercase letters.

\end{ltxsyntax}

\subsubsection{辅助命令和钩子 Auxiliary Commands and Hooks}
\label{aut:fmt:ich}

The auxiliary commands and facilities in this section serve a special purpose. Some of them are used by \biblatex to communicate with bibliography and citation styles in some way or other.

\begin{ltxsyntax}

\cmditem{mkbibemph}{text}

A generic command which prints its argument as emphasized text. This is a simple wrapper around the standard \cmd{emph} command. Apart from that, it uses \cmd{setpunctfont} from \secref{aut:pct:new} to adapt the font of the next punctuation mark following the text set in italics. If the \opt{punctfont} package option is disabled, this command behaves like \cmd{emph}.

\cmditem{mkbibitalic}{text}

Similar in concept to \cmd{mkbibemph} but prints italicized text. This is a simple wrapper around the standard \cmd{textit} command which incorporates \cmd{setpunctfont}. If the \opt{punctfont} package option is disabled, this command behaves like \cmd{textit}.

\cmditem{mkbibbold}{text}

Similar in concept to \cmd{mkbibemph} but prints bold text. This is a simple wrapper around the standard \cmd{textbf} command which incorporates \cmd{setpunctfont}. If the \opt{punctfont} package option is disabled, this command behaves like \cmd{textbf}.

\cmditem{mkbibquote}{text}

A generic command which wraps its argument in quotation marks. If the \sty{csquotes} package is loaded, this command uses the language sensitive quotation marks provided by that package. \cmd{mkbibquote} also supports <American-style> punctuation, see \cmd{DeclareQuotePunctuation} in \secref{aut:pct:cfg} for details.

\cmditem{mkbibparens}{text}

A generic command which wraps its argument in parentheses. This command is nestable. When nested, it will alternate between parentheses and brackets, depending on the nesting level.

\cmditem{mkbibbrackets}{text}

A generic command which wraps its argument in square brackets. This command is nestable. When nested, it will alternate between brackets and parentheses, depending on the nesting level.

\cmditem{bibopenparen}<text>|{\ltxsyntaxlabelfont\cmd{bibcloseparen}}|

Alternative syntax for \cmd{mkbibparens}. This will also work across groups. Note that \cmd{bibopenparen} and \cmd{bibcloseparen} must always be balanced.

\cmditem{bibopenbracket}<text>|{\ltxsyntaxlabelfont\cmd{bibclosebracket}}|

Alternative syntax for \cmd{mkbibbrackets}. This will also work across groups. Note that \cmd{bibopenbracket} and \cmd{bibclosebracket} must always be balanced.

\cmditem{mkbibfootnote}{text}

A generic command which prints its argument as a footnote. This is a wrapper around the standard \latex \cmd{footnote} command which removes spurious whitespace preceding the footnote mark and prevents nested footnotes. By default, \cmd{mkbibfootnote} requests capitalization at the beginning of the note and automatically adds a period at the end. You may change this behavior by redefining the \cmd{bibfootnotewrapper} macro introduced below.

\cmditem{mkbibfootnotetext}{text}

Similar to \cmd{mkbibfootnote} but uses the \cmd{footnotetext} command.

\cmditem{mkbibendnote}{text}

Similar in concept to \cmd{mkbibfootnote} except that it prints its argument as an endnote. \cmd{mkbibendnote} removes spurious whitespace preceding the endnote mark and prevents nested notes. It supports the \cmd{endnote} command provided by the \sty{endnotes} package as well as the \cmd{pagenote} command provided by the \sty{pagenote} package and the \sty{memoir} class. If both commands are available, \cmd{endnote} takes precedence. If no endnote support is available, \cmd{mkbibendnote} issues an error and falls back to \cmd{footnote}. By default, \cmd{mkbibendnote} requests capitalization at the beginning of the note and automatically adds a period at the end. You may change this behavior by redefining the \cmd{bibendnotewrapper} macro introduced below.

\cmditem{mkbibendnotetext}{text}

Similar to \cmd{mkbibendnote} but uses the \cmd{endnotetext} command. Please note that as of this writing, neither the \sty{pagenote} package nor the \sty{memoir} class provide a corresponding \cmd{pagenotetext} command. In this case, \cmd{mkbibendnote} will issue an error and fall back to \cmd{footnotetext}.

\cmditem{bibfootnotewrapper}{text}

An inner wrapper which encloses the \prm{text} argument of \cmd{mkbibfootnote} and \cmd{mkbibfootnotetext}. For example, \cmd{mkbibfootnote} eventually boils down to this:

\begin{lstlisting}[style=latex]{}
\footnote{<<\bibfootnotewrapper{>>text<<}>>}
\end{lstlisting}
%
The wrapper ensures capitalization at the beginning of the note and adds a period at the end. The default definition is:

\begin{lstlisting}[style=latex]{}
\newcommand{\bibfootnotewrapper}[1]{<<\bibsentence>> #1<<\addperiod>>}
\end{lstlisting}
%
If you don't want capitalization at the beginning or a period at the end of the note, do not modify \cmd{mkbibfootnote} but redefine \cmd{bibfootnotewrapper} instead.

\cmditem{bibendnotewrapper}{text}

Similar in concept to \cmd{bibfootnotewrapper} but related to the \cmd{mkbibendnote} and \cmd{mkbibendnotetext} commands.

\cmditem{mkbibsuperscript}{text}

A generic command which prints its argument as superscripted text. This is a simple wrapper around the standard \latex \cmd{textsuperscript} command which removes spurious whitespace and allows hyphenation of the preceding word.

\cmditem{mkbibmonth}{integer}

This command takes an integer argument and prints it as a month name. Even though the output of this command is language specific, its definition is not, hence it is normally not redefined in localization modules.

\cmditem{mkdatezeros}{integer}

This command strips leading zeros from a number or preserves them, depending on the \opt{datezeros} package option (\secref{use:opt:pre:gen}). It is intended for use in the definition of date formatting macros.

\cmditem{stripzeros}{integer}

This command strips leading zeros from a number. It is intended for date formatting and ordinals.

\optitem{shorthandwidth}\BibTeXOnlyMark

A special field formatting directive which is used internally by \biblatex. When the bibliographic data is read from the \file{bbl} file, \biblatex measures the values of all \bibfield{shorthand} fields and sets the length register \cmd{shorthandwidth} to the width of the widest shorthand (see \secref{aut:fmt:ilc}). In order to determine the correct width, the package considers two factors: the definition of \cmd{bibfont} and this formatting directive. All styles should adjust this directive such that it corresponds to the format used in the list of shorthands.

\optitem{<labelfield>width}\BiberOnlyMark

With \biber, for every field marked as a <Label field> in the data model, a formatting directive is created as per \texttt{shorthandwidth} above. Since \bibfield{shorthand} is so marked in the default data model, this functionality is a superset of that described for \texttt{shorthandwidth}.

\optitem{labelnumberwidth}

Similar to \texttt{shorthandwidth}, but referring to the \bibfield{labelnumber} field and the length register \cmd{labelnumberwidth}. Numeric styles should adjust this directive such that it corresponds to the format used in the bibliography.

\optitem{labelalphawidth}

Similar to \texttt{shorthandwidth}, but referring to the \bibfield{labelalpha} field and the length register \cmd{labelalphawidth}. Alphabetic styles should adjust this directive such that it corresponds to the format used in the bibliography.

\optitem{bibhyperref}

A special formatting directive for use with \cmd{printfield} and \cmd{printtext}. This directive wraps its argument in a \cmd{bibhyperref} command, see \secref{aut:aux:msc} for details.

\optitem{bibhyperlink}

A special formatting directive for use with \cmd{printfield} and \cmd{printtext}. It wraps its argument in a \cmd{bibhyperlink} command, see \secref{aut:aux:msc} for details. The \prm{name} argument passed to \cmd{bibhyperlink} is the value of the \bibfield{entrykey} field.

\optitem{bibhypertarget}

A special formatting directive for use with \cmd{printfield} and \cmd{printtext}. It wraps its argument in a \cmd{bibhypertarget} command, see \secref{aut:aux:msc} for details. The \prm{name} argument passed to \cmd{bibhypertarget} is the value of the \bibfield{entrykey} field.

\optitem{volcitepages}

A special formatting directive which controls the format of the page\slash text portion in the argument of citation commands like \cmd{volcite}.

\optitem{volcitevolume}

A special formatting directive which controls the format of the volume portion in the argument of citation commands like \cmd{volcite}.

\optitem{date}

A special formatting directive which controls the format of \cmd{printdate} (\secref{aut:bib:dat}). Note that the date format (long/short etc.) is controlled by the package option \opt{date} from \secref{use:opt:pre:gen}. This formatting directive only controls additional formatting such as fonts etc.

\optitem{datelabel}

Similar to \texttt{date} but controls the format of \cmd{printdatelabel}.

\optitem{urldate}

Similar to \texttt{date} but controls the format of \cmd{printurldate}.

\optitem{origdate}

Similar to \texttt{date} but controls the format of \cmd{printorigdate}.

\optitem{eventdate}

Similar to \texttt{date} but controls the format of \cmd{printeventdate}.

\end{ltxsyntax}

\subsubsection{辅助长度计数器和其它功能 Auxiliary Lengths, Counters, and Other Features}
\label{aut:fmt:ilc}

The length registers and counters discussed here are used by \biblatex to pass information to bibliography and citation styles. Think of them as read"=only registers. Note that all counters are \latex counters. Use |\value{counter}| to read out the current value.

\begin{ltxsyntax}

\lenitem{shorthandwidth}\BibTeXOnlyMark

This length register indicates the width of the widest \bibfield{shorthand}. Bibliography styles should incorporate this length in the definition of the list of shorthands, if applicable.

\lenitem{<labelfield>width}\BiberOnlyMark

With \biber, for every field marked as a <Label field> in the data model, a length register is created as per \texttt{shorthandwidth} above. Since \bibfield{shorthand} is so marked in the default data model, this functionality is a superset of that described for \texttt{shorthandwidth}.

\lenitem{labelnumberwidth}

This length register indicates the width of the widest \bibfield{labelnumber}. Numeric bibliography styles
should incorporate this length in the definition of the bibliography environment.

\lenitem{labelalphawidth}

This length register indicates the width of the widest \bibfield{labelalpha}. Alphabetic bibliography styles should incorporate this length in the definition of the bibliography environment.

\cntitem{maxextraalpha}

This counter holds the highest number found in any \bibfield{extraalpha} field.

\cntitem{maxextrayear}

This counter holds the highest number found in any \bibfield{extrayear} field.

\cntitem{refsection}

This counter indicates the current \env{refsection} environment. When queried in a bibliography heading, the counter returns the value of the \opt{refsection} option passed to \cmd{printbibliography}.

\cntitem{refsegment}

This counter indicates the current \env{refsegment} environment. When queried in a bibliography heading, this counter returns the value of the \opt{refsegment} option passed to \cmd{printbibliography}.

\cntitem{maxnames}

This counter holds the setting of the \opt{maxnames} package option.

\cntitem{minnames}

This counter holds the setting of the \opt{minnames} package option.

\cntitem{maxitems}

This counter holds the setting of the \opt{maxitems} package option.

\cntitem{minitems}

This counter holds the setting of the \opt{minitems} package option.

\cntitem{instcount}

This counter is incremented by \biblatex for every citation as well as for every entry in the bibliography and bibliography lists. The value of this counter uniquely identifies a single instance of a reference in the document.

\cntitem{citetotal}

This counter, which is only available in the \prm{loopcode} of a citation command defined with \cmd{DeclareCiteCommand}, holds the total number of valid entry keys passed to the citation command.

\cntitem{citecount}

This counter, which is only available in the \prm{loopcode} of a citation command defined with \cmd{DeclareCiteCommand}, holds the number of the entry key currently being processed by the \prm{loopcode}.

\cntitem{multicitetotal}

This counter is similar to \cnt{citetotal} but only available in multicite commands. It holds the total number of citations passed to the multicite command. Note that each of these citations may consist of more than one entry key. This information is provided by the \cnt{citetotal} counter.

\cntitem{multicitecount}

This counter is similar to \cnt{citecount} but only available in multicite commands. It holds the number of the citation currently being processed. Note that this citation may consist of more than one entry key. This information is provided by the \cnt{citetotal} and \cnt{citecount} counters.

\cntitem{listtotal}

This counter holds the total number of items in the current list. It is intended for use in list formatting directives and does not hold a meaningful value when used anywhere else. As an exception, it may also be used in the second optional argument to \cmd{printnames} and \cmd{printlist}, see \secref{aut:bib:dat} for details. For every list, there is also a counter by the same name which holds the total number of items in the corresponding list. For example, the \cnt{author} counter holds the total number of items in the \bibfield{author} list. This applies to both name lists and literal lists. These counters are similar to \cnt{listtotal} except that they may also be used independently of list formatting directives. For example, a bibliography style might check the \cnt{editor} counter to decide Whether or not to print the term «editor» or rather its plural form «editors» after the list of editors.

\cntitem{listcount}

This counter holds the number of the list item currently being processed. It is intended for use in list formatting directives and does not hold a meaningful value when used anywhere else.

\cntitem{liststart}

This counter holds the \prm{start} argument passed to \cmd{printnames} or \cmd{printlist}. It is intended for use in list formatting directives and does not hold a meaningful value when used anywhere else.

\cntitem{liststop}

This counter holds the \prm{stop} argument passed to \cmd{printnames} or \cmd{printlist}. It is intended for use in list formatting directives and does not hold a meaningful value when used anywhere else.

\csitem{currentfield}

The name of the field currently being processed by \cmd{printfield}. This information is only available locally in field formatting directives.

\csitem{currentlist}

The name of the literal list currently being processed by \cmd{printlist}. This information is only available locally in list formatting directives.

\csitem{currentname}

The name of the name list currently being processed by \cmd{printnames}. This information is only available locally in name formatting directives.

\end{ltxsyntax}

\subsubsection{一般目的的钩子 General Purpose Hooks}
\label{aut:fmt:hok}

\begin{ltxsyntax}

\cmditem{AtBeginBibliography}{code}

Appends the \prm{code} to an internal hook executed at the beginning of the bibliography. The \prm{code} is executed at the beginning of the list of references, immediately after the \prm{begin code} of \cmd{defbibenvironment}. This command may only be used in the preamble.

\cmditem{AtBeginShorthands}{code}

Appends the \prm{code} to an internal hook executed at the beginning of the list of shorthands. The \prm{code} is executed at the beginning of the list of shorthands, immediately after the \prm{begin code} of \cmd{defbibenvironment}. This command may only be used in the preamble.

When using \biber, this is just an alias for:

\begin{lstlisting}[style=latex]{}
\AtBeginBiblist{shorthand}{code}
\end{lstlisting}

\cmditem{AtBeginBiblist}{biblistname}{code}\BiberOnlyMark

Appends the \prm{code} to an internal hook executed at the beginning of the bibliography list \prm{biblistname}. The \prm{code} is executed at the beginning of the bibliography list, immediately after the \prm{begin code} of \cmd{defbibenvironment}. This command may only be used in the preamble.

\cmditem{AtEveryBibitem}{code}

Appends the \prm{code} to an internal hook executed at the beginning of every item in the bibliography. The \prm{code} is executed immediately after the \prm{item code} of \cmd{defbibenvironment}. The bibliographic data of the respective entry is available at this point. This command may only be used in the preamble.

\cmditem{AtEveryLositem}{code}

Appends the \prm{code} to an internal hook executed at the beginning of every item in the list of shorthands. The \prm{code} is executed immediately after the \prm{item code} of \cmd{defbibenvironment}. The bibliographic data of the respective entry is available at this point. This command may only be used in the preamble.

When using \biber, this is just an alias for:

\begin{lstlisting}[style=latex]{}
\AtEveryBiblistitem{shorthand}{code}
\end{lstlisting}

\cmditem{AtEveryBiblistitem}{biblistname}{code}\BiberOnlyMark

Appends the \prm{code} to an internal hook executed at the beginning of every item in the bibliography list named \prm{biblistname}. The \prm{code} is executed immediately after the \prm{item code} of \cmd{defbibenvironment}. The bibliographic data of the respective entry is available at this point. This command may only be used in the preamble.

\cmditem{AtNextBibliography}{code}

Similar to \cmd{AtBeginBibliography} but only affecting the next \cmd{printbibliography}. The internal hook is cleared after being executed once. This command may be used in the document body.

\cmditem{AtEveryCite}{code}

Appends the \prm{code} to an internal hook executed at the beginning of every citation command. The \prm{code} is executed immediately before the \prm{precode} of the command (see \secref{aut:cbx:cbx}). No bibliographic data is available at this point. This command may only be used in the preamble.

\cmditem{AtEveryCitekey}{code}

Appends the \prm{code} to an internal hook executed once for every entry key passed to a citation command. The \prm{code} is executed immediately before the \prm{loopcode} of the command (see \secref{aut:cbx:cbx}). The bibliographic data of the respective entry is available at this point. This command may only be used in the preamble.

\cmditem{AtEveryMultiCite}{code}

Appends the \prm{code} to an internal hook executed at the beginning of every multicite command. The \prm{code} is executed immediately before the \bibfield{multiprenote} field (\secref{aut:cbx:fld}) is printed. No bibliographic data is available at this point. This command may only be used in the preamble.

\cmditem{AtNextCite}{code}

Similar to \cmd{AtEveryCite} but only affecting the next citation command. The internal hook is cleared after being executed once. This command may be used in the document body.

\cmditem{AtNextCitekey}{code}

Similar to \cmd{AtEveryCitekey} but only affecting the next entry key. The internal hook is cleared after being executed once. This command may be used in the document body.

\cmditem{AtNextMultiCite}{code}

Similar to \cmd{AtEveryMultiCite} but only affecting the next multicite command. The internal hook is cleared after being executed once. This command may be used in the document body.

\cmditem{AtDataInput}[entrytype]{code}

Appends the \prm{code} to an internal hook executed once for every entry as the bibliographic data is imported from the \file{bbl} file. The \prm{entrytype} is the entry type the \prm{code} applies to. If it applies to all entry types, omit the optional argument. The \prm{code} is executed immediately after the entry has been imported. This command may only be used in the preamble. Note that \prm{code} may be executed multiple times for an entry. This occurs when the same entry is cited in different \env{refsection} environments or the \opt{sorting} option settings incorporate more than one sorting scheme. The \cnt{refsection} counter holds the number of the respective reference section while the data is imported.

\cmditem{UseBibitemHook}

Executes the internal hook corresponding to \cmd{AtEveryBibitem}.

\cmditem{UseEveryCiteHook}

Executes the internal hook corresponding to \cmd{AtEveryCite}.

\cmditem{UseEveryCitekeyHook}

Executes the internal hook corresponding to \cmd{AtEveryCitekey}.

\cmditem{UseEveryMultiCiteHook}

Executes the internal hook corresponding to \cmd{AtMultiEveryCite}.

\cmditem{UseNextCiteHook}

Executes and clears the internal hook corresponding to \cmd{AtNextCite}.

\cmditem{UseNextCitekeyHook}

Executes and clears the internal hook corresponding to \cmd{AtNextCitekey}.

\cmditem{UseNextMultiCiteHook}

Executes and clears the internal hook corresponding to \cmd{AtNextMultiCite}.

\cmditem{DeferNextCitekeyHook}

Locally un-defines the internal hook specified by \cmd{AtNextCitekey}. This essentially defers the hook to the next entry key in the citation list, when executed in the \prm{precode} argument of \cmd{DeclareCiteCommand} (\secref{aut:cbx:cbx}).

\end{ltxsyntax}

\subsection{提示与警告 Hints and Caveats}
\label{aut:cav}

This section provides some additional hints concerning the author interface of this package. It also addresses common problems and potential misconceptions.

\subsubsection{条目集 Entry Sets}
\label{aut:cav:set}

Entry sets have already been introduced in \secref{use:use:set}. This section discusses how to process entry sets in a bibliography style. From the perspective of the driver, there is no difference between static and dynamic entry sets. Both types are handled in the same way. You will normally use the \cmd{entryset} command from \secref{aut:bib:dat} to loop over all set members (in the order in which they are listed in the \bibfield{entryset} field of the \bibtype{set} entry, or in the order in which they were passed to \cmd{defbibentryset}, respectively) and append \cmd{finentry} at the end. That's it. The formatting is handled by the drivers for the entry types of the individual set members:

\begin{lstlisting}[style=latex]{}
\DeclareBibliographyDriver{set}{%
  <<\entryset>>{}{}%
  \finentry}
\end{lstlisting}
%
You may have noticed that the \texttt{numeric} styles which ship with this package support subdivided entry sets, \ie the members of the set are marked with a letter or some other marker such that citations may either refer to the entire set or to a specific set member. The markers are generated as follows by the bibliography style:

\begin{lstlisting}[style=latex]{}
\DeclareBibliographyDriver{set}{%
  \entryset
    {<<\printfield{entrysetcount}>>%
     <<\setunit*{\addnbspace}>>}
    {}%
  \finentry}
\end{lstlisting}
%
The \bibfield{entrysetcount} field holds an integer indicating the position of a set member in the entry set. The conversion of this number to a letter or some other marker is handled by the formatting directive of the \bibfield{entrysetcount} field. All the driver needs to do is print the field and add some white space (or start a new line). Printing the markers in citations works in a similar way. Where a numeric style normally says |\printfield{labelnumber}|, you simply append the \bibfield{entrysetcount} field:

\begin{lstlisting}[style=latex]{}
\printfield{labelnumber}<<\printfield{entrysetcount}>>
\end{lstlisting}
%
Since this field is only defined when processing citations referring to a set member, there is no need to add any additional tests.

\subsubsection{电子出版信息 Electronic Publishing Information}
\label{aut:cav:epr}

The standard styles feature dedicated support for arXiv references. Support for other resources is easily added. The standard styles handle the \bibfield{eprint} field as follows:

\begin{lstlisting}[style=latex]{}
\iffieldundef{eprinttype}
  {\printfield{eprint}}
  {\printfield[<<eprint:\strfield{eprinttype}>>]{eprint}}
\end{lstlisting}
%
If an \bibfield{eprinttype} field is available, the above code tries to use the field format \texttt{eprint:\prm{eprinttype}}. If this format is undefined, \cmd{printfield} automatically falls back to the field format \texttt{eprint}. There are two predefined field formats, the type"=specific format \texttt{eprint:arxiv} and the fallback format \texttt{eprint}:

\begin{lstlisting}[style=latex]{}
\DeclareFieldFormat{<<eprint>>}{...}
\DeclareFieldFormat{<<eprint:arxiv>>}{...}
\end{lstlisting}
%
In other words, adding support for additional resources is as easy as defining a field format named \texttt{eprint:\prm{resource}} where \prm{resource} is an identifier to be used in the \bibfield{eprinttype} field.

\subsubsection{额外的摘要和注释 External Abstracts and Annotations}
\label{aut:cav:prf}

External abstracts and annotations have been discussed in \secref{use:use:prf}. This section provides some more background for style authors. The standard styles use the following macros (from \path{biblatex.def}) to handle abstracts and annotations:

\begin{lstlisting}[style=latex]{}
\newbibmacro*{annotation}{%
  \iffieldundef{annotation}
    {\printfile[annotation]{<<\bibannotationprefix\thefield{entrykey}.tex>>}}%
    {\printfield{annotation}}}
\newcommand*{<<\bibannotationprefix>>}{bibannotation-}

\newbibmacro*{abstract}{%
  \iffieldundef{abstract}
    {\printfile[abstract]{<<\bibabstractprefix\thefield{entrykey}.tex>>}}%
    {\printfield{abstract}}}
\newcommand*{<<\bibabstractprefix>>}{bibabstract-}
\end{lstlisting}
%
If the \bibfield{abstract}\slash \bibfield{annotation} field is undefined, the above code tries to load the abstracts\slash annotations from an external file. The \cmd{printfile} commands also incorporate file name prefixes which may be redefined by users. Note that you must enable \cmd{printfile} explicitly by setting the \opt{loadfiles} package option from \secref{use:opt:pre:gen}. This feature is disabled by default for performance reasons.

\subsubsection[消除姓名歧义 Name Disambiguation]{消除姓名歧义 Name Disambiguation\BiberOnlyMark}
\label{aut:cav:amb}

%The \opt{uniquename} and \opt{uniquelist} options introduced in \secref{use:opt:pre:int} support various modes of operation. This section explains the differences between these modes by way of example. The \opt{uniquename} option disambiguates individual names in the \bibfield{labelname} list. The \opt{uniquelist} option disambiguates the \bibfield{labelname} list if it has become ambiguous after \opt{maxnames}\slash \opt{minnames} truncation. You can use either option stand-alone or combine both.

在\secref{use:opt:pre:int}节引入的\opt{uniquename}和\opt{uniquelist}选项支持多种操作模式。本节用举例方式介绍不同模式的差别。\opt{uniquename}选项消除\bibfield{labelname}列表中各姓名间的歧义，\opt{uniquelist}消除因\opt{maxnames}\slash \opt{minnames}截短导致的\bibfield{labelname}列表歧义。两个选项可以单独使用也可以联合使用:

%\paragraph{Individual Names (\opt{uniquename})}
\paragraph{单个姓名(姓名内的处理) (\opt{uniquename})}

%Let's start off with some \opt{uniquename} examples. Consider the following data:
下面从一些\opt{uniquename}例子开始，考虑如下数据:

\begin{lstlisting}{}
John Doe   2008
Edward Doe 2008
John Smith 2008
Jane Smith 2008
\end{lstlisting}
%
%Let's assume we're using an author-year style and set \kvopt{uniquename}{false}. In this case, we would get the following citations:

假设我们使用作者年制且设置\kvopt{uniquename}{false}，这种情况下，我们得到如下引用标注:

\begin{lstlisting}{}
Doe 2008a
Doe 2008b
Smith 2008a
Smith 2008b
\end{lstlisting}
%
%Since the last names are ambiguous and all works have been published in the same year, an extra letter is appended to the year to disambiguate the citations. Many style guides, however, mandate that the extra letter be used to disambiguate works by the same authors only, not works by different authors with the same last name. In order to disambiguate the author's last name, you are expected to add additional parts of the name, either as initials or in full. This requirement is addressed by the \opt{uniquename} option. Here are the same citations with \kvopt{uniquename}{init}:

因为姓有歧义，且所有的年都相同，所以年后附加的字符用来区分并消除歧义。然而，很多样式指南强制要求附加字符只能用于相同作者的区分，而不能用于作者相同的姓的区分。为了消除作者姓的歧义，需要增加姓名的其它完整部分或者缩写来区分。这一需要由\opt{uniquename}选项处理，下面是使用了\kvopt{uniquename}{init}的引用标注:

\begin{lstlisting}{}
J. Doe 2008
E. Doe 2008
Smith 2008a
Smith 2008b
\end{lstlisting}
%
%\kvopt{uniquename}{init} restricts name disambiguation to initials. Since <J. Smith> would still be ambiguous, no additional name parts are added for the <Smiths>. With \kvopt{uniquename}{full}, names are printed in full where required:

\kvopt{uniquename}{init}限制了用缩写来区分姓名。但因为<J. Smith>仍然有歧义，所以没有增加。而使用\kvopt{uniquename}{full}，标注如下:

\begin{lstlisting}{}
J. Doe 2008
E. Doe 2008
John Smith 2008
Jane Smith 2008
\end{lstlisting}
%
%In order to illustrate the difference between \kvopt{uniquename}{init\slash full} and \texttt{allinit\slash allfull}, we need to introduce the notion of a <visible> name. In the following, <visible> names are all names at a position before the \opt{maxnames}\slash \opt{minnames}\slash \opt{uniquelist} truncation point. For example, given this data:

为了说明\kvopt{uniquename}{init\slash full}和\texttt{allinit\slash allfull}的差别，我们下面介绍 <visible> 姓名的概念。<visible> 姓名时位于\opt{maxnames}\slash \opt{minnames}\slash \opt{uniquelist}截短点前的姓名，比如，给出数据:

\begin{lstlisting}{}
William Jones/Edward Doe/Jane Smith
John Doe
John Smith
\end{lstlisting}
%
%and \kvopt{maxnames}{1}, \kvopt{minnames}{1}, \kvopt{uniquename}{init/full}, we would get the following names in citations:

\kvopt{maxnames}{1}, \kvopt{minnames}{1}, \kvopt{uniquename}{init/full}，我们得到如下的引用标注:

\begin{lstlisting}{}
Jones et al.
Doe
Smith
\end{lstlisting}
%
%When disambiguating names, \kvopt{uniquename}{init/full} only consider the visible names. Since all visible last names are distinct in this example, no further name parts are added. Let's compare that to the output of \kvopt{uniquename}{allinit}:

在消除歧义的时候，\kvopt{uniquename}{init/full}仅考虑可见的姓名。因为本例中所有的可见姓名的姓都是不同的，所有没有姓名的其他部分附加进来。比较一下使用\kvopt{uniquename}{allinit}的输出:

\begin{lstlisting}{}
Jones et al.
J. Doe
Smith
\end{lstlisting}
%
%\texttt{allinit} considers all names in all \bibfield{labelname} lists, including those which are hidden and replaced by <et al.> as the list is truncated. In this example, <John Doe> is disambiguated from <Edward Doe>. Since the ambiguity of the two <Smiths> can't be resolved by adding initials, no initials are added in this case. Now let's compare that to the output of \kvopt{uniquename}{allfull} which also disambiguates <John Smith> from <Jane Smith>:

\texttt{allinit}认为所有在\bibfield{labelname}列表中的姓名，包括列表截短后已经隐藏并且由<et al.>代替的姓名。在本例中，<John Doe> 与 <Edward Doe>存在歧义。因为两个 <Smiths> 无法通过添加缩写的方式区分，所以没有添加。现在来比较一下\kvopt{uniquename}{allfull}的输出:

\begin{lstlisting}{}
Jones et al.
J. Doe
John Smith
\end{lstlisting}
%
The options \kvopt{uniquename}{mininit/minfull} are similar to \texttt{init\slash full} in that they only consider visible names, but they perform minimal disambiguation. That is, they will disambiguate individual names only if they occur in identical lists of last names. Consider the following data:

\kvopt{uniquename}{mininit/minfull}选项类似于\texttt{init\slash full}仅考虑可见姓名，但仅执行最小的歧义消除。即，仅对姓列表的歧义进行处理，考虑如下数据:

\begin{lstlisting}{}
John Doe/William Jones
Edward Doe/William Jones
John Smith/William Edwards
Edward Smith/Allan Johnson
\end{lstlisting}
%
%With \kvopt{uniquename}{init/full}, we would get:

使用\kvopt{uniquename}{init/full}，得到:

\begin{lstlisting}{}
J. Doe and Jones
E. Doe and Jones
J. Smith and Edwards
E. Smith and Johnson
\end{lstlisting}
%
%With \kvopt{uniquename}{mininit/minfull}:
使用\kvopt{uniquename}{mininit/minfull}，得到:

\begin{lstlisting}{}
J. Doe and Jones
E. Doe and Jones
Smith and Edwards
Smith and Johnson
\end{lstlisting}
%
%The <Smiths> are not disambiguated because the visible name lists are not ambiguous and the \opt{mininit/minfull} options serve to disambiguate names occurring in identical last name lists only. Another way of looking at this is that they globally disambiguate last name lists. When it comes to ambiguous lists, note that a truncated list is considered to be distinct from an untruncated one even if the visible names are identical. For example, consider the following data:

<Smiths> 并无歧义，因为姓名列表时没有歧义。\opt{mininit/minfull}选项仅对姓的列表相同情况进行处理。全局的看姓的列表，注意当未截短的列表的可见名相同的时候，截短的列表时也可能是不同的，比如下面的数据:


\begin{lstlisting}{}
John Doe/William Jones
Edward Doe
\end{lstlisting}
%
%With \kvopt{maxnames}{1}, \kvopt{uniquename}{init/full}, we would get:
使用\kvopt{maxnames}{1}, \kvopt{uniquename}{init/full}:

\begin{lstlisting}{}
J. Doe et al.
E. Doe
\end{lstlisting}
%
%With \kvopt{uniquename}{mininit/minfull}:
使用\kvopt{uniquename}{mininit/minfull}:

\begin{lstlisting}{}
Doe et al.
Doe
\end{lstlisting}
%
%Because the lists differ in the <et al.>, the names are not disambiguated.
因为列表有 <et al.> 的不同，姓名列表就不歧义。

%\paragraph{Lists of Names (\opt{uniquelist})}
\paragraph{姓名列表(独立姓名外的处理) (\opt{uniquelist})}

%Ambiguity is also an issue with name lists. If the \bibfield{labelname} list is truncated by the \opt{maxnames}\slash \opt{minnames} options, it may become ambiguous. This type of ambiguity is addressed by the \opt{uniquelist} option. Consider the following data:

姓名列表也可能存在歧义问题。如果\bibfield{labelname}列表由\opt{maxnames}\slash \opt{minnames}选项截短就可能产生歧义。这类问题由\opt{uniquelist}选处理，考虑如下数据:

\begin{lstlisting}{}
Doe/Jones/Smith   2005
Smith/Johnson/Doe 2005
Smith/Doe/Edwards 2005
Smith/Doe/Jones   2005
\end{lstlisting}
%
%Many author-year styles truncate long author/editor lists in citations. For example, with \kvopt{maxnames}{1} we would get:

很多作者年制样式需要在标注中截短，比如使用\kvopt{maxnames}{1}选项，得到:

\begin{lstlisting}{}
Doe et al. 2005
Smith et al. 2005a
Smith et al. 2005b
Smith et al. 2005c
\end{lstlisting}
%
%Since the authors are ambiguous after truncation, the extra letter is added to the year to ensure unique citations. Here again, many style guides mandate that the extra letter be used to disambiguate works by the same authors only. In order to disambiguate author lists, you are usually required to add more names, exceeding the \opt{maxnames}\slash \opt{minnames} truncation point. The \opt{uniquelist} feature addresses this requirement. With \kvopt{uniquelist}{true}, we would get:

因为截短后作者存在歧义，所以添加额外字符确保引用标注的唯一性。同样的，一些样式强制要求额外字符只能用于所有作者都相同的情况。为了区分作者列表，必须增加更多的姓名，这样就会超出\opt{maxnames}\slash \opt{minnames}选项设定的截短点。\opt{uniquelist}选项即描述这一需求，当\kvopt{uniquelist}{true}，有:

\begin{lstlisting}{}
Doe et al. 2005
Smith, Johnson et al. 2005
Smith, Doe and Edwards 2005
Smith, Doe and Jones 2005
\end{lstlisting}
%
The \opt{uniquelist} option overrides \opt{maxnames}\slash \opt{minnames} on a per-entry basis. Essentially, what happens is that the <et al.> part of the citation is expanded to the point of no ambiguity~-- but no further than that. \opt{uniquelist} may also be combined with \opt{uniquename}. Consider the following data:

\opt{uniquelist}选项以条目为限重设\opt{maxnames}\slash \opt{minnames}。大体上，标注的 <et al.> 部分扩展到无歧义的点--而且也基本到此为止。\opt{uniquelist}也可以与\opt{uniquename}联合使用，考虑如下数据:

\begin{lstlisting}{}
John Doe/Allan Johnson/William Jones  2009
John Doe/Edward Johnson/William Jones 2009
John Doe/Jane Smith/William Jones     2009
John Doe/John Smith/William Jones     2009
John Doe/John Edwards/William Jones   2009
John Doe/John Edwards/Jack Johnson    2009
\end{lstlisting}
%
%With \kvopt{maxnames}{1}:
使用\kvopt{maxnames}{1}，得到:

\begin{lstlisting}{}
Doe et al. 2009a
Doe et al. 2009b
Doe et al. 2009c
Doe et al. 2009d
Doe et al. 2009e
Doe et al. 2009f
\end{lstlisting}
%
%With \kvopt{maxnames}{1}, \kvopt{uniquename}{full}, \kvopt{uniquelist}{true}:
使用\kvopt{maxnames}{1}, \kvopt{uniquename}{full}, \kvopt{uniquelist}{true}则有:

\begin{lstlisting}{}
Doe, A. Johnson et al. 2009
Doe, E. Johnson et al. 2009
Doe, Jane Smith et al. 2009
Doe, John Smith et al. 2009
Doe, Edwards and Jones 2009
Doe, Edwards and Johnson 2009
\end{lstlisting}
%
%With \kvopt{uniquelist}{minyear}, list disambiguation only happens if the visible list is identical to another visible list with the same \bibfield{labelyear}. This is useful for author-year styles which only require that the citation as a whole be unique, but do not guarantee unambiguous authorship information in citations. This mode is conceptually related to \kvopt{uniquename}{mininit/minfull}. Consider this example:

使用\kvopt{uniquelist}{minyear}，消除列表歧义仅在可见列表和\bibfield{labelyear}相同的时候。这对于仅仅需要整个标注整体具有唯一性的作者年制样式是很有用的，但是不保证作者姓名的非歧义性。这一模式概念上域\kvopt{uniquename}{mininit/minfull}选项相关。考虑如下例子:

\begin{lstlisting}{}
Smith/Jones   2000
Smith/Johnson 2001
\end{lstlisting}
%
%With \kvopt{maxnames}{1} and \kvopt{uniquelist}{true}, we would get:
使用\kvopt{maxnames}{1}和\kvopt{uniquelist}{true}，得到:

\begin{lstlisting}{}
Smith and Jones 2000
Smith and Johnson 2001
\end{lstlisting}
%
%With \kvopt{uniquelist}{minyear}:
使用\kvopt{uniquelist}{minyear}，则得到:

\begin{lstlisting}{}
Smith et al. 2000
Smith et al. 2001
\end{lstlisting}
%
%With \kvopt{uniquelist}{minyear}, it is not clear that the authors are different for the two works but the citations as a whole are still unambiguous since the year is different. In contrast to that, \kvopt{uniquelist}{true} disambiguates the authorship even if this information is not required to uniquely locate the works in the bibliography. Let's consider another example:

使用\kvopt{uniquelist}{minyear}，两个文献的作者是否相同并不清楚，但标注的整体是非歧义的，因为年份的不同。与此相反，\kvopt{uniquelist}{true}需要消除作者列表的歧义即便这一信息对于参考文献表的唯一引用是不必要的，看看如下例子:

\begin{lstlisting}{}
Vogel/Beast/Garble/Rook  2000
Vogel/Beast/Tremble/Bite 2000
Vogel/Beast/Acid/Squeeze 2001
\end{lstlisting}
%
%With \kvopt{maxnames}{3}, \kvopt{minnames}{1}, \kvopt{uniquelist}{true}, we would get:
使用\kvopt{maxnames}{3}, \kvopt{minnames}{1}, \kvopt{uniquelist}{true}，得到

\begin{lstlisting}{}
Vogel, Beast, Garble et al. 2000
Vogel, Beast, Tremble et al. 2000
Vogel, Beast, Acid et al. 2001
\end{lstlisting}
%
%With \kvopt{uniquelist}{minyear}:
使用\kvopt{uniquelist}{minyear}选项，则有:

\begin{lstlisting}{}
Vogel, Beast, Garble et al. 2000
Vogel, Beast, Tremble et al. 2000
Vogel et al. 2001
\end{lstlisting}
%
%In the last citation, \kvopt{uniquelist}{minyear} does not override \opt{maxnames}\slash \opt{minnames} as the citation does not need disambiguating from the other two because the year is different.

在最后一个引用中，\kvopt{uniquelist}{minyear}不重写\opt{maxnames}\slash \opt{minnames}，因为年份的不同，所以不需要消除与其它两个间的歧义。

\subsubsection{浮动体和\acr{TOC}/\acr{LOT}/\acr{LOF}中的追踪器 Trackers in Floats and \acr{TOC}/\acr{LOT}/\acr{LOF}}
\label{aut:cav:flt}

If a citation is given in a float (typically in the caption of a figure or table), scholarly back references like <ibidem> or back references based on the page tracker get ambiguous because floats are objects which are (physically and logically) placed outside the flow of text, hence the logic of such references applies poorly to them. To avoid any such ambiguities, the citation and page trackers are temporarily disabled in all floats. In addition to that, these trackers plus the back reference tracker (\opt{backref}) are temporarily disabled in the table of contents, the list of figures, and the list of tables.

\subsubsection{混合编程接口 Mixing Programming Interfaces}
\label{aut:cav:mif}

%The \biblatex package provides two main programming interfaces for style authors. The \cmd{DeclareBibliographyDriver} command, which defines a handler for an entry type, is typically used in \file{bbx} files. \cmd{DeclareCiteCommand}, which defines a new citation command, is typically used in \file{cbx} files. However, in some cases it is convenient to mix these two interfaces. For example, the \cmd{fullcite} command prints a verbose citation similar to the full bibliography entry. It is essentially defined as follows:

\biblatex 宏包给样式作者提供了2个主要的编程接口即: \file{bbx}文件中使用的\cmd{DeclareBibliographyDriver} 命令用来定义各类参考文献条目的驱动(格式处理器，handler)，\file{cbx}文件中使用的\cmd{DeclareCiteCommand}命令用来定义新的引用命令。然而有时候，混合使用这两个接口会很方便。比如\cmd{fullcite}命令就可以打印类似于完整参考文献条目的长串引用，该命令定义大体如下:

\begin{lstlisting}[style=latex]{}
\DeclareCiteCommand{\fullcite}
  {...}
  {<<\usedriver>>{...}{<<\thefield{entrytype}>>}}
  {...}
  {...}
\end{lstlisting}
%
%As you can see, the core code which prints the citations simply executes the bibliography driver defined with \cmd{DeclareBibliographyDriver} for the type of the current entry. When writing a citation style for a verbose citation scheme, it is often convenient to use the following structure:

如上所见，打印引用的核心代码简单地为当前的条目类型执行了\cmd{DeclareBibliographyDriver}定义的参考文献驱动命令。当为长引用样式(a verbose citation scheme)编写引用样式文件的时候，使用下面的结构是非常方便的:


\begin{ltxexample}
\ProvidesFile{example.cbx}[2007/06/09 v1.0 biblatex citation style]

\DeclareCiteCommand{\cite}
  {...}
  {<<\usedriver>>{...}{<<cite:\thefield{entrytype}>>}}
  {...}
  {...}

\DeclareBibliographyDriver{<<cite:article>>}{...}
\DeclareBibliographyDriver{<<cite:book>>}{...}
\DeclareBibliographyDriver{<<cite:inbook>>}{...}
...
\end{ltxexample}
%
%Another case in which mixing interfaces is helpful are styles using cross"=references within the bibliography. For example, when printing an \bibtype{incollection} entry, the data inherited from the \bibtype{collection} parent entry would be replaced by a short pointer to the respective parent entry:

混合接口的另一个有用情况是在参考文献表中使用交叉引用(cross"=references)时。比如当打印\bibtype{incollection}
类型的条目，数据继承自\bibtype{collection}父条目，将会由一个简短的指向对应父条目的指针来代替。

\begin{enumerate}
\renewcommand*\labelenumi{[\theenumi]}
\setlength{\leftskip}{0.5em}
\item Audrey Author: \emph{Title of article}. In: [\textln{2}], pp.~134--165.
\item Edward Editor, ed.: \emph{Title of collection}. Publisher: Location, 1995.
\end{enumerate}

%One way to implement such cross"=references within the bibliography is to think of them as citations which use the value of the \bibfield{xref} or \bibfield{crossref} field as the entry key. Here is an example:

实现这种参考文献的交叉引用的一种方法是认为他们是引用关系，使用\bibfield{xref} 或 \bibfield{crossref}域的值作为条目关键字(bibtex条目键，entry key)，例子如下:

\begin{ltxexample}
\ProvidesFile{example.bbx}[2007/06/09 v1.0 biblatex bibliography style]

\DeclareCiteCommand{<<\bbx@xref>>}
  {}
  {...}% code for cross-references
  {}
  {}

\DeclareBibliographyDriver{incollection}{%
  ...
  \iffieldundef{xref}
    {...}% code if no cross-reference
    {<<\bbx@xref>>{<<\thefield{xref}>>}}%
  ...
}
\end{ltxexample}
%
%When defining \cmd{bbx@xref}, the \prm{precode}, \prm{postcode}, and \prm{sepcode} arguments of \cmd{DeclareCiteCommand} are left empty in the above example because they will not be used anyway. The cross"=reference is printed by the \prm{loopcode} of \cmd{bbx@xref}. For further details on the \bibfield{xref} field, refer to \secref{bib:fld:spc} and to the hints in \secref{bib:cav:ref}. Also see the \cmd{iffieldxref}, \cmd{iflistxref}, and \cmd{ifnamexref} tests in \secref{aut:aux:tst}. The above could also be implemented using the \cmd{entrydata} command from \secref{aut:bib:dat}:

当定义\cmd{bbx@xref}命令时，\cmd{DeclareCiteCommand}命令的\prm{precode}, \prm{postcode}, 和 \prm{sepcode}参数留空，是因为上面例子中没有用到。交叉引用由\cmd{bbx@xref}命令的\prm{loopcode}参数打印。更多的关于\bibfield{xref}域的细节见\secref{bib:fld:spc}节以及\secref{bib:cav:ref}节中的注意事项。在\secref{aut:aux:tst}节我们也看到了\cmd{iffieldxref}, \cmd{iflistxref}, 和\cmd{ifnamexref}测试命令。这些都也可以用\secref{aut:bib:dat}节的\cmd{entrydata}命令来实现。


\begin{ltxexample}
\ProvidesFile{example.bbx}[2007/06/09 v1.0 biblatex bibliography style]

\DeclareBibliographyDriver{incollection}{%
  ...
  \iffieldundef{xref}
    {...}% code if no cross-reference
    {<<\entrydata>>{<<\thefield{xref}>>}{%
      % code for cross-references
      ...
    }}%
  ...
}
\end{ltxexample}

\subsubsection{使用标点追踪 Using the Punctuation Tracker}
\label{aut:cav:pct}

\paragraph{标点基础 The Basics}

%There is one fundamental principle style authors should keep in mind when designing a bibliography driver: block and unit punctuation is handled asynchronously. This is best explained by way of example. Consider the following code snippet:

样式作者设计参考文献驱动时需要记住一点:块和单元的标点是异步处理的。用例子最容易解释这一点，看下面一段代码:

\begin{lstlisting}[style=latex]{}
\printfield{title}%
\newunit
\printfield{edition}%
\newunit
\printfield{note}%
\end{lstlisting}
%
%If there is no \bibfield{edition} field, this piece of code will not print:
如果没有\bibfield{edition}域，那么这段代码的打印结果不会是:

\begin{lstlisting}[style=highlight]{}
Title. . Note
\end{lstlisting}
%
%but rather:
而会是

\begin{lstlisting}[style=highlight]{}
Title. Note
\end{lstlisting}
%
因为单元的标点追踪器是异步方式工作的。\cmd{newunit}命令将不会立即打印标点。它仅是记录一个单元的边界并且将\cmd{newunitpunct}命令放入标点缓存中。该缓存会有\emph{接下来的}\cmd{printfield}、\cmd{printlist}或类似命令进行处理，且仅当这些命令各自处理的域或列表已定义的时候才会处理。像\cmd{printfield}这样的命令在插入任何块和单元的标点之前将首先考虑3个因素:
%because the unit punctuation tracker works asynchronously. \cmd{newunit} will not print the unit punctuation immediately. It merely records a unit boundary and puts \cmd{newunitpunct} on the punctuation buffer. This buffer will be handled by \emph{subsequent} \cmd{printfield}, \cmd{printlist}, or similar commands but only if the respective field or list is defined. Commands like \cmd{printfield} will consider three factors prior to inserting any block or unit punctuation:

\begin{itemize}
\item %Has a new unit/block been requested at all?\par
%= Is there any preceding \cmd{newunit} or \cmd{newblock} command?
是否有新的单元/块的输出请求？\par
=前面是否有\cmd{newunit}或者\cmd{newblock}命令？

\item %Did the preceding commands print anything?\par
%= Is there any preceding \cmd{printfield} or similar command?\par
%= Did this command actually print anything?\par
前面的命令是否有打印输出？\par
=前面是否有\cmd{printfield}或者相似命令？\par
=该命令是否实际打印了任何东西？\par

\item %Are we about to print anything now?\par
%= Is the field/list to be processed now defined?
现在是否要打印一些东西？\par
要进行打印处理的域或列表是否已定义？
\end{itemize}
%
%Block and unit punctuation will only be inserted if \emph{all} of these conditions apply. Let's reconsider the above example:
块和单元的标点只会在上述\emph{所有}条件满足的时候才会输出。让我们再次考虑上面的例子:

\begin{lstlisting}[style=latex]{}
\printfield{title}%
\newunit
\printfield{edition}%
\newunit
\printfield{note}%
\end{lstlisting}
%
如果\bibfield{edition}域没有定义会发生什么呢？第一个\cmd{printfield}命令打印了标题并设置一个内部的<new~text>标志。第一个\cmd{newunit}命令设置一个内部的<new~unit>标志。这使没有任何标点输出。第二个\cmd{printfield}命令不进行任何处理因为\bibfield{edition}域未定义。接下来的\cmd{newunit}命令再次设置<new unit>标志，仍然没有标点输出。第三个\cmd{printfield}命令检测\bibfield{note}域是否已定义，如果是，它会寻找<new~text>和<new~unit>标志。如果两个标志都存在，那么它会在打印note前插入标点缓存。然后它会清除<new~unit>标志然后再次设置<new~text>标志。
%Here's what happens if the \bibfield{edition} field is undefined. The first \cmd{printfield} command prints the title and sets an internal <new~text> flag. The first \cmd{newunit} sets an internal <new~unit> flag. No punctuation has been printed at this point. The second \cmd{printfield} does nothing because the \bibfield{edition} field is undefined. The next \cmd{newunit} command sets the internal flag <new unit> again. Still no punctuation has been printed. The third \cmd{printfield} checks if the \bibfield{note} field is defined. If so, it looks at the <new~text> and <new~unit> flags. If both are set, it inserts the punctuation buffer before printing the note. It then clears the <new~unit> flag and sets the <new~text> flag again.

所有这些听起来似乎很复杂，但实际上，这意味着可以用顺序的方式写一个具有很多部件的参考文献驱动。这种方法的优势在不使用标点追踪而实现上述代码功能时会体现的很明显。如果不用标点追踪，那么会因为大量对所有可能存在域的判断产生一个复杂的\cmd{iffieldundef}判断命令集合。
%
%This may all sound more complicated than it is. In practice, it means that it is possible to write large parts of a bibliography driver in a sequential way. The advantage of this approach becomes obvious when trying to write the above code without using the punctuation tracker. Such an attempt will lead to a rather convoluted set of \cmd{iffieldundef} tests required to check for all possible field combinations (note that the code below handles three fields; a typical driver may need to cater for some two dozen fields):

\begin{lstlisting}[style=latex]{}
\iffieldundef{title}%
  {\iffieldundef{edition}
     {\printfield{note}}
     {\printfield{edition}%
      \iffieldundef{note}%
	{}
	{. \printfield{note}}}}
  {\printfield{title}%
   \iffieldundef{edition}
     {}
     {. \printfield{edition}}%
   \iffieldundef{note}
     {}
     {. \printfield{note}}}%
\end{lstlisting}

\paragraph{常见错误 Common Mistakes}

把单元的标点处理认为是同步处理的是一个相当常见的误解。这会导致当驱动中包含原样文本\footnote{这里literal text 理解为原样文本，如实文本，逐字文本}时出现一些典型错误。考虑下面导致标点错位的错误代码段:
%It is a fairly common misconception to think of the unit punctuation as something that is handled synchronously. This typically causes problems if the driver includes any literal text. Consider this erroneous code snippet which will generate misplaced unit punctuation:

\begin{lstlisting}[style=latex]{}
\printfield{title}%
\newunit
<<(>>\printfield{series} \printfield{number}<<)>>%
\end{lstlisting}
%
%This code will yield the following result:
这段代码将产生下面的结果:

\begin{lstlisting}[style=highlight]{}
Title <<(.>> Series Number<<)>>
\end{lstlisting}
%
这里发生了什么呢？第一个\cmd{printfield}命令打印了标题，然后\cmd{newunit}命令标记了一个新的单元边界但不打印任何内容。单元的标点由\emph{下一个}\cmd{printfield}命令打印。这是前面提过的异步机制。然而因为左括号在下一个
\cmd{printfield}命令插入标点前立即打印，所以导致了错误的句点。当插入\emph{任何}原样文本比如括号(还包括由
\cmd{bibopenparen}和\cmd{mkbibparens}命令打印的括号)时，总需要将这些文本用\cmd{printtext}命令包起来。要让标点追踪正常运转，需要让驱动知道所有插入的原样文本。这是\cmd{printtext}命令的作用所在。\cmd{printtext}命令联系标点追踪器确保标点缓存在原样文本打印前插入。它也设定内部 <new~text> 标志。注意本例中还有第三处原样文本即|\printfield{series}|后面的空格。在改正的例子中，我们将使用标点追踪器来处理该空格。

%Here's what happens. The first \cmd{printfield} prints the title. Then \cmd{newunit} marks a unit boundary but does not print anything. The unit punctuation is printed by the \emph{next} \cmd{printfield} command. That's the asynchronous part mentioned before. However, the opening parenthesis is printed immediately before the next \cmd{printfield} inserts the unit punctuation, leading to a misplaced period. When inserting \emph{any} literal text such as parentheses (including those printed by commands such as \cmd{bibopenparen} and \cmd{mkbibparens}), always wrap the text in a \cmd{printtext} command. For the punctuation tracker to work as expected, it needs to know about all literal text inserted by a driver. This is what \cmd{printtext} is all about. \cmd{printtext} interfaces with the punctuation tracker and ensures that the punctuation buffer is inserted before the literal text gets printed. It also sets the internal <new~text> flag. Note there is in fact a third piece of literal text in this example: the space after |\printfield{series}|. In the corrected example, we will use the punctuation tracker to handle that space.

\begin{lstlisting}[style=latex]{}
\printfield{title}%
\newunit
<<\printtext{(}>>%
\printfield{series}%
<<\setunit*{\addspace}>>%
\printfield{number}%
<<\printtext{)}>>%
\end{lstlisting}
%
尽管上面的代码能够如常工作，但处理括号、引号和其它包围某个域的标点是，推荐的方式是定义一个域格式:
%While the above code will work as expected, the recommended way to handle parentheses, quotes, and other things which enclose more than one field, is to define a field format:

\begin{lstlisting}[style=latex]{}
\DeclareFieldFormat{<<parens>>}{<<\mkbibparens{#1}>>}
\end{lstlisting}
%
域格式可以同时用于\cmd{printfield}和\cmd{printtext}命令，因此我们可以利用它对若干个域用一堆括号进行包裹。
%Field formats may be used with both \cmd{printfield} and \cmd{printtext}, hence we can use them to enclose several fields in a single pair of parentheses:

\begin{lstlisting}[style=latex]{}
<<\printtext[parens]{>>%
  \printfield{series}%
  \setunit*{\addspace}%
  \printfield{number}%
<<}>>%
\end{lstlisting}
%
这里我们还需要处理没有series信息时的情况，因此进一步改进代码如下:
%We still need to handle cases in which there is no series information at all, so let's improve the code some more:

\begin{lstlisting}[style=latex]{}
<<\iffieldundef{series}>>
  {}
  {\printtext[parens]{%
     \printfield{series}%
     \setunit*{\addspace}%
     \printfield{number}}}%
\end{lstlisting}
%
最后的一点提示: 本地化字符串对于标点追踪器来说不是原样文本。因为\cmd{bibstring}和相似命令能联系标点追踪器，因此就不需要用\cmd{printtext}包裹起来。
%One final hint: localization strings are not literal text as far as the punctuation tracker is concerned. Since \cmd{bibstring} and similar commands interface with the punctuation tracker, there is no need to wrap them in a \cmd{printtext} command.

\paragraph{高级应用 Advanced Usage}
标点追踪器也可用来处理更复杂的情况。比如，考虑需要对\bibfield{location}、 \bibfield{publisher}和 \bibfield{year}根据数据是否提供以如下的格式打印：
%The punctuation tracker may also be used to handle more complex scenarios. For example, suppose that we want the fields \bibfield{location}, \bibfield{publisher}, and \bibfield{year} to be rendered in one of the following formats, depending on the available data:

\begin{lstlisting}[style=latex]{}
...text<<. Location: Publisher, Year.>> Text...
...text<<. Location: Publisher.>> Text...
...text<<. Location: Year.>> Text...
...text<<. Publisher, Year.>> Text...
...text<<. Location.>> Text...
...text<<. Publisher.>> Text...
...text<<. Year.>> Text...
\end{lstlisting}
%
这个问题可以用一个相当复杂的\cmd{iflistundef}和\cmd{iffieldundef}判断集进行处理，通过这些判断可以确定所有可能的域的组合：
%This problem can be solved with a rather convoluted set of \cmd{iflistundef} and \cmd{iffieldundef} tests which check for all possible field combinations:

\begin{lstlisting}[style=latex]{}
\iflistundef{location}
  {\iflistundef{publisher}
     {\printfield{year}}
     {\printlist{publisher}%
      \iffieldundef{year}
        {}
        {, \printfield{year}}}}
  {\printlist{location}%
   \iflistundef{publisher}%
     {\iffieldundef{year}
        {}
        {: \printfield{year}}}
     {: \printlist{publisher}%
      \iffieldundef{year}
        {}
        {, \printfield{year}}}}%
\end{lstlisting}
%
可以应用\cmd{ifthenelse}命令和\secref{aut:aux:ife}讨论的布尔运算可使上面的代码更具可读性。但本质上是一样的。然而，也可以按顺序写成如下方式:
%The above could be written in a somewhat more readable way by employing \cmd{ifthenelse} and the boolean operators discussed in \secref{aut:aux:ife}. The approach would still be essentially the same. However, it may also be written sequentially:

\begin{lstlisting}[style=latex]{}
\newunit
\printlist{location}%
\setunit*{\addcolon\space}%
\printlist{publisher}%
\setunit*{\addcomma\space}%
\printfield{year}%
\newunit
\end{lstlisting}
%
在实际使用中，你会经常使用标点追踪器执行一些显式或隐式的组合判断，比如，考虑如下格式(注意当没有publisher时location后面的标点)
%In practice, you will often use a combination of explicit tests and the implicit tests performed by the punctuation tracker. For example, consider the following format (note the punctuation after the location if there is no publisher):

\begin{lstlisting}[style=latex]{}
...text. Location: Publisher, Year. Text...
...text. Location: Publisher. Text...
...text<<. Location, Year.>> Text...
...text. Publisher, Year. Text...
...text. Location. Text...
...text. Publisher. Text...
...text. Year. Text...
\end{lstlisting}
%
这可以用如下代码进行处理:
%This can be handled by the following code:

\begin{lstlisting}[style=latex]{}
\newunit
\printlist{location}%
\iflistundef{publisher}
  {\setunit*{\addcomma\space}}
  {\setunit*{\addcolon\space}}%
\printlist{publisher}%
\setunit*{\addcomma\space}%
\printfield{year}%
\newunit
\end{lstlisting}
%
因为当没有publisher时location后面的标点的特殊性，我们需要用一个\cmd{iflistundef}判断来确保正确性。剩下其它的则有标点追踪器处理。
%Since the punctuation after the location is special if there is no publisher, we need one \cmd{iflistundef} test to catch this case. Everything else is handled by the punctuation tracker.

\subsubsection{定制本地化模型 Custom Localization Modules}
\label{aut:cav:lng}

Style guides may include provisions as to how strings like <edition> should be abbreviated or they may mandate certain fixed expressions. For example, the \acr{mla} style guide requires authors to use the term <Works~Cited> rather than <Bibliography> or <References> in the heading of the bibliography. Localization commands such as \cmd{DefineBibliographyStrings} from \secref{use:lng} may indeed be used in \file{cbx} and \file{bbx} files to handle such cases. However, overloading style files with translations is rather inconvenient. This is where \cmd{DeclareLanguageMapping} from \secref{aut:lng:cmd} comes into play. This command maps an \file{lbx} file with alternative translations to a \sty{babel}/\sty{polyglossia} language. For example, you could create a file named \path{french-humanities.lbx} which provides French translations adapted for use in the humanities and map it to the \sty{babel}/\sty{polyglossia} language \texttt{french} in the preamble or in the configuration file:

\begin{lstlisting}[style=latex]{}
\DeclareLanguageMapping{french}{french-humanities}
\end{lstlisting}
%
If the document language is set to \texttt{french}, \path{french-humanities.lbx} will replace \path{french.lbx}. Coming back to the \acr{mla} example mentioned above, an \acr{mla} style may come with an \path{american-mla.lbx} file to provide strings which comply with the \acr{mla} style guide. It would declare the following mapping in the \file{cbx} and/or \file{bbx} file:

\begin{lstlisting}[style=latex]{}
\DeclareLanguageMapping{american}{american-mla}
\end{lstlisting}
%
Since the alternative \file{lbx} file can inherit strings from the standard \path{american.lbx} module, \path{american-mla.lbx} may be as short as this:

\begin{ltxexample}
\ProvidesFile{american-mla.lbx}[2008/10/01 v1.0 biblatex localization]
<<\InheritBibliographyExtras>>{<<american>>}
\DeclareBibliographyStrings{%
  <<inherit>>          = {<<american>>},
  bibliography     = {{Works Cited}{Works Cited}},
  references       = {{Works Cited}{Works Cited}},
}
\endinput
\end{ltxexample}
%
Alternative \file{lbx} files must ensure that the localization module is complete. They will typically do so by inheriting data from the corresponding standard module. If the language \texttt{american} is mapped to \path{american-mla.lbx}, \biblatex will not load \path{american.lbx} unless this module is requested explicitly. In the above example, inheriting <strings> and <extras> will cause \biblatex to load \path{american.lbx} before applying the modifications in \path{american-mla.lbx}.

Note that \cmd{DeclareLanguageMapping} is not intended to handle language variants (\eg American English vs. British English) or \sty{babel}/\sty{polyglossia} language aliases (\eg \texttt{USenglish} vs. \texttt{american}). For example, \sty{babel}/\sty{polyglossia} offers the \texttt{USenglish} option which is similar to \texttt{american}. Therefore, \biblatex ships with an \path{USenglish.lbx} file which simply inherits all data from \path{american.lbx} (which in turn gets the <strings> from \path{english.lbx}). In other words, the mapping of language variants and \sty{babel}/\sty{polyglossia} language aliases happens on the file level, the point being that \biblatex's language support can be extended simply by adding additional \file{lbx} files. There is no need for centralized mapping. If you need support for, say, Portuguese (babel/polyglossia: \file{portuges}), you create a file named \path{portuges.lbx}. If \sty{babel}/\sty{polyglossia} offered an alias named \texttt{brasil}, you would create \path{brasil.lbx} and inherit the data from \path{portuges.lbx}. In contrast to that, the point of \cmd{DeclareLanguageMapping} is handling \emph{stylistic} variants like <humanities vs. natural sciences> or <\acr{mla} vs. \acr{apa}> etc. which will typically be built on top of existing \file{lbx} files.

\subsubsection{编组 Grouping}
\label{aut:cav:grp}

In a citation or bibliography style, you may need to set flags or store certain values for later use. In this case, it is crucial to understand the basic grouping structure imposed by this package. As a rule of thumb, you are working in a large group whenever author commands such as those discussed in \secref{aut:aux} are available because the author interface of this package is only enabled locally. If any bibliographic data is available, there is at least one additional group. Here are some general rules:

\begin{itemize}

\item The entire list of references printed by \cmd{printbibliography} and similar commands is processed in a group. Each entry in the list is processed in an additional group which encloses the \prm{item code} of \cmd{defbibenvironment} as well as all driver code.

\item The entire bibliography list printed by \cmd{printbiblist} is processed in a group. Each entry in the list is processed in an additional group which encloses the \prm{item code} of \cmd{defbibenvironment} as well as all driver code.

\item All citation commands defined with \cmd{DeclareCiteCommand} are processed in a group holding the complete citation code consisting of the \prm{precode}, \prm{sepcode}, \prm{loopcode}, and \prm{postcode} arguments. The \prm{loopcode} is enclosed in an additional group every time it is executed. If any \prm{wrapper} code has been specified, the entire unit consisting of the wrapper code and the citation code is wrapped in an additional group.

\item In addition to the grouping imposed by all backend commands defined with \cmd{DeclareCiteCommand}, all <autocite> and <multicite> definitions imply an additional group.

\item \cmd{printfile}, \cmd{printtext}, \cmd{printfield}, \cmd{printlist}, and \cmd{printnames} form groups. This implies that all formatting directives will be processed within a group of their own.

\item All \file{lbx} files are loaded and processed in a group. If an \file{lbx} file contains any code which is not part of \cmd{DeclareBibliographyExtras}, the definitions must be global.

\end{itemize}

Note that using \cmd{aftergroup} in citation and bibliography styles is unreliable because the precise number of groups employed in a certain context may change in future versions of this package. If the above list states that something is processed in a group, this means that there is \emph{at least one} group. There may also be several nested ones.

\subsubsection{姓名内的间距 Namespaces}
\label{aut:cav:nam}

In order to minimize the risk of name clashes, \latex packages typically prefix the names of internal macros with a short string specific to the package. For example, if the \sty{foobar} package requires a macro for internal use, it would typically be called \cmd{FB@macro} or \cmd{foo@macro} rather than \cmd{macro} or \cmd{@macro}. Here is a list of the prefixes used or recommended by \biblatex:

\begin{marglist}

\item[\texttt{blx}] All macros with names like \cmd{blx@name} are strictly reserved for internal use. This also applies to counter names, length registers, boolean switches, and so on. These macros may be altered in backwards"=incompatible ways, they may be renamed or even removed at any time without further notice. Such changes will not even be mentioned in the revision history or the release notes. In short: never use any macros with the string \texttt{blx} in their name in any styles.

\item[\texttt{abx}] Macros prefixed with \texttt{abx} are also internal macros but they are fairly stable. It is always preferable to use the facilities provided by the official author interface, but there may be cases in which using an \texttt{abx} macro is convenient.

\item[\texttt{bbx}] This is the recommended prefix for internal macros defined in bibliography styles.

\item[\texttt{cbx}] This is the recommended prefix for internal macros defined in citation styles.

\item[\texttt{lbx}] This is the recommended base prefix for internal macros defined in localization modules. The localization module should add a second prefix to specify the language. For example, an internal macro defined by the Spanish localization module would be named \cmd{lbx@es@macro}.

\end{marglist}

